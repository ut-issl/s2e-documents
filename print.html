<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>S2E documents</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="Overview.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">General Information</li><li class="chapter-item expanded "><a href="General/CodingConvention.html"><strong aria-hidden="true">1.</strong> Coding Convention</a></li><li class="chapter-item expanded "><a href="General/DocumentFormat.html"><strong aria-hidden="true">2.</strong> Format of Documents</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Setup Environment</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="General/HowToCompileWithVisualStudio.html"><strong aria-hidden="true">3.1.</strong> How to compile with Visual Studio</a></li><li class="chapter-item expanded "><a href="General/HowToCompileWithUbuntuInDocker.html"><strong aria-hidden="true">3.2.</strong> How to compile with Ubuntu in Docker</a></li><li class="chapter-item expanded "><a href="General/HowToCompileWith_OSX.html"><strong aria-hidden="true">3.3.</strong> How to compile with OSX Environment</a></li><li class="chapter-item expanded "><a href="General/HowToDownloadNRLMSISE00library.html"><strong aria-hidden="true">3.4.</strong> How to download and make NRLMSISE00 Library</a></li><li class="chapter-item expanded "><a href="General/HowToDwnloadCSPCElibrary.html"><strong aria-hidden="true">3.5.</strong> How to download CSPICE Library</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Tutorials</li><li class="chapter-item expanded "><a href="Tutorials/GettingStarted.html"><strong aria-hidden="true">4.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="Tutorials/HowToMakeNewSimulationScenario.html"><strong aria-hidden="true">5.</strong> How To Make New Simulation Scenario</a></li><li class="chapter-item expanded "><a href="Tutorials/HowToAddComponents.html"><strong aria-hidden="true">6.</strong> How To Add Components</a></li><li class="chapter-item expanded "><a href="Tutorials/HowToMakeNewComponents.html"><strong aria-hidden="true">7.</strong> How To Make New Components</a></li><li class="chapter-item expanded "><a href="Tutorials/HowToUseMonteCarloSimulation.html"><strong aria-hidden="true">8.</strong> How To Use Monte Carlo Simulation</a></li><li class="chapter-item expanded "><a href="Tutorials/HowToAddControlAlgorithms.html"><strong aria-hidden="true">9.</strong> How To Add Control Algorithms</a></li><li class="chapter-item expanded "><a href="Tutorials/HowToIntegrateC2A.html"><strong aria-hidden="true">10.</strong> How To Integrate C2A</a></li><li class="chapter-item expanded "><a href="Tutorials/HowToPerformUartHilsTest.html"><strong aria-hidden="true">11.</strong> How To Perform UART HILS Test</a></li><li class="chapter-item expanded "><a href="Tutorials/HowToPerformI2cHilsTest.html"><strong aria-hidden="true">12.</strong> How To Perform I2C HILS Test</a></li><li class="chapter-item expanded "><a href="Tutorials/HowToSimulateMultipleSatellites.html"><strong aria-hidden="true">13.</strong> How to simulate multiple satellites</a></li><li class="chapter-item expanded affix "><li class="part-title">Specifications</li><li class="chapter-item expanded "><a href="Specifications/OverallStructure/OverallStructure.html"><strong aria-hidden="true">14.</strong> Overall Structure</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> Component</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">15.1.</strong> Abstract</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Component/Abstract/Spec_ComponentBase.html"><strong aria-hidden="true">15.1.1.</strong> Component Base</a></li><li class="chapter-item expanded "><a href="Specifications/Component/Abstract/Spec_ObcCommunicationBase.html"><strong aria-hidden="true">15.1.2.</strong> OBC Communication Base</a></li><li class="chapter-item expanded "><a href="Specifications/Component/Abstract/Spec_SensorBase.html"><strong aria-hidden="true">15.1.3.</strong> Sensor Base</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.2.</strong> AOCS</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Component/AOCS/Spec_STT.html"><strong aria-hidden="true">15.2.1.</strong> STT</a></li><li class="chapter-item expanded "><a href="Specifications/Component/AOCS/Spec_RWJitter.html"><strong aria-hidden="true">15.2.2.</strong> RW Jitter</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.3.</strong> CDH</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.4.</strong> Logic</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.5.</strong> Mission</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Component/Mission/Spec_Telescope_en.html"><strong aria-hidden="true">15.5.1.</strong> Telescope</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.6.</strong> Power</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Component/Power/Spec_PCU.html"><strong aria-hidden="true">15.6.1.</strong> PCU</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.7.</strong> Propulsion</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Component/Propulsion/Spec_SimpleThruster.html"><strong aria-hidden="true">15.7.1.</strong> SimpleThruster</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.8.</strong> Thermal</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> Disturbance</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Disturbance/Spec_GeoPotential.html"><strong aria-hidden="true">16.1.</strong> GeoPotential</a></li><li class="chapter-item expanded "><a href="Specifications/Disturbance/Spec_GGTorque.html"><strong aria-hidden="true">16.2.</strong> Gravity Gradient Torque</a></li><li class="chapter-item expanded "><a href="Specifications/Disturbance/Spec_MagDisturbance.html"><strong aria-hidden="true">16.3.</strong> Magnetic Disturbance Torque</a></li><li class="chapter-item expanded "><a href="Specifications/Disturbance/Spec_SurfaceForce.html"><strong aria-hidden="true">16.4.</strong> Surface force</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Disturbance/Spec_SurfaceForce_AirDrag.html"><strong aria-hidden="true">16.4.1.</strong> Air Drag</a></li><li class="chapter-item expanded "><a href="Specifications/Disturbance/Spec_SurfaceForce_SolarRadiation.html"><strong aria-hidden="true">16.4.2.</strong> Solar Radiation Pressure</a></li></ol></li><li class="chapter-item expanded "><a href="Specifications/Disturbance/Spec_ThirdBodyGravity.html"><strong aria-hidden="true">16.5.</strong> Third Body Gravity</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">17.</strong> Dynamics</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">17.1.</strong> Attitute</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Dynamics/Spec_AttitudeDynamics.html"><strong aria-hidden="true">17.1.1.</strong> Attitude Dynamics</a></li><li class="chapter-item expanded "><a href="Specifications/Dynamics/Spec_ControlledAttitude.html"><strong aria-hidden="true">17.1.2.</strong> Controlled Attitude</a></li></ol></li><li class="chapter-item expanded "><a href="Specifications/Dynamics/Spec_Orbit.html"><strong aria-hidden="true">17.2.</strong> Orbit</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Dynamics/Spec_KeplerOrbit.html"><strong aria-hidden="true">17.2.1.</strong> Kepler Orbit Propagation</a></li><li class="chapter-item expanded "><a href="Specifications/Dynamics/Spec_Sgp4.html"><strong aria-hidden="true">17.2.2.</strong> SGP4 Orbit Propagation</a></li><li class="chapter-item expanded "><a href="Specifications/Dynamics/Spec_Rk4Orbit.html"><strong aria-hidden="true">17.2.3.</strong> RK4 Orbit Propagation</a></li><li class="chapter-item expanded "><a href="Specifications/Dynamics/Spec_EnckeMethod.html"><strong aria-hidden="true">17.2.4.</strong> Orbit Propagation with Encke's Method</a></li><li class="chapter-item expanded "><a href="Specifications/Dynamics/Spec_RelativeOrbit.html"><strong aria-hidden="true">17.2.5.</strong> Relative Orbit</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">17.3.</strong> Thermal</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.</strong> Environment</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Environment/Spec_SRPEnvironment.html"><strong aria-hidden="true">18.1.</strong> SRP Environment</a></li><li class="chapter-item expanded "><a href="Specifications/Environment/Spec_Atmosphere.html"><strong aria-hidden="true">18.2.</strong> Atmosphere</a></li><li class="chapter-item expanded "><a href="Specifications/Environment/Spec_MagEnvironment.html"><strong aria-hidden="true">18.3.</strong> Magnetic Environment</a></li><li class="chapter-item expanded "><a href="Specifications/Environment/Spec_HipparcosCatalogue_en.html"><strong aria-hidden="true">18.4.</strong> Hipparcos Catalogue</a></li><li class="chapter-item expanded "><a href="Specifications/Environment/Spec_GnssSatellites_en.html"><strong aria-hidden="true">18.5.</strong> GNSS Satellites</a></li><li class="chapter-item expanded "><a href="Specifications/Environment/Spec_CelestialRotation.html"><strong aria-hidden="true">18.6.</strong> Celestial Rotation</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">19.</strong> Interface</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Interface/Spec_PowerPort.html"><strong aria-hidden="true">19.1.</strong> Power Port</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">20.</strong> Library</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">21.</strong> Simulation</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Specifications/Simulation/Spec_MonteCarloSimulation.html"><strong aria-hidden="true">21.1.</strong> Monte Carlo Simulation</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">S2E documents</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="coding-convention-of-s2e"><a class="header" href="#coding-convention-of-s2e">Coding Convention of S2E</a></h1>
<h2 id="formatter"><a class="header" href="#formatter">Formatter</a></h2>
<ul>
<li>We use <a href="https://clang.llvm.org/docs/ClangFormat.html">ClangFormat</a> for S2E. 
<ul>
<li>We selected <code>Google</code> base style with small modifications.</li>
<li>Details are written in <a href="https://github.com/ut-issl/s2e-core/blob/develop/.clang-format">.clang-format</a>.</li>
</ul>
</li>
</ul>
<h2 id="naming-rules"><a class="header" href="#naming-rules">Naming Rules</a></h2>
<ul>
<li>
<p>Now discussing</p>
<ul>
<li>The following rules are follows until the new naming rule is decided.</li>
<li>Several old files do not follow the rules.</li>
<li>We are discussing follow the <a href="https://google.github.io/styleguide/cppguide.html">Google C++ Style Guide</a> with small modifications.</li>
</ul>
</li>
<li>
<p>File and directory Name</p>
<ul>
<li><code>snake_case</code></li>
<li>C++ files should end in <code>.cpp</code>, and header files should end in <code>.hpp</code>.</li>
</ul>
</li>
<li>
<p>Macro (define)</p>
<ul>
<li>Snake case with capital case</li>
<li><code>SNAKE_CASE</code></li>
</ul>
</li>
<li>
<p>Name of the class</p>
<ul>
<li><code>CamelCase</code></li>
</ul>
</li>
<li>
<p>Variable name</p>
<ul>
<li>Snake case with lower case</li>
<li><code>snake_case</code></li>
</ul>
</li>
<li>
<p>Constant name (not a define but a constant)</p>
<ul>
<li>Add k at the beginning and the rest is CamelCase</li>
<li><code>kCamelCase</code></li>
</ul>
</li>
<li>
<p>Member variables in the class</p>
<ul>
<li>Snake case with lower case end with <code>_</code></li>
<li><code>snake_case_</code></li>
</ul>
</li>
<li>
<p>Methods (functions) in the class</p>
<ul>
<li><code>CamelCase</code></li>
</ul>
</li>
<li>
<p>The #define Guard</p>
<ul>
<li>Apply <a href="https://google.github.io/styleguide/cppguide.html">Google C++ Style Guide</a>.</li>
<li><code>#pragma once</code> is prohibited</li>
</ul>
</li>
</ul>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<ul>
<li>Use Doxygen</li>
<li>Use Markdown for Doxygen</li>
<li>Examples:
<ul>
<li>https://developer.lsst.io/cpp/api-docs.html</li>
</ul>
</li>
</ul>
<h2 id="initialization-files-ini-files"><a class="header" href="#initialization-files-ini-files">Initialization files (<code>.ini</code> files)</a></h2>
<ul>
<li>Comments
<ul>
<li>Use //</li>
</ul>
</li>
</ul>
<h2 id="abbreviations"><a class="header" href="#abbreviations">Abbreviations</a></h2>
<ul>
<li>Basically, we follows the <a href="https://google.github.io/styleguide/cppguide.html#General_Naming_Rules">Naming Rules in the Google Style Guide</a></li>
<li>Single character abbreviations are prohibited.
<ul>
<li>Examples: <code>q = quaternion</code>, <code>v = velocity</code> are prohibited.</li>
</ul>
</li>
<li>We do not recommend to use abbreviations for one word cutting the word.
<ul>
<li>Examples: <code>pos = position</code>, <code>quat = quaternion</code> are not recommended.</li>
<li>The following abbreviations are available as exceptions since they are widely used in the math, science, and technology field.
<ul>
<li><code>max</code>: maximum</li>
<li><code>min</code>: minimum</li>
<li><code>init</code>: initial, initialize</li>
<li><code>calc</code>: calculate, calculation</li>
</ul>
</li>
</ul>
</li>
<li>Abbreviation only file name is not recommended.
<ul>
<li>Examples
<ul>
<li><code>ode.hpp</code> should be written as <code>ordinary_differential_equation.hpp</code></li>
<li><code>gnssr.hpp</code> is not recommended, but <code>gnss_receiver.hpp</code> is available since we can guess the abbreviation meaning from the context.</li>
</ul>
</li>
</ul>
</li>
<li>Write the full words in the comment when you use abbreviations.</li>
<li>Available abbreviations are decided during review processes.
<ul>
<li>Examples of available abbreviations with comments
<ul>
<li><code>EKF</code>: Extended Kalman Filter</li>
<li><code>GNSS</code>: Global Navigation Satellite System</li>
</ul>
</li>
</ul>
</li>
<li>Abbreviations to show the frame and the unit are available.
<ul>
<li>Examples of frame
<ul>
<li><code>i</code>: Inertial frame</li>
<li><code>b</code>: Body fixed frame</li>
<li><code>c</code>: Component fixed frame</li>
<li><code>ecef</code>: Earth Centered Earth Fixed frame</li>
<li><code>lvlh</code>: Local Vertical Local Horizontal</li>
<li><code>rtn</code>: Radial-Transverse-Normal</li>
</ul>
</li>
<li>Examples of unit: <code>Nm</code>, <code>rad/s</code>, <code>m/s2</code>, <code>degC</code></li>
</ul>
</li>
<li>Available abbreviations 
<ul>
<li><code>S2E</code>: Spacecraft Simulation Environment</li>
<li><code>AOCS</code>: Attitude and Orbit Control System</li>
<li><code>CDH</code>: Command and Data Handling</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="format-to-write-specification-documents"><a class="header" href="#format-to-write-specification-documents">Format to write specification documents</a></h1>
<h2 id="0-general-rule"><a class="header" href="#0-general-rule">0. General rule</a></h2>
<ul>
<li>The file name should be <code>Spec_CamelCase.md</code> in the Specifications directory. </li>
<li>Please use the markdown format.</li>
<li>Because GitHub started to support math description (<a href="https://github.blog/2022-05-19-math-support-in-markdown/">link</a>), we need to describe equations suit with the rule of GitHub and <a href="https://www.mathjax.org/">MathJax</a>.</li>
</ul>
<h2 id="1--overview"><a class="header" href="#1--overview">1.  Overview</a></h2>
<h3 id="1-features"><a class="header" href="#1-features">1. Features</a></h3>
<ul>
<li>Write an overview of features to be realized using the class or library here clearly.</li>
</ul>
<h3 id="2-related-files"><a class="header" href="#2-related-files">2. Related files</a></h3>
<ul>
<li>Enumerate all related codes and input files here</li>
</ul>
<h3 id="3-how-to-use"><a class="header" href="#3-how-to-use">3. How to use</a></h3>
<ul>
<li>Write how to use the class or functions</li>
</ul>
<h2 id="2-explanation-of-algorithm"><a class="header" href="#2-explanation-of-algorithm">2. Explanation of Algorithm</a></h2>
<p>Write important algorithms for the class, the library, or each function. Please use equations, figures, reference papers for easy understanding.</p>
<h3 id="1-name-of-class-structure-and-function"><a class="header" href="#1-name-of-class-structure-and-function">1. Name of class, structure, and function</a></h3>
<h4 id="1-overview"><a class="header" href="#1-overview">1. Overview</a></h4>
<ul>
<li>Please summarize the </li>
</ul>
<h4 id="2-inputs-and-outputs"><a class="header" href="#2-inputs-and-outputs">2. Inputs and Outputs</a></h4>
<ul>
<li>Please list up inputs and outputs</li>
</ul>
<h4 id="3-algorithm"><a class="header" href="#3-algorithm">3. Algorithm</a></h4>
<ul>
<li>Please use math description when you need as follows
$$\dot{\boldsymbol{x}}=f(\boldsymbol{x},t)$$</li>
</ul>
<p>\[
\dot{\boldsymbol{x}}=f(\boldsymbol{x},t)
\]</p>
<ul>
<li>you can also use inline equation as $x=y$</li>
</ul>
<h4 id="4-note"><a class="header" href="#4-note">4. Note</a></h4>
<h3 id="2-name-of-function"><a class="header" href="#2-name-of-function">2. Name of function</a></h3>
<h4 id="1-overview-1"><a class="header" href="#1-overview-1">1. Overview</a></h4>
<h4 id="2-inputs-and-outputs-1"><a class="header" href="#2-inputs-and-outputs-1">2. Inputs and Outputs</a></h4>
<h4 id="3-algorithm-1"><a class="header" href="#3-algorithm-1">3. Algorithm</a></h4>
<h4 id="4-note-1"><a class="header" href="#4-note-1">4. Note</a></h4>
<h3 id="3-name-of-function"><a class="header" href="#3-name-of-function">3. Name of function</a></h3>
<h4 id="1-overview-2"><a class="header" href="#1-overview-2">1. Overview</a></h4>
<h2 id="3-results-of-verifications"><a class="header" href="#3-results-of-verifications">3. Results of verifications</a></h2>
<h3 id="1-name-of-verification-case"><a class="header" href="#1-name-of-verification-case">1. Name of verification case</a></h3>
<h4 id="1-overview-3"><a class="header" href="#1-overview-3">1. Overview</a></h4>
<ul>
<li>please write a reason why the author does the verification</li>
</ul>
<h4 id="2-conditions-for-the-verification"><a class="header" href="#2-conditions-for-the-verification">2. conditions for the verification</a></h4>
<ul>
<li>input files</li>
<li>initial values</li>
</ul>
<h4 id="3-result"><a class="header" href="#3-result">3. result</a></h4>
<ul>
<li>please use figures to show the results clearly</li>
<li>Upload the figure files in <code>figs</code> directory
<ul>
<li><strong>Note:</strong> the figure size should be smaller than several hundred K Bytes
<ul>
<li>Smaller is better </li>
</ul>
</li>
<li>Link the figure file with <strong>relative path</strong></li>
</ul>
</li>
</ul>
<h2 id="4-references"><a class="header" href="#4-references">4. References</a></h2>
<ol>
<li></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-build-and-execute-with-visual-studio"><a class="header" href="#how-to-build-and-execute-with-visual-studio">How to build and execute with Visual Studio</a></h1>
<h2 id="1--overview-1"><a class="header" href="#1--overview-1">1.  Overview</a></h2>
<p>This document explains how to build and execute the Visual Studio environment with CMake. Currently, we recommend using <code>VS2022</code>, but users can use <code>VS2019</code> and <code>VS2017</code> with minor modifications.</p>
<ul>
<li>Related files
<ul>
<li>./CmakeLists.txt
<ul>
<li>Base file for CMake</li>
</ul>
</li>
<li>./CMakeSettings.json
<ul>
<li>Setting file for VS to use CMake</li>
</ul>
</li>
<li>Other CMakeLists.txt in subdirectories</li>
</ul>
</li>
</ul>
<h2 id="2-environment-construction-of-visual-studio"><a class="header" href="#2-environment-construction-of-visual-studio">2. Environment Construction of Visual Studio</a></h2>
<ul>
<li>Install <a href="https://visualstudio.microsoft.com/vs/">Visual Studio 2022</a>
<ul>
<li>Select the following <code>Workloads</code> when installing the VS2022
<ul>
<li><code>Desktop development with C++</code></li>
</ul>
</li>
</ul>
</li>
<li>Clone <a href="https://github.com/ut-issl/s2e-core">s2e-core</a>
<ul>
<li>Please use <code>the latest release version</code>.</li>
<li>The following procedure possible does not work for <code>The latest develop branch</code>.</li>
</ul>
</li>
<li>Check that the <code>ExtLibraries</code> directory is in <strong>the same directory</strong> as the <code>s2e-core</code> like below.<pre>
├─ExtLibraries
└─s2e-core
</pre>
<ul>
<li>If not, please follow the procedure below to make <code>ExtLibraries</code>
<ul>
<li>Launch VS 2022</li>
<li>Open the CMake file for the <code>ExtLibraries</code>
<ul>
<li>Click <code>Files/Open/CMake</code>.</li>
<li>Select the following <code>s2e-core/ExtLibraries/CMakeLists.txt</code>.<pre>
└─s2e-core
   └─ExtLibraries
      └─CMakeLists.txt
</pre>
</li>
<li>Wait a moment until the <code>CMake generation</code> is finished.</li>
</ul>
</li>
<li>Install the <code>ExtLibraries</code>
<ul>
<li>Select <code>CMakeLists.txt</code> by right-clicking in the VS's <code>Solution Explorer</code>.</li>
<li>Click the <code>Install</code> command.</li>
<li>Wait a moment until the installation is successfully finished.</li>
</ul>
</li>
<li>Check that the <code>ExtLibraries</code> directory is in <strong>the same directory</strong> as the <code>s2e-core</code></li>
<li>Check there are <code>cspice</code> and <code>nrlmsise00</code> directories in the <code>ExtLibraries</code> like below.<pre>
├─ExtLibraries
│  └─cspice
│  └─GeoPotential
|  └─nrlmsise00
└─s2e-core
</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="3-the-flow-of-building-and-execution-in-visual-studio-2022"><a class="header" href="#3-the-flow-of-building-and-execution-in-visual-studio-2022">3. The flow of building and execution in Visual Studio 2022</a></h2>
<ol>
<li>
<p>Launch VS 2022</p>
</li>
<li>
<p>Open the S2E project</p>
<ul>
<li>Click <code>File/Open/CMake</code>.</li>
<li>Select <code>s2e-core/CMakeLists.txt</code> at the top directory of the cloned S2E.</li>
<li>Wait a moment until the <code>CMake generation</code> is finished.</li>
</ul>
</li>
<li>
<p>Build the S2E</p>
<ul>
<li>Select <code>CMakeLists.txt</code> by right-clicking in the VS's <code>Solution Explorer</code>.</li>
<li>Click the <code>Build</code> command.</li>
<li>Wait a moment until the build is successfully finished.</li>
</ul>
</li>
<li>
<p>Check errors</p>
<ul>
<li>When users edit the codes, please check the error and fix them.</li>
</ul>
</li>
<li>
<p>Run the program</p>
<ul>
<li>Select <code>S2E.exe</code> as the red circle of the following figure.
<img src="General/./figs/CMake_run.png" alt="" /></li>
<li>Click the <code>green play button</code> in the red circle to run the S2E.</li>
<li>A console window is opened, and users can see the S2E's running status.</li>
</ul>
</li>
<li>
<p>Check log files</p>
<ul>
<li>Open the <code>./data/***/logs/logs_***</code> directory.</li>
<li>Open the CSV file to check the log output of the S2E.</li>
</ul>
</li>
</ol>
<h2 id="4-note-2"><a class="header" href="#4-note-2">4. Note</a></h2>
<ul>
<li>For VS2019 users
<ul>
<li>Please edit the compiler setting in <code>CMakeSetting.json</code> as 
<pre><code>&quot;generator&quot;: &quot;Visual Studio 16 2019&quot;.
</code></pre>
</li>
</ul>
</li>
<li>For VS2017 users
<ul>
<li>Please edit the compiler setting in <code>CMakeSetting.json</code> as 
<pre><code>&quot;generator&quot;: &quot;Visual Studio 15 2017&quot;.
</code></pre>
</li>
<li>Users also need to edit the <code>cmake_minimum_required</code> version from 3.13 to 3.10 in all CMakeList, including the files in subdirectories. The VS 2017 does not support version 3.13, and you may see many <code>warnings</code> when you use CMake Version 3.10. </li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-compile-with-ubuntu-in-docker"><a class="header" href="#how-to-compile-with-ubuntu-in-docker">How to compile with Ubuntu in Docker</a></h1>
<h2 id="1--overview-2"><a class="header" href="#1--overview-2">1.  Overview</a></h2>
<ul>
<li><a href="https://www.docker.com/">Docker</a> is useful for the easy setup of the compile environment for S2E.</li>
<li><em>Both Windows and Mac</em> users can use the same environment and get the same result by using the docker container.</li>
<li>We selected <a href="https://ubuntu.com/">Ubuntu</a> as an OS in the docker image and <a href="https://gcc.gnu.org/">GCC/G++</a> as a compiler for S2E.<br />
<strong>Note</strong>: We currently use a 32bit compiler for S2E since flight S/Ws are usually executed on a 32bit microcomputers. </li>
<li>We recommend using <a href="https://code.visualstudio.com/">Visual Studio Code</a> as an editor for the environment.</li>
<li>This document explains a setup sequence of the docker environment for S2E.</li>
<li>Note: For a detailed explanation of Docker and VSCode's Extensions, please see the latest and official information.</li>
</ul>
<h2 id="2--install-required-application"><a class="header" href="#2--install-required-application">2.  Install Required Application</a></h2>
<h3 id="21-docker"><a class="header" href="#21-docker">2.1. Docker</a></h3>
<ul>
<li>Go to the <a href="https://docs.docker.com/get-docker/">install web page of Docker</a>.</li>
<li>Install <code>Docker for Windows</code> or <code>Docker for Mac</code> to suit your platform.</li>
</ul>
<h3 id="22-visual-studio-code-vs-code"><a class="header" href="#22-visual-studio-code-vs-code">2.2. Visual Studio Code (VS Code)</a></h3>
<ul>
<li>Go <a href="https://code.visualstudio.com/">install web page of VS Code</a>.</li>
<li>Install <code>Visual Studio Code</code> to suit your platform.</li>
<li>Install following extensions
<ul>
<li>Remote-SSH</li>
<li>CMake</li>
<li>CMake Tools</li>
<li>C/C++</li>
</ul>
</li>
<li>Following extensions are also useful
<ul>
<li>Code Spell Checker</li>
</ul>
</li>
</ul>
<h3 id="23-for-mac-users"><a class="header" href="#23-for-mac-users">2.3. <strong>For Mac users</strong></a></h3>
<ul>
<li>Install the <code>coreutils</code> to use the <code>realpath</code> command in <code>setup_docker.sh</code>
<ul>
<li>Use the <code>brew install coreutils</code> command when you have <code>Homebrew</code></li>
</ul>
</li>
</ul>
<h2 id="3-a-sequence-of-environment-setting"><a class="header" href="#3-a-sequence-of-environment-setting">3. A Sequence of environment setting</a></h2>
<h3 id="31-working-directory-setting"><a class="header" href="#31-working-directory-setting">3.1. Working directory setting</a></h3>
<ul>
<li>Create a <code>work</code> directory as a working directory.</li>
<li>Clone <a href="https://github.com/ut-issl/s2e-core">s2e-core</a> in the <code>work</code> directory.</li>
<li>Add the <code>work</code> directory in the <code>file sharing</code> directory of Docker.
<ul>
<li><strong>Note</strong>: This setting does not exist in the latest Docker and WSL2 environments in Windows, so it is not necessary.</li>
</ul>
</li>
</ul>
<h3 id="32-make-docker-image-and-container"><a class="header" href="#32-make-docker-image-and-container">3.2. Make Docker image and container</a></h3>
<ul>
<li>Launch <code>git bash</code> (for windows users) or <code>terminal</code> (for Mac users)</li>
<li>Move <code>/s2e-core/scripts/Docker_Ubuntu</code> directory</li>
<li>Edit <code>Dockerfile</code> or <code>setup_docker.sh</code> when you want to change the directory name, the user name of the container, and other settings.</li>
<li>Execute <code>./setup_docker.sh build</code> to make images</li>
<li>Check created images (<code>issl</code> (and <code>ubuntu</code>))
<ul>
<li>command: <code>docker images</code></li>
</ul>
</li>
<li>Execute <code>./setup_docker.sh run_core</code> to make the container</li>
<li>Check created container (<code>issl:latest</code>)
<ul>
<li>command: <code>docker ps -a</code></li>
</ul>
</li>
<li>Check the dashboard of Docker as follows.<div align="center">
  <img src="General/./figs/Docker_container.png" alt="DockerContainer" style="zoom:30%;" />
</div>
</li>
</ul>
<h3 id="33-ssh-connects-with-vs-code"><a class="header" href="#33-ssh-connects-with-vs-code">3.3. SSH connects with VS Code</a></h3>
<ul>
<li>Launch <code>VS Code</code> and open a new window.</li>
<li>Click the <code>Remote Explorer</code> icon on the left side.
<ul>
<li>Note: the icon looks like a monitor</li>
</ul>
</li>
<li>Click the <code>gear</code> icon of <code>SSH TARGETS</code> and select the config file you want to edit
<ul>
<li>Default: <code>C:\Users\UserName\ssh\config</code> or <code>User/UserName/ssh/config</code></li>
</ul>
</li>
<li>Edit the config file as follows
<pre><code>Host issl-1
  HostName localhost
  User s2e
  Port 2222
</code></pre>
</li>
<li>Save the config file and check a new SSH target <code>issl-1</code> is made in the explorer</li>
<li>Click <code>Connect to Host in New Window</code> icon on right side of <code>issl-1</code></li>
<li>Enter the password <code>s2e</code> when required</li>
<li>See left bottom icon <code>SSH:issl-1</code> to confirm the connection</li>
<li>Open the <code>work</code> directory in the container by using <code>Open folder</code><div align="center">
  <img src="General/./figs/VSC_SSH_connect.png" alt="VSC_SSH_connect" style="zoom:30%;" />
</div>
</li>
</ul>
<h3 id="34-download-external-libraries"><a class="header" href="#34-download-external-libraries">3.4. Download External Libraries</a></h3>
<p><strong>Note</strong> : This sequence was integrated within the docker build process, so this is currently unnecessary.</p>
<ul>
<li>S2E has several script files to get external libraries.</li>
<li>For this ubuntu/docker platform, users should use script files in <code>scripts/Common</code> directory and <code>scripts/Docker_Ubuntu</code> directory.</li>
<li>Users can execute most of the script files with <code>git bash</code> or <code>terminal</code> in the outside of the container, but users should execute <code>scripts/Common/download_nrlmsise00_src_and_table.sh</code> inside the container to use the same compiler.</li>
<li>Click <code>Terminal &gt; New terminal</code> in the menu bar of VS Code.</li>
<li>Select <code>bash</code> terminal at the bottom window.</li>
<li>Execute <code>./s2e-core/scripts/Common/download_nrlmsise00_src_and_table.sh</code>.</li>
<li>See <code>ExtLibraries</code> to confirm the NRLMSISE library is generated.</li>
</ul>
<h3 id="35-build-s2e"><a class="header" href="#35-build-s2e">3.5. Build S2E</a></h3>
<ul>
<li>Install the following extensions in the <code>issl-1 SSH connection</code><br />
Even if the extensions were already installed in local VS code, you also need to install them in the <code>SSH connection</code>.
<ul>
<li>C/C++</li>
<li>CMake</li>
<li>CMake Tools<br />
<strong>Note</strong> : You need to reload VS Code after installing new extensions</li>
</ul>
</li>
<li>Edit setting of <code>CMake Tools</code> in <code>issl-1</code>
<pre><code>Cmake Build Directory: ${workspaceFolder}/s2e-core/build/Debug
</code></pre>
</li>
<li>After <code>CMake</code> and <code>CMake Tools</code> are installed, VS Code requires you to configure the building environment with <code>CMakeList.txt</code>. Please select <code>yes</code>. However, there is no <code>CMakeList.txt</code> file in the <code>work</code> directory, and VS Code requires you to locate <code>CMakeList.txt</code>, so please select the <code>CMakeList.txt</code> file in <code>s2e-core</code> directory.
<ul>
<li>This setting is written in <code>.vscode/settings.json</code></li>
<li>You can directly edit the <code>settings.json</code> as follows
<pre><code class="language-json">{
  &quot;cmake.sourceDirectory&quot;: &quot;${workspaceFolder}/s2e-core&quot;,
  &quot;cmake.buildDirectory&quot;: &quot;${workspaceFolder}/s2e-core/build/Debug&quot;
}
</code></pre>
</li>
</ul>
</li>
<li>Select <code>GCC 11.2.0</code> as a kit (compiler)
<ul>
<li>Note: Users can also choose other GCC versions. </li>
</ul>
</li>
<li>Select <code>CMake [Debug]</code> and check the configuration is successfully done.</li>
<li>Build S2E
<ul>
<li>If you want to clean up, please use <code>CMake: Clean</code> command.</li>
</ul>
</li>
<li>Move to <code>build/Debug</code> directory with <code>Terminal</code> in VS Code.</li>
<li>Execute <code>./S2E</code> or click the <code>run</code> icon at the bottom.</li>
<li>Check the <code>data/log</code> directory to confirm log file output.</li>
</ul>
<h2 id="4-debug-with-vs-code"><a class="header" href="#4-debug-with-vs-code">4. Debug with VS Code</a></h2>
<ul>
<li>Select <code>Run &gt; Start Debugging</code> in the menu bar.</li>
<li>Select <code>C++(GDB/LLDB)</code> debugger
<ul>
<li>If <code>C++(GDB/LLDB)</code> is not shown, please open a CPP file and select <code>Run &gt; Start Debugging</code> again.</li>
<li><code>.vscode/launch.json</code> will be created.</li>
</ul>
</li>
<li>Edit as follows.
<pre><code class="language-json">&quot;program&quot;: &quot;${workspaceFolder}/s2e-core/build/Debug/S2E&quot;,
&quot;cwd&quot;: &quot;${workspaceFolder}/s2e-core/build/Debug&quot;,
</code></pre>
</li>
<li>Select <code>Run &gt; Start Debugging</code> again.</li>
<li>Check the <code>data/log</code> directory to confirm log file output.</li>
<li>You can use breakpoints in the VS Code editor.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-compile-with-osx-environment"><a class="header" href="#how-to-compile-with-osx-environment">How to compile with OSX Environment</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-download-and-make-nrlmsise00-library"><a class="header" href="#how-to-download-and-make-nrlmsise00-library">How to download and make NRLMSISE00 Library</a></h1>
<h2 id="1--overview-3"><a class="header" href="#1--overview-3">1.  Overview</a></h2>
<ul>
<li><a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2002JA009430">NRLMSISE00</a> is an atmosphere model to calculate an air density, considering the solar activity.</li>
<li><a href="https://git.linta.de/?p=~brodo/nrlmsise-00.git;a=summary">C language version of NRLMSISE00</a> is a mandatory library for S2E to calculate the atmosphere density around the Earth.</li>
<li>How to use NRLMSISE00 is written in the <a href="General/../Specifications/Environment/Spec_Atmosphere.html">Specification of Atmosphere model</a>.</li>
<li><strong>Note</strong> From the <a href="https://github.com/ut-issl/s2e-core/releases/tag/v5.0.0">s2e-core v5.0.0</a> we provide the CMake file to download and install the external libraries and recommend to use it since it is simpler. So users do not need to execute the following process.</li>
</ul>
<h2 id="2-how-to-set-up-nrlmsise00-for-s2e-old-descriptions"><a class="header" href="#2-how-to-set-up-nrlmsise00-for-s2e-old-descriptions">2. How to set up NRLMSISE00 for S2E [OLD Descriptions]</a></h2>
<ol>
<li>
<p>In any environment, run <code>s2e-core/scripts/Common/download_nrlmsise00_src_and_table.sh</code></p>
<ul>
<li>Source codes of NRLMSISE00 and <code>SpaceWeather.txt</code> will be downloaded, and <code>libnrlmsise00.a</code> will be made for Linux and OSX.
<ul>
<li>Users have to compile the codes using the same compiler with S2E. After these codes are downloaded, you can directly compile them by using makefile in the <code>ExtLibraries\nrlmsise00\src</code>.</li>
</ul>
</li>
<li>If you use Windows, a bash terminal for Windows (e.g. Git bash, WSL, MSYS) is needed to run this script, and you need to run an additional script. Proceed to Step 2.</li>
</ul>
</li>
<li>
<p>For Windows Visual Studio users, run <code>s2e-core/scripts/VisualStudio/make_nrlmsise00_VS32bit.bat</code> after the process 1.</p>
<ul>
<li>VS command prompt will be launched, then run <code>scripts/VisualStudio/make_libnrlmsise.bat</code> in VS command prompt.</li>
<li><code>libnrlmsise.lib</code>, which is the library for Windows Visual Studio will be made.</li>
<li>At the end of the procedure, you may see &quot;指定されたバッチ ラベルが見つかりません - END&quot;. If there is <code>libnrlmsise00.lib</code> in the right place and all the files are in the right place, you may ignore this message.</li>
</ul>
</li>
<li>
<p>Check your directories are as follows.</p>
</li>
</ol>
<pre>   
  ├─ExtLibraries  
  │  └─nrlmsise00
  │      ├─table 
  |      |  └─SpaceWeather.txt
  │      ├─lib
  |      |  |─libnrlmsise00.a
  |      |  └─libnrlmsise00.lib
  │      └─src
  |         └─nrlmsise-00.h
  └─s2e-core  
</pre>  
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-download-cspice-library"><a class="header" href="#how-to-download-cspice-library">How to download CSPICE Library</a></h1>
<h2 id="1--overview-4"><a class="header" href="#1--overview-4">1.  Overview</a></h2>
<ul>
<li><a href="https://naif.jpl.nasa.gov/pub/naif/toolkit_docs/C/info/intrdctn.html">SPICE</a> is a system to combine the most accurate space geometry and event data with space mission analysis, observation planning, or science data processing software developed by NASA.</li>
<li><a href="https://naif.jpl.nasa.gov/pub/naif/toolkit_docs/C/index.html">CSPICE</a> is the C language version of SPICE and mandatory library for S2E to get planet information.</li>
<li><strong>Note</strong> From the <a href="https://github.com/ut-issl/s2e-core/releases/tag/v5.0.0">s2e-core v5.0.0</a>, we provide the CMake file to download and install the external libraries and recommend to use it since it is simpler. So users do not need to execute the following process.</li>
</ul>
<h2 id="2-how-to-set-up-cspice-library-for-s2e-old-descriptions"><a class="header" href="#2-how-to-set-up-cspice-library-for-s2e-old-descriptions">2. How to set up CSPICE Library for S2E [OLD Descriptions]</a></h2>
<p><strong>Note</strong>: Users can use the script file to automatically set up the following process in the <code>s2e-core/script</code> directory. If the script does not work, please see the following process.</p>
<ul>
<li>Make directories as follow</li>
</ul>
<pre>   
  ├─ExtLibraries  
  │  └─cspice  
  │      ├─cspice_xxx  
  │      │  └─lib  
  │      ├─generic_kernels  
  │      └─include  
  └─s2e-core  
</pre>  
<ul>
<li>
<p>xxx is depends on your compile environment</p>
<ul>
<li><code>xxx = msvs</code> for Microsoft Visual Studio</li>
<li><code>xxx = cygwin</code> for Cygwin gCC</li>
<li><code>xxx = unix</code> for Linux gCC</li>
</ul>
</li>
<li>
<p>Download library and compile</p>
<ul>
<li>Download <code>cspice.zip</code> from <a href="https://naif.jpl.nasa.gov/naif/toolkit_C.html">NAIF Toolkit</a>, and unzip.</li>
<li>You need to choose a link suit with your compile environment</li>
<li>Copy <code>include</code> directory into <code>cspice</code> directory</li>
<li>Copy <code>lib</code> or <code>lib64</code> directory into <code>cspice_***</code> directory
<ul>
<li>VS 2019 users need to compile the library before copying the <code>lib</code>
<ul>
<li>launch following command prompt for VS2019 compile from the start menu of Windows
<ul>
<li>32bit:  <code>x86 Native tools command prompt for VS2019</code> </li>
<li>64bit:  <code>x64 Native tools command prompt for VS2019</code> </li>
</ul>
</li>
<li>Move to the unzipped directory and execute <code>makeall.bat</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Download kernel files</p>
<ul>
<li>Download the following kernel files from <a href="https://naif.jpl.nasa.gov/pub/naif/generic_kernels/">NAIF Generic Kernels</a>, and copy them to the directories
<ul>
<li>Each kernel file can be updated for the latest one, but we have not confirmed it yet.</li>
</ul>
</li>
</ul>
<pre>         
      ├─generic_kernels  
      │  ├─lsk  
      │      └─naif0010.tls  
      │  ├─pck  
      │      └─de-403-masses.tpc  
      │      └─gm_de431.tpc  
      │      └─pck00010.tpc  
      │  └─spk  
      │      └─planets  
      │  │      └─de430.bsp  
</pre>
</li>
</ul>
<p><strong>Note:</strong> When you change the directory or file name, you should modify <code>s2e-core/CMakeLists</code> and <code>PlanetSelect.ini</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<h2 id="1--overview-5"><a class="header" href="#1--overview-5">1.  Overview</a></h2>
<ul>
<li>This tutorial explains how to use the S2E simulator without any source code modification.</li>
<li>Users can start this tutorial just after users clone the <a href="https://github.com/ut-issl/s2e-core">s2e-core</a> repository. </li>
<li>The supported version of this document
<ul>
<li>Please confirm that the version of the documents and s2e-core is compatible.</li>
</ul>
</li>
</ul>
<h2 id="2-clone-build-and-execute"><a class="header" href="#2-clone-build-and-execute">2. Clone, Build, and Execute</a></h2>
<ol>
<li>Clone <a href="https://github.com/ut-issl/s2e-core">s2e-core</a>.</li>
<li>Read <code>README.md</code> to check the overview of S2E.</li>
<li>Build and execute the <code>s2e-core</code> by referring following documents depends on your development environment.
<ul>
<li><a href="Tutorials/../General/HowToCompileWithVisualStudio.html">How to compile with Visual Studio</a></li>
<li><a href="Tutorials/../General/HowToCompileWithUbuntuInDocker.html">How to compile with Ubuntu</a></li>
</ul>
</li>
</ol>
<h2 id="3-check-log-output"><a class="header" href="#3-check-log-output">3. Check log output</a></h2>
<ol>
<li>Check <code>./data/sample/logs</code> to find CSV log output file
<ul>
<li>The file name includes executed time as <code>YYMMDD_HHMMSS_default.csv</code></li>
<li>The included executed time is defined by the user computer settings.</li>
</ul>
</li>
<li>Open the CSV log file</li>
<li>You can see the simulation output</li>
<li>The meaning of each value is described in the first row
<ul>
<li>A general rule of the header descriptions are summarized <a href="Tutorials/../General/NamingRuleForUserInterface.html">here</a>.</li>
</ul>
</li>
<li>You can write a graph from the CSV file as you need.
<ul>
<li>You can find plot examples written in Python in the <code>scripts/Plot</code> directory.</li>
<li>Please see <a href="Tutorials/../General/HowToVisualizeSimulationResults.html">How to Visualize Simulation Results</a> for more details.</li>
</ul>
</li>
</ol>
<h2 id="4-edit-simulation-conditions"><a class="header" href="#4-edit-simulation-conditions">4. Edit Simulation Conditions</a></h2>
<ol>
<li>Move to <code>./data/sample/initialize_files</code>  directory</li>
<li>You can find the several <strong>initialize</strong> files (<a href="https://en.wikipedia.org/wiki/INI_file">INI files</a>). In these initialize files, simulation conditions are defined, and you can change the conditions without rebuild of S2E by editing the initialize files.</li>
<li>Open <code>sample_simulation_base.ini</code>, which is the base file of the initialize files.
<ul>
<li>In this base file, other initialize files are defined.</li>
<li>You can see simulation conditions as time definitions, randomize seed definitions, etc. </li>
</ul>
</li>
<li>Open <code>sample_satellite.ini</code>, which is the file to set the spacecraft parameters.</li>
<li>Edit the value of angular momentum <code>initial_angular_velocity_b_rad_s(0-2)</code> in the <code>[Attitude]</code> section as you want.</li>
<li>Set the value of <code>initialize_mode</code> to <code>MANUAL</code> if it is <code>CONTROLLED</code>.</li>
<li>Rerun the <code>s2e-core</code> <strong>without a rebuild</strong></li>
<li>Check the new log file in <code>./data/sample/logs</code> to confirm the initial angular velocity is changed as you want.</li>
<li>Of course, you can change other values similarly.</li>
</ol>
<h2 id="5-edit-simulation-conditions-disturbances"><a class="header" href="#5-edit-simulation-conditions-disturbances">5. Edit Simulation Conditions: Disturbances</a></h2>
<ol>
<li>Move to <code>./data/sample/ini</code>  directory again</li>
<li>Open <code>sample_disturbance.ini</code>, which defines conditions to calculate orbital disturbance torques and forces
<ul>
<li>Currently, S2E supports the following disturbances:
<ul>
<li>Gravity Gradient torque</li>
<li>Magnetic Disturbance torque</li>
<li>Air drag torque and force</li>
<li>Solar radiation pressure torque and force</li>
<li>Geo Potential acceleration</li>
<li>Third body gravity acceleration</li>
</ul>
</li>
</ul>
</li>
<li>You can select <code>ENABLE</code> or <code>DISABLE</code> of calculation and log output for each disturbance</li>
<li>Edit all <code>calculation</code> parameters of each disturbance as <code>calculation = DISABLE</code></li>
<li>Rerun the <code>s2e-core</code> <strong>without a rebuild</strong></li>
<li>Check the new log file in <code>./data/sample/logs</code> to confirm the spacecraft is not affected by any disturbance torque and the angular velocity and quaternion are not changed. You can also plot by following command and see all the disturbance torque and force are zero. (assuming you already created a <code>pipenv</code> virtual environment)
<pre><code># Windows
cd scripts/Plot
pipenv run python .\plot_disturbance_torque.py --file-tag &lt;log file tag&gt;
pipenv run python .\plot_disturbance_force.py --file-tag &lt;log file tag&gt;
</code></pre>
</li>
<li>Edit  <code>calculation</code> of [THIRD_BODY_GRAVITY] as <code>calculation = ENABLE</code></li>
<li>Rerun the S2E_CORE <strong>without a rebuild</strong></li>
<li>Rerun the python script to check the third body gravity is generated.</li>
</ol>
<h2 id="6-edit-simulation-conditions-orbit"><a class="header" href="#6-edit-simulation-conditions-orbit">6. Edit Simulation Conditions: Orbit</a></h2>
<ol>
<li>
<p>Move to <code>./data/sample/ini</code>  directory</p>
</li>
<li>
<p>Open <code>sample_satellite.ini</code> and see the <code>[Orbit]</code> section, which defines conditions to calculate orbit motion</p>
<ul>
<li>Currently, S2E supports several types of orbit propagation. Please see <a href="Tutorials/./Specifications/Dynamics/Spec_Orbit.html">Orbit</a> specification documents for more details.</li>
</ul>
</li>
<li>
<p>Please set the parameters as follow:</p>
<ul>
<li><code>propagate_mode = SGP4</code>: SGP4 Propagator</li>
<li><code>initialize_mode</code> is not used in the SGP4 propagate mode.</li>
<li>TLE: ISS orbit (default)</li>
</ul>
</li>
<li>
<p>To get a long-term orbit simulation data, edit the following simulation time settings in <code>sample_simulation_base.ini</code></p>
<ul>
<li><code>simulation_duration_s = 6000</code></li>
<li><code>log_output_period_s = 10</code> (to decrease the output file size)</li>
</ul>
</li>
<li>
<p>To visualize the orbit result, execute the <code>plot_satellite_orbit_on_miller.py</code> and <code>plot_orbit_eci.py</code> by following command. You can see the plots as follows. Please see <a href="Tutorials/../General/HowToVisualizeSimulationResults.html">general</a> documents for more details on visualization of simulation results.</p>
<pre><code># Windows
cd scripts/Plot
pipenv run python .\plot_satellite_orbit_on_miller.py --file-tag &lt;log file tag&gt;
pipenv run python .\plot_orbit_eci.py --file-tag &lt;log file tag&gt;
</code></pre>
<p><img src="Tutorials/./figs/GettingStarted_PlotIssOrbitInMiller.JPG" alt="" />
<img src="Tutorials/./figs/GettingStarted_PlotIssOrbit3d.JPG" alt="" /></p>
</li>
<li>
<p>Change TLE as you want</p>
<ul>
<li>Example: PRISM (Hitomi)
<pre><code>tle1=1 33493U 09002B   22331.71920614  .00003745  00000-0  29350-3 0  9995
tle2=2 33493  98.2516 327.9413 0016885   9.3461 350.8072 15.01563916753462
</code></pre>
</li>
</ul>
</li>
<li>
<p>Rerun the <code>s2e-core</code> <strong>without a rebuild</strong></p>
</li>
<li>
<p>Check the new log file in <code>./data/sample/logs</code> to confirm the spacecraft position in ECI frame <code>spacecraft_position_i</code> is changed.</p>
</li>
<li>
<p>To visualize the orbit result, execute the <code>plot_satellite_orbit_on_miller.py</code> and <code>plot_orbit_eci.py</code>. You can see the different plots as follows.<br />
<img src="Tutorials/./figs/GettingStarted_PlotPrismOrbitInMiller.JPG" alt="" />
<img src="Tutorials/./figs/GettingStarted_PlotPrismOrbit3d.JPG" alt="" /></p>
</li>
</ol>
<h2 id="7-edit-simulation-conditions-environment"><a class="header" href="#7-edit-simulation-conditions-environment">7. Edit Simulation Conditions: Environment</a></h2>
<ol>
<li>Move to <code>./data/sample/ini</code>  directory</li>
<li>Open <code>sample_local_environment.ini</code>, which defines conditions to calculate the environment around the spacecraft
<ul>
<li>Currently, S2E supports the following environment models:
<ul>
<li>Celestial information: CSPICE</li>
<li>Geomagnetic field model: IGRF with random variation</li>
<li>Solar power model: Considering solar distance and eclipse</li>
<li>Air density: NRLMSISE-00 model with random variation</li>
</ul>
</li>
</ul>
</li>
<li>Edit values of <code>magnetic_field_random_walk_standard_deviation_nT, magnetic_field_random_walk_limit_nT, magnetic_field_white_noise_standard_deviation_nT</code> </li>
<li>Rerun the <code>s2e-core</code> <strong>without a rebuild</strong></li>
<li>Check the new log file in <code>./data/sample/logs</code> to confirm the magnetic field at the spacecraft position in ECI frame <code>geomagnetic_field_at_spacecraft_position_i</code>, the magnetic field in body frame <code>geomagnetic_field_at_spacecraft_position_b</code>, and magnetic disturbance torque in body frame <code>magnetic_disturbance_torque_b</code> are changed.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-make-new-simulation-scenario"><a class="header" href="#how-to-make-new-simulation-scenario">How To Make New Simulation Scenario</a></h1>
<h2 id="1--overview-6"><a class="header" href="#1--overview-6">1.  Overview</a></h2>
<ul>
<li>In the <a href="Tutorials/./GettingStarted.html">Getting Started</a> tutorial, we can directly build and execute <code>s2e-core</code>, but for <strong>source code sharing</strong> and practical usage of S2E, we <strong>strongly recommend managing s2e-core and s2e-user repository separately</strong>.
<ul>
<li><a href="https://github.com/ut-issl/s2e-core">s2e-core</a> repository is shared with other users. Most of the source files are in this core repository. The codes are used as a library by the <code>s2e-user</code> repository.</li>
<li><code>s2e-user</code> repository is an independent repository  for <strong>each spacecraft project or research project</strong>. This repository includes the following parts:
<ul>
<li>Source codes for the <code>main</code></li>
<li>Source codes for <code>simulation scenario</code></li>
<li>Source codes for <code>components</code> if the target spacecraft has components, which strongly depends on your project.</li>
<li><code>Initialize files</code></li>
<li><code>Compile setting</code> files as <a href="https://cmake.org/">CMake files</a>, <a href="https://visualstudio.microsoft.com/downloads/">Visual Studio Solution files</a>, or others. </li>
</ul>
</li>
</ul>
</li>
<li>This tutorial explains an example of how to make <code>s2e-user</code> repository and execute it.</li>
<li>The supported version of this document
<ul>
<li>Please confirm that the version of the documents and <code>s2e-core</code> is compatible.</li>
</ul>
</li>
</ul>
<h2 id="2-structure-of-s2e-user-directory"><a class="header" href="#2-structure-of-s2e-user-directory">2. Structure of S2E-USER directory</a></h2>
<ul>
<li>
<p>We provides a sample of a s2e-user repository as <a href="https://github.com/ut-issl/s2e-user-example">s2e-user-example</a>.</p>
</li>
<li>
<p>The repository is constructed as follows.</p>
<ul>
<li>The repository includes <code>s2e-core</code> by using <code>git submodule</code> feature.</li>
<li>The <code>ExtLibraries</code> for the user side repository should be generated by using the <code>CMake</code> files in the <code>s2e-core</code>.</li>
</ul>
<pre><code>└─ s2e-user-example
   └─ src
   └─ data
   └─ s2e-core (git submodule)
   └─ ExtLibraries (generated by the following procedure)
   └─ other files
</code></pre>
</li>
</ul>
<h2 id="3-setup-s2e-user-example"><a class="header" href="#3-setup-s2e-user-example">3. Setup s2e-user-example</a></h2>
<ol>
<li>
<p>Clone <a href="https://github.com/ut-issl/s2e-user-example">s2e-user-example</a> repository in a working directory. </p>
<ul>
<li>Because the repository includes <a href="https://github.com/ut-issl/s2e-core">s2e-core</a> with the <code>git submodule</code>, please use the following commands to construct the directory.
<pre><code>$ git clone git@github.com:ut-issl/s2e-user-example.git
$ cd s2e-user-example/
$ git submodule init
$ git submodule update
</code></pre>
Or use the following command to clone the repository.
<pre><code>$ git clone --recursive git@github.com:ut-issl/s2e-user-example.git
</code></pre>
</li>
</ul>
</li>
<li>
<p>Download mandatory <code>ExtLibraries</code> (CSPICE and NRLMSISE-00).</p>
<ul>
<li>Users need to use the <code>CMakeList.txt</code> in the <code>s2e-user-example/s2e-core/ExtLibraries</code> to download the mandatory external libraries.</li>
<li>The construction procedure is same with the s2e-core. Please see a <code>How To Build</code> document suit with your platform.
<pre><code>└─ s2e-user-example
   └─ src
   └─ data
   └─ s2e-core (git submodule)
     └─ ExtLibraries
       └─ CMakeLists.txt (Use this file in this step)
   └─ ExtLibraries (This directory is generated by this step)
     └─ cspice
     └─ GeoPotential 
     └─ nrlmsise00
</code></pre>
</li>
</ul>
</li>
<li>
<p>According to the <code>How To Build</code> document, use the <code>s2e-user-example/CMakeList.txt</code> and build the s2e-user.</p>
</li>
<li>
<p>Execute and check the <code>s2e-user/data/logs</code>.</p>
</li>
<li>
<p>Similar to <a href="Tutorials/./GettingStarted.html">Getting Started</a>, you can edit initialize files in <code>s2e-user-example/data/initialize_files</code> and check the log file.</p>
</li>
</ol>
<p><strong>Note:</strong> Users can use other characters instead of <code>user</code> for a practical case.  For example, you can name it <code>s2e_equuleus</code> to indicate the EQUULEUS spacecraft project. </p>
<h2 id="4--overview-of-s2e-user-example"><a class="header" href="#4--overview-of-s2e-user-example">4.  Overview of S2E-USER-EXAMPLE</a></h2>
<ul>
<li>This chapter explains the overview of the <code>main</code> branch of the <code>s2e-user-example</code>.</li>
<li>The files in the directory are as follows. From here, the detail of each file is described.
<pre><code>└─ s2e-user-example
  └─ CMakeLists.txt  
  └─ CMakeSetting.json  
  └─ data  
    └─ initialize_files
    └─ logs
  └─ src  
    └─ simulation
      └─ case
        └─ user_case.cpp
        └─ user_case.hpp
      └─ Spacecraft
        └─ user_components.cpp  
        └─ user_components.hpp
        └─ user_satellite.cpp
        └─ user_satellite.hpp
    └─ s2e_user.cpp
  └─ s2e-core (git submodule)  
</code></pre>
</li>
</ul>
<ol>
<li>
<p><code>CMakeLists.txt</code> and <code>CMakeSetting.json</code></p>
<ul>
<li><code>CMakeLists.txt</code> is a <a href="https://cmake.org/">CMake file</a> for a compile setting.
<ul>
<li>Details of description rules for CMake files can be searched on the internet, so please refer to them.</li>
<li>When you add new source files, the new files is automatically included as the build target. If you do not include them, please add them to excluding list in the <code>CMakeList.txt</code>.</li>
</ul>
</li>
<li><code>CMakeSetting.json </code> is a compile setting file for Visual Studio.</li>
</ul>
</li>
<li>
<p><code>data/initialize_files</code> and <code>data/logs</code></p>
<ul>
<li>In the <code>initialize_files</code> directory, there are several initialize files.
<ul>
<li>The most important initialize file is <code>user_simulation_base.ini</code>.</li>
<li>Other initialize files are defined in this base initialize file. So you need to edit the file names in the base file when you modify the name of other initialize files.
<ul>
<li>When you change the name of the base file, you have to edit <code>s2e_user.cpp</code>.</li>
</ul>
</li>
<li>Details of the initialize files are described in <code>Specifications</code>.
<ul>
<li>Basic files are described in <a href="Tutorials/./GettingStarted.html">Getting Started</a>.</li>
</ul>
</li>
</ul>
</li>
<li><code>logs</code>
<ul>
<li>CSV log files will be outputted here. The output directory is also defined in <code>user_simulation_base.ini</code>, so that you can change it.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>src/s2e_user.cpp</code></p>
<ul>
<li>This is the main file of this program.</li>
<li>In this code, <code>user_simulation_base.ini</code> is defined as the base file for the simulation, and an instance of the <code>SimulationCase</code> class named <code>UserCase</code> is created and initialized. And finally, the main routine of the class is executed.</li>
</ul>
</li>
<li>
<p><code>src/simulation/case/user_case.cpp, .hpp</code></p>
<ul>
<li><code>UserCase</code> class is defined here. <code>UserCase</code> class inherits the <code>SimulationCase</code> base class in the <code>s2e-core</code>. The <code>SimulationCase</code> class has a <code>SimulationConfiguration</code> and <code>GlobalEnvironment</code> class. The <code>UserCase</code> class has an instance of the <code>spacecraft</code> class named as <code>UserSatellite</code>.</li>
</ul>
</li>
<li>
<p><code>src/simulation/spacecraft/user_satellite.cpp, .hpp</code></p>
<ul>
<li><code>UserSatellite</code> class is defined here. <code>UserSatellite</code> class inherits the <code>Spacecraft</code> class in the <code>s2e-core</code>. The <code>Spacecraft</code> base class has instances of <code>Dynamics</code>, <code>LocalEnvironment</code>, <code>Disturbance</code>, and <code>Structure</code>. And the <code>UserSatellite</code> class has an instance of <code>UserComponents</code>.</li>
</ul>
</li>
<li>
<p><code>src/simulation/spacecraft/user_components.cpp, .hpp</code></p>
<ul>
<li>The <code>UserComponents</code> class is defined here. Most users edit this code to custom the S2E for their satellite projects.</li>
<li>Users select components they want to use from the <code>s2e-core/src/components</code>.</li>
<li>You can add new source codes in the <code>s2e-user/components</code> directory if you want to make original components.</li>
</ul>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-add-components"><a class="header" href="#how-to-add-components">How To Add Components</a></h1>
<h2 id="1--overview-7"><a class="header" href="#1--overview-7">1.  Overview</a></h2>
<ul>
<li>In the <a href="Tutorials/./HowToMakeNewSimulationScenario.html">How To Make New Simulation Scenario</a> tutorial, we have made an <code>s2e-user</code> directory for our simulation scenario.</li>
<li>This tutorial explains how to add components to your scenario.</li>
<li>A similar procedure is available for other components in the <code>s2e-core</code>.
<ul>
<li>Please see the components listed in the <a href="https://github.com/ut-issl/s2e-core/tree/develop/src/components">components directory</a>.</li>
</ul>
</li>
<li>The supported version of this document
<ul>
<li>Please confirm that the version of the documents and s2e-core is compatible.</li>
</ul>
</li>
</ul>
<h2 id="2-add-a-gyro-sensor"><a class="header" href="#2-add-a-gyro-sensor">2. Add a Gyro sensor</a></h2>
<ul>
<li>This chapter explains how to add a gyro sensor component to your <code>s2e-user</code> simulation case step by step.</li>
<li>Users can find the sample code of this section in <a href="https://github.com/ut-issl/s2e-user-example/tree/sample/how-to-add-components">s2e-user-example/sample/how-to-add-components</a>.</li>
</ul>
<ol>
<li>
<p>Open &amp; edit <code>user_components.hpp</code></p>
<ul>
<li>Add the following descriptions at the one line below of <code>#include &lt;components/real/cdh/on_board_computer.hpp&gt;</code>
<pre><code class="language-c++">#include &lt;components/real/aocs/initialize_gyro_sensor.hpp&gt;
</code></pre>
</li>
<li>Add the following descriptions at the one line below of <code>  OnBoardComputer *obc_;  //!&lt; Onboard Computer</code>
<pre><code class="language-c++">GyroSensor *gyro_sensor_;  //!&lt; Gyro sensor
</code></pre>
</li>
</ul>
</li>
<li>
<p>Open and edit <code>user_components.cpp</code></p>
<ul>
<li>
<p>Edit the constructor function as follows to create an instance of the <code>GyroSensor</code> class at the one line below of <code>obc_ = new OnBoardComputer(clock_generator);</code>.</p>
<pre><code class="language-c++">// Common
IniAccess iniAccess = IniAccess(configuration_-&gt;spacecraft_file_list_[spacecraft_id]);
const double compo_step_sec = global_environment_-&gt;GetSimulationTime().GetComponentStepTime_s();

// Initialize of GYRO class
std::string file_name = iniAccess.ReadString(&quot;COMPONENT_FILES&quot;, &quot;gyro_file&quot;);
configuration_-&gt;main_logger_-&gt;CopyFileToLogDirectory(file_name);
gyro_sensor_ = new GyroSensor(InitGyroSensor(clock_generator, 1, file_name, compo_step_sec, dynamics));
</code></pre>
</li>
<li>
<p>Add the following descriptions at the one line up of <code>delete obc_;</code> in the destructor.</p>
<pre><code class="language-c++">delete gyro_sensor_;
</code></pre>
</li>
<li>
<p>Edit the <code>LogSetup</code> function as follows to register log output</p>
<pre><code class="language-c++">void UserComponents::LogSetup(Logger &amp;logger) { logger.AddLogList(gyro_sensor_); }
</code></pre>
</li>
</ul>
</li>
<li>
<p>Open <code>user_satellite.ini</code> and edit <code>initial_angular_velocity_b_rad_s</code> to add initial angular velocity.</p>
<ul>
<li>Users can select any value.</li>
</ul>
</li>
<li>
<p>Add the following descriptions at the bottom line of <code>[COMPONENT_FILES]</code> to set the initialize file for the gyro sensor.</p>
<pre><code class="language-c++">gyro_file = ../../data/initialize_files/components/gyro_sensor_xxx.ini
</code></pre>
</li>
<li>
<p>Build the <code>s2e-user</code> and execute it</p>
</li>
<li>
<p>Check the log output file to find <code>gyro_sensor1_measured_angular_velocity_c</code>, the gyro sensor's output angular velocity value in the component frame.</p>
<ul>
<li>Since the default initializing file is described as that the sensor has no noise, the value of <code>gyro_sensor1_measured_angular_velocity_c</code> and <code>spacecraft_angular_velocity_b</code> is completely the same.</li>
</ul>
</li>
<li>
<p>Edit the <code>data/initialize_files/components/gyro_sensor_xxx.ini</code> file to add several noises, and rerun the <code>s2e-user</code></p>
</li>
<li>
<p>Check the log output file to find <code>gyro_sensor1_measured_angular_velocity_c</code>. Now the sensor output has several errors you set in the initialize file like the following figure.</p>
<ul>
<li>We edited the file as <code>constant_bias_c_rad_s(0) = 0.001</code> and <code>normal_random_standard_deviation_c_rad_s(0) = 0.001</code> to get the following figure.</li>
</ul>
<img src="Tutorials/./figs/AngularVelocityTrueVsGyro.png" alt="AngularVelocityTrueVsGyro" style="zoom: 67%;" />
</li>
</ol>
<h2 id="3-add-another-gyro-sensor"><a class="header" href="#3-add-another-gyro-sensor">3. Add another Gyro sensor</a></h2>
<ul>
<li>You can add multiple components in your <code>s2e-user</code> simulation case similar to the above sequence.</li>
</ul>
<ol>
<li>
<p>Open <code>user_components.hpp</code></p>
</li>
<li>
<p>Add the following descriptions at the one line below of <code>GyroSensor *gyro_sensor_;</code></p>
<pre><code class="language-c++">GyroSensor *gyro_sensor_2_;  //!&lt; Gyro sensor 2
</code></pre>
</li>
<li>
<p>Open <code>user_components.cpp</code></p>
</li>
<li>
<p>Edit the constructor function to add the following description to create the second instance of the GYRO class</p>
<pre><code class="language-c++">file_name = iniAccess.ReadString(&quot;COMPONENT_FILES&quot;, &quot;gyro_file_2&quot;);
configuration_-&gt;main_logger_-&gt;CopyFileToLogDirectory(file_name);
gyro_sensor_2_ = new GyroSensor(InitGyroSensor(clock_generator, 2, file_name, compo_step_sec, dynamics));
</code></pre>
</li>
<li>
<p>Add the following descriptions at the one line below of <code>delete gyro_;</code> in the destructor</p>
<pre><code class="language-c++">delete gyro_sensor_2_;
</code></pre>
</li>
<li>
<p>Edit the <code>LogSetUp</code> function as follows to register log output</p>
<pre><code class="language-c++">void UserComponents::LogSetup(Logger &amp;logger) {
  logger.AddLogList(gyro_sensor_);
  logger.AddLogList(gyro_sensor_2_);
}
</code></pre>
</li>
<li>
<p>Open <code>user_satellite.ini</code></p>
</li>
<li>
<p>Add the following descriptions at the bottom line of <code>[COMPONENT_FILES]</code> to set the initialize file for the gyro sensor</p>
<pre><code class="language-c++">gyro_file_2 = ../../data/initialize_files/components/gyro_sensor_yyy.ini
</code></pre>
</li>
<li>
<p>Copy the <code>data/initialize_files/components/gyro_sensor_xxx.ini</code> file and rename it as <code>gyro_sensor_yyy.ini</code></p>
</li>
<li>
<p>Edit <code>gyro_sensor_yyy.ini</code> to custom the noise performance of the second gyro sensor</p>
<ul>
<li>Edit sensor ID like <code>[GYRO_SENSOR_1]</code> to <code>[GYRO_SENSOR_2]</code></li>
<li>Edit sensor ID like <code>[SENSOR_BASE_GYRO_SENSOR_1]</code> to <code>[SENSOR_BASE_GYRO_SENSOR_2]</code></li>
</ul>
</li>
<li>
<p>Build the <code>s2e-user</code> and execute it</p>
</li>
<li>
<p>Check the log output file to find <code>gyro_sensor2_measured_angular_velocity_c</code>, the second gyro sensor's output angular velocity value in the component frame.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-make-new-components"><a class="header" href="#how-to-make-new-components">How To Make New Components</a></h1>
<h2 id="1--overview-8"><a class="header" href="#1--overview-8">1.  Overview</a></h2>
<ul>
<li>In the <a href="Tutorials/./HowToAddComponents.html">How To Add Components</a> tutorial, we have added existing components to the simulation scenario.</li>
<li>This tutorial explains how to make a new component into the s2e-user directory.
<ul>
<li><strong>Note</strong>: You can move the source files for the new component into the <a href="https://github.com/ut-issl/s2e-core">s2e-core</a> repository if the component is useful for all S2E users.</li>
</ul>
</li>
<li>The supported version of this document
<ul>
<li>Please confirm that the version of the documents and s2e-core is compatible.</li>
</ul>
</li>
</ul>
<h2 id="2-overview-of-component-expression-in-s2e"><a class="header" href="#2-overview-of-component-expression-in-s2e">2. Overview of component expression in S2E</a></h2>
<ul>
<li>Source codes emulating components are stored in the <code>s2e-core/src/components</code> directory.</li>
<li>All components need to inherit the base class <code>Component</code> for general functions of components, and most of the components also inherit the base class <code>ILoggable</code> for the log output function.</li>
<li><code>Component</code> class
<ul>
<li>The base class has an important virtual function <code>MainRoutine</code>, and subclasses need to define it in their codes.
<ul>
<li>When an instance of the component class is created, the <code>MainRoutine</code> function is registered in the <code>TickToComponent</code>, and it will be automatically executed in the <code>Spacecraft</code> class.</li>
<li>The main features of the components such as observation, generate force, noise addition, communication, etc... should be written in this function.</li>
</ul>
</li>
<li><code>PowerOffRoutine</code> is also important especially for actuators. This function is called when the component power line is turned off. Users can stop force and torque generation and initialize the component states.</li>
</ul>
</li>
<li>Power related functions
<ul>
<li><code>SetPowerState</code> and <code>GetCurrent</code> are power related functions. If you want to emulate power consumption and switch control, you need to use the functions.</li>
</ul>
</li>
<li><code>ILoggable</code> class
<ul>
<li>This base class has two important virtual functions <code>GetLogHeader</code> and <code>GetLogValue</code>, for CSV log output.</li>
<li>These functions are registered into the log output list when the components are added in <code>UserComponents::LogSetUp</code> </li>
</ul>
</li>
<li>Communication with OBC
<ul>
<li>If users want to emulate the communication(telemetry and command) between the components and the OBC, they can use the base class <code>UartCommunicationWithObc</code> or <code>I2cTargetCommunicationWithObc</code>.</li>
<li>These base classes also support a feature to execute HILS function.</li>
</ul>
</li>
</ul>
<h2 id="3-make-a-simple-clock-sensor-without-initialize-file"><a class="header" href="#3-make-a-simple-clock-sensor-without-initialize-file">3. Make a simple clock sensor without initialize file</a></h2>
<ul>
<li>This chapter explains how to make a simple clock sensor, which observes the simulation elapsed time with a bias noise.</li>
<li>Users can find the sample codes in <a href="https://github.com/ut-issl/s2e-user-example/tree/sample/how-to-make-new-components">s2e-user-example/sample/how-to-make-new-components</a>.
<ul>
<li>The sample codes already including the initialize file for the <code>ClockSensor</code>. Please edit the code a bit to learn the procedure step by step.</li>
</ul>
</li>
</ul>
<ol>
<li>
<p>The <code>clock_sensor.cpp, .hpp</code> are created in the <code>components</code> directory. </p>
<ul>
<li>The <code>ClockSensor</code> class counts clock with a constant bias noise.</li>
<li>The class inherits the <code>Component</code> and the <code>ILoggable</code> base classes as explained above.</li>
</ul>
</li>
<li>
<p>The <code>user_components.hpp</code> and <code>user_components.cpp</code> are edit similar procedure with the <a href="Tutorials/./HowToAddComponents.html">How To Add Components</a></p>
<ul>
<li>The constructor of the <code>ClockSensor</code> requires arguments as <code>prescaler</code>, <code>clock_generator</code>, <code>simulation_time</code>, and <code>bias_s</code>.</li>
<li><code>prescaler</code> and <code>bias_s</code> are user setting parameters for the sensor, and you can freely set these values.</li>
<li><code>clock_generator</code> is an argument for the <code>Component</code> base class.</li>
<li><code>simulation_time</code> is a specific argument for the <code>ClockSensor</code> to get true time information. The <code>SimulationTime</code> class is managed in the <code>GlobalEnvironment</code>, and the <code>GlobalEnvironment</code> is instantiated in the <code>SimulationCase</code> class.</li>
<li>We need to add the following codes to <code>user_components.cpp</code>.
<ul>
<li>Instantiate the <code>ClockSensor</code> in the constructor.</li>
</ul>
<pre><code class="language-c++">clock_sensor_ = new ClockSensor(10, clock_generator, global_environment-&gt;GetSimulationTime(), 0.001);
</code></pre>
<ul>
<li>Delete the <code>clock_sensor_</code> in the destructor.</li>
</ul>
<pre><code class="language-c++">delete clock_sensor_;
</code></pre>
<ul>
<li>Add log set up into the <code>LogSetUp</code> function.</li>
</ul>
<pre><code class="language-c++">logger.AddLogList(clock_sensor_);
</code></pre>
</li>
</ul>
</li>
<li>
<p>Build <code>s2e-user</code> and execute it</p>
</li>
<li>
<p>Check the log file to confirm the output of the <code>clock_sensor_observed_time[sec]</code></p>
<ul>
<li>The output of the clock sensor has an offset error defined by the <code>bias_s</code> value, and the update frequency is decided by the <code>prescaler</code> and the <code>component_update_period_s</code> in the base ini file.</li>
</ul>
</li>
</ol>
<h2 id="4-make-an-initialize-file-for-the-clock-sensor"><a class="header" href="#4-make-an-initialize-file-for-the-clock-sensor">4. Make an initialize file for the clock sensor</a></h2>
<ul>
<li>Usually, we want to change the parameters of components such as noise properties, mounting coordinates, and others without rebuilding. So this section explains how to make an initialize file for the <code>ClockSensor</code>.</li>
</ul>
<ol>
<li>
<p>The initialize function <code>InitClockSensor</code> is defined in the <code>clock_sensor.hpp</code>.</p>
<ul>
<li>The initialize function requires arguments as <code>clock_generator</code>, <code>simulation_time</code>, and <code>file_name</code>.</li>
<li><code>clock_generator</code> and <code>simulation_time</code> are same argument with the constructor of the <code>ClockGenerator</code>.</li>
<li><code>file_name</code> is the file path to the initialize file for the <code>ClockSensor</code>. </li>
</ul>
</li>
<li>
<p>Edit the <code>user_components.hpp</code> and <code>user_components.cpp</code> as follows</p>
<ul>
<li><code>user_components.cpp</code>
<ul>
<li>Edit making instance of the <code>clock_sensor</code> at the constructor
<pre><code class="language-c++">// Clock Sensor
std::string file_name = iniAccess.ReadString(&quot;COMPONENT_FILES&quot;, &quot;clock_sensor_file&quot;);
configuration_-&gt;main_logger_-&gt;CopyFileToLogDirectory(file_name);
clock_sensor_ = new ClockSensor(InitClockSensor(clock_generator, global_environment-&gt;GetSimulationTime(), file_name));
</code></pre>
<ul>
<li>The first line get the file path of the initialize file of the clock sensor.</li>
<li>The second line copy the initialize file to the log output directory to save the simulation setting.</li>
<li>The third line make the instance of the <code>ClockSensor</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Make <code>clock_sensor.ini</code> into <code>s2e-user/data/initialize_files/components</code> from <code>./Tutorial/SampleCodes/clock_sensor</code></p>
</li>
<li>
<p>Edit <code>user_satellite.ini</code> to add the following line at the [COMPONENT_FILES] section of the file</p>
<pre><code class="language-c++">clock_sensor_file = INI_FILE_DIR_FROM_EXE/components/clock_sensor.ini
</code></pre>
<ul>
<li>The keyword <code>INI_FILE_DIR_FROM_EXE</code> is defined in the <code>CMakeList.txt</code> to handle the relative path to the initialize files.</li>
</ul>
</li>
<li>
<p>Build <code>s2e-user</code> and execute it</p>
</li>
<li>
<p>Check the log file </p>
</li>
<li>
<p>Edit the <code>clock_sensor.ini</code> and rerun the <code>s2e-user</code> to confirm the initialize file can affect the result.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-use-monte-carlo-simulation"><a class="header" href="#how-to-use-monte-carlo-simulation">How To Use Monte Carlo Simulation</a></h1>
<h2 id="1--overview-9"><a class="header" href="#1--overview-9">1.  Overview</a></h2>
<ul>
<li>S2E has a framework to execute the Monte Carlo Simulation.</li>
<li>The feature provides a framework to randomize arbitrary parameters in each class. </li>
<li>Users can set the mean value and standard deviation for the randomized parameters with <code>simulation_base.ini</code> file of each user.
<ul>
<li>Please see the specification document for <a href="Tutorials/../Specifications/Simulation/Spec_MonteCarloSimulation.html">Monte Carlo Simulation</a> for a detailed description.</li>
</ul>
</li>
<li>This tutorial explains how to randomly change the initial value of the spacecraft angular velocity.
<ul>
<li>There are sample codes in <a href="https://github.com/ut-issl/s2e-user-example/tree/sample/how-to-use-monte-carlo-simulation">s2e-user-example/sample/how-to-use-monte-carlo-simulation</a>.</li>
</ul>
</li>
<li>The supported version of this document
<ul>
<li>Please confirm that the version of the documents and s2e-core is compatible.</li>
</ul>
</li>
</ul>
<h2 id="2-edit-simulation-case"><a class="header" href="#2-edit-simulation-case">2. Edit Simulation Case</a></h2>
<ul>
<li>To use the Monte Carlo simulation, users have to edit their <code>user_case.hpp</code> and <code>user_case.cpp</code></li>
<li><code>user_case.hpp</code>
<ul>
<li>Add header including
<pre><code class="language-c++">#include &lt;./simulation/monte_carlo_simulation/monte_carlo_simulation_executor.hpp&gt;
</code></pre>
</li>
<li>Add private member variables for <code>MonteCarloSimulationExecutor</code>.
<pre><code class="language-c++">MonteCarloSimulationExecutor &amp;monte_carlo_simulator_;
</code></pre>
</li>
<li>Replace the constructor of UserCase class to add arguments for Monte Carlo simulation.
<pre><code class="language-c++">UserCase(const std::string initialize_base_file, MonteCarloSimulationExecutor &amp;monte_carlo_simulator, const std::string log_path);
</code></pre>
</li>
</ul>
</li>
<li><code>user_case.cpp</code>
<ul>
<li>Add header including
<pre><code class="language-c++">#include &lt;./simulation/monte_carlo_simulation/simulation_object.hpp&gt;
</code></pre>
</li>
<li>Replace the constructor as follows
<pre><code class="language-c++">UserCase::UserCase(const std::string initialize_base_file, MonteCarloSimulationExecutor &amp;monte_carlo_simulator, const std::string log_path)
: SimulationCase(initialize_base_file, monte_carlo_simulator, log_path), monte_carlo_simulator_(monte_carlo_simulator) {}
</code></pre>
</li>
<li>Edit <code>InitializeTargetObjects</code> function
<ul>
<li>Edit log file name definition and</li>
<li>Add <code>MonteCarloSimulationExecutor</code> initialization
<pre><code class="language-c++">// Monte Carlo Simulation
monte_carlo_simulator_.SetSeed();
monte_carlo_simulator_.RandomizeAllParameters();
SimulationObject::SetAllParameters(monte_carlo_simulator_);
monte_carlo_simulator_.AtTheBeginningOfEachCase();
</code></pre>
</li>
</ul>
</li>
<li>Add log settings for the Monte Carlo simulation
<ul>
<li>The <code>GetLogHeader</code> and <code>GetLogValue</code> functions are used for Monte Carlo log output.
<ul>
<li>The log output defined in the function is executed at the beginning and end of a simulation case.</li>
<li>The output line will be <code>2N+1</code>, where N is the sample number of the Monte Carlo simulation.
<ul>
<li>+1 line is for headers.</li>
</ul>
</li>
</ul>
</li>
<li>In this tutorial, time, angular velocity, and quaternion are logged.
<ul>
<li>Users can customize this output depending on their needs.</li>
</ul>
<pre><code class="language-c++">std::string UserCase::GetLogHeader() const
{
  std::string str_tmp = &quot;&quot;;

  str_tmp += WriteScalar(&quot;elapsed_time&quot;, &quot;s&quot;);
  str_tmp += WriteVector(&quot;spacecraft_angular_velocity&quot;, &quot;b&quot;, &quot;rad/s&quot;, 3);
  str_tmp += WriteVector(&quot;spacecraft_quaternion&quot;, &quot;i2b&quot;, &quot;-&quot;, 4);

  return str_tmp;
}
std::string UserCase::GetLogValue() const
{
  std::string str_tmp = &quot;&quot;;

  str_tmp += WriteScalar(global_environment_-&gt;GetSimulationTime().GetElapsedTime_s());
  str_tmp += WriteVector(spacecraft_-&gt;GetDynamics().GetAttitude().GetAngularVelocity_b_rad_s(), 3);
  str_tmp += WriteQuaternion(spacecraft_-&gt;GetDynamics().GetAttitude().GetQuaternion_i2b());

  return str_tmp;
}
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="3-edit-s2e_usercpp-code"><a class="header" href="#3-edit-s2e_usercpp-code">3. Edit <code>s2e_user.cpp</code> code</a></h2>
<ul>
<li>To use the Monte Carlo Simulator, users have to edit their <code>s2e_user.cpp</code></li>
<li>Add header file
<pre><code class="language-c++">#include &lt;./simulation/monte_carlo_simulation/initialize_monte_carlo_simulation.hpp&gt;
</code></pre>
</li>
<li>If you find description below
<pre><code class="language-c++">#include &quot;library/logger/logger.hpp&quot;
</code></pre>
rewrite as the following description 
<pre><code class="language-c++">#include &quot;library/logger/initialize_log.hpp&quot;
</code></pre>
</li>
<li>Make an instance of <code>MonteCarloSimulatorExecutor</code> and Logger for Monte Carlo log
<pre><code class="language-c++">MonteCarloSimulationExecutor *mc_simulator = InitMonteCarloSimulation(ini_file);
Logger *log_mc_sim = InitMonteCarloLog(ini_file, mc_simulator-&gt;IsEnabled());
</code></pre>
</li>
<li>Add while loop for Monte Carlo simulation as follows
<pre><code class="language-c++">while (mc_simulator-&gt;WillExecuteNextCase()) {
  auto simulation_case = UserCase(ini_file, *mc_simulator);
  // Initialize
  log_mc_simulator-&gt;AddLogList(&amp;simulation_case);
  if (mc_simulator-&gt;GetNumberOfExecutionsDone() == 0) log_mc_simulator-&gt;WriteHeaders();
  simulation_case.Initialize();
  // Main
  log_mc_simulator-&gt;WriteValues();  // log initial value
  simulation_case.Main();
  mc_simulator-&gt;AtTheEndOfEachCase();
  log_mc_simulator-&gt;WriteValues();  // log final value
  log_mc_simulator-&gt;ClearLogList();
}

delete log_mc_simulator;
delete mc_simulator;
</code></pre>
</li>
</ul>
<h2 id="4-initialize-file-for-monte-carlo-simulator"><a class="header" href="#4-initialize-file-for-monte-carlo-simulator">4. Initialize file for Monte Carlo simulator</a></h2>
<ul>
<li>
<p>Edit <code>user_simulation_base.ini</code> to add the following description</p>
<pre><code class="language-c++">[MONTE_CARLO_EXECUTION]
// Whether Monte-Carlo Simulation is executed or not
monte_carlo_enable = ENABLE

// Whether you want output the log file for each step
log_enable = ENABLE

// Number of execution
number_of_executions = 3

[MONTE_CARLO_RANDOMIZATION]
parameter(0) = attitude0.angular_velocity_b_rad_s
attitude0.angular_velocity_b_rad_s.randomization_type = CartesianUniform
attitude0.angular_velocity_b_rad_s.mean_or_min(0) = 0.0
attitude0.angular_velocity_b_rad_s.mean_or_min(1) = 0.0
attitude0.angular_velocity_b_rad_s.mean_or_min(2) = 0.0
attitude0.angular_velocity_b_rad_s.sigma_or_max(0) = 0.05817764 // 3-sigma = 10 [deg/s]
attitude0.angular_velocity_b_rad_s.sigma_or_max(1) = 0.05817764 // 3-sigma = 10 [deg/s]
attitude0.angular_velocity_b_rad_s.sigma_or_max(2) = 0.05817764 // 3-sigma = 10 [deg/s]
</code></pre>
</li>
<li>
<p>You can set the following parameters</p>
<ul>
<li><code>monte_carlo_enable</code>:
<ul>
<li><code>ENABLE</code>: S2E executes the Monte Carlo Simulation.</li>
<li><code>DISABLE</code>: S2E executes a simulation case defined in ini files.</li>
</ul>
</li>
<li><code>log_enable</code>:
<ul>
<li><code>ENABLE</code>: A default csv log file is outputted for each sample case.
<ul>
<li><strong>Note</strong>: 100 csv files will be generated when you set <code>number_of_executions = 100</code>.</li>
</ul>
</li>
<li><code>DISABLE</code>:  No default csv log file will be generated. Only a <code>monte_carlo csv log</code> file will be generated.
<ul>
<li><strong>Note</strong>: When <code>monte_carlo_enable = DISABLE</code>, a default csv log file will always be generated.</li>
</ul>
</li>
</ul>
</li>
<li><code>number_of_executions</code>: integer lager than 1
<ul>
<li>The total calculation time is proportional to this value.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Randomized parameters</p>
<ul>
<li>randomization_type: You can choose the randomization type. See <a href="Tutorials/../Specifications/Simulation/Spec_MonteCarloSimulation.html">Monte Carlo Simulation</a> for detail.</li>
<li><code>mean_or_min</code>: Input mean value or minimum value. (Depends on Randomization type)</li>
<li><code>sigma_or_max</code>: Input standard deviation or maximum value. (Depends on Randomization type)</li>
</ul>
</li>
</ul>
<h2 id="6-execute-and-check-logs"><a class="header" href="#6-execute-and-check-logs">6. Execute and check logs</a></h2>
<ul>
<li>Build the <code>S2E_USER</code> and execute it.</li>
<li>In the <code>data</code> directory, you can find one <code>xxxx_monte_carlo.csv</code> file and several <code>xxxx_default.csv</code> files, which depend on your Monte Carlo Simulator setting.</li>
<li>The initial value of angular velocity is randomly varied by the Monte Carlo Simulator.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-add-control-algorithms"><a class="header" href="#how-to-add-control-algorithms">How To Add Control Algorithms</a></h1>
<h2 id="1--overview-10"><a class="header" href="#1--overview-10">1.  Overview</a></h2>
<ul>
<li>In the <a href="Tutorials/./HowToMakeNewComponents.html">How To Make New Components</a> tutorial, we have newly made components emulating codes and adding the new components into our simulation scenario.</li>
<li>Now we can simulate the behavior of spacecraft <strong>free motion</strong> and emulate the behavior of sensors and actuators. </li>
<li>This tutorial explains how to add a <strong>Control Algorithm</strong> to the simulation scenario. </li>
<li>For a practical satellite project, we should implement the control algorithm as actual flight software like <a href="https://github.com/ut-issl/c2a-core">C2A</a> into the S2E. However, using actual flight software is usually overdoing for use cases such as research and the initial phase of satellite projects.</li>
<li>So, we introduce the following three methods, and users can choose a suitable method.
<ul>
<li><code>Direct method</code>: Directly control physical quantity without sensors, actuators, and their noises
<ul>
<li>For theoretical research and preliminary analysis for satellite projects</li>
</ul>
</li>
<li><code>Component method</code>: Control using sensors and actuators without flight S/W framework
<ul>
<li>We can include sensing and actuation noise.</li>
<li>For engineering research and preliminary analysis for satellite projects</li>
<li>From v6.0.0, we have <code>ideal</code> and <code>real</code> directories in the <code>s2e-core/src/components</code>. Users can use <code>ideal</code> components for the early stage of the analysis and can use <code>real</code> components for more detailed analysis. Mixing these components is also possible.</li>
</ul>
</li>
<li><code>Flight S/W method</code>: Control using sensors and actuators with flight S/W framework
<ul>
<li>For actual satellite projects</li>
</ul>
</li>
</ul>
</li>
<li>The supported version of this document
<ul>
<li>Please confirm that the version of the documents and s2e-core are compatible.</li>
</ul>
</li>
</ul>
<h2 id="2-direct-method"><a class="header" href="#2-direct-method">2. Direct method</a></h2>
<ul>
<li>This chapter introduces how to add a control algorithm without sensors and actuators.</li>
<li>This method directly measures the satellite's physical quantity and generates torque and force acting on the satellite.</li>
<li>To do that, users need to edit the <code>Update</code> function in the <code>UserSat.cpp</code>.
<ul>
<li>A sample code is in <a href="https://github.com/ut-issl/s2e-user-example/tree/sample/how-to-add-control-algorithm-direct-method">s2e-user-example/sample/how-to-add-control-algorithm-direct-method</a></li>
</ul>
</li>
<li>The <code>UserSatellite</code> class already has satellite attitude, orbit, and local environment information since it inherits the <code>Spacecraft</code> base class. So users can easily access these values.</li>
<li>To measure physical quantities, users can use getter functions defined in the <code>Attitude</code>, <code>Orbit</code>, and <code>LocalEnvironment</code> classes as <code>dynamics_-&gt;GetAttitude().GetAngularVelocity_b_rad_s()</code>.</li>
<li>To generate torque and force, users can use <code>dynamics_-&gt;AddTorque_b_Nm</code> and <code>dynamics_-&gt;AddForce_b_N</code>.</li>
<li>The sample codes are in <code>SampleCodes/control_algorithm/direct_method/user_satellite.cpp</code>, and you can see very simple detumbling with the proportional control method.</li>
<li>By using the sample code with initial angular velocity = [0.05, -0.03, 0.01] rad/s, the following results are given.
<ul>
<li>
<p>You need to edit the initialize file to set the initial angular velocity.</p>
<img src="Tutorials/./figs/ControlAlgorithm_DirectControl_result1.png" alt="CA_DC_1" style="zoom: 80%;" />  
<img src="Tutorials/./figs/ControlAlgorithm_DirectControl_result2.png" alt="CA_DC_2" style="zoom: 80%;" />  
<img src="Tutorials/./figs/ControlAlgorithm_DirectControl_result3.png" alt="CA_DC_3" style="zoom: 80%;" />  
</li>
</ul>
</li>
</ul>
<h2 id="3-component-method-using-ideal-components"><a class="header" href="#3-component-method-using-ideal-components">3. Component method: Using ideal components</a></h2>
<ul>
<li>TBW</li>
<li>Users can refer the <a href="https://github.com/ut-issl/s2e-ff/tree/feature/example-three-along-track-ff-with-control">s2e-ff</a> as an example of the ideal component method.</li>
</ul>
<h2 id="4-component-method-using-real-components"><a class="header" href="#4-component-method-using-real-components">4. Component method: Using real components</a></h2>
<ul>
<li>This chapter introduces a method to add a control algorithm using realistic sensors and actuators. - This method measures a satellite's physical quantity via sensors, generates torque and force via actuators, and executes control algorithms on OBC.</li>
<li>This tutorial assumes the spacecraft has a three-axis gyro sensor, a reaction wheel, and an OBC.</li>
<li>The sample codes are in <a href="https://github.com/ut-issl/s2e-user-example/tree/sample/how-to-add-control-algorithm-using-real-component">s2e-user-example/sample/how-to-add-control-algorithm-using-real-component</a>.</li>
<li>Firstly, users need to make the <code>UserOnBoardComputer</code> class to emulate the OBC.
<ul>
<li>Copy the <code>user_on_board_computer</code> files to the <code>s2e-user/src/components</code> from the <code>component_method/src/components</code>, and add the <code>user_on_board_computer.cpp</code> to the <code>set(SOURCE_FILES)</code> in the <code>CMakeLists.txt</code> to compile it.</li>
<li>The <code>UserOnBoardComputer</code> class has the <code>UserComponents</code> class as a member, and users can access all components to get sensing information or set the output of actuators.</li>
<li>In this tutorial, the angular velocity is measured by the gyro sensor. After that RW's output torque is calculated using the X-axis of the measured angular velocity, and the torque is set to RW.</li>
</ul>
</li>
<li>Next, users need to add the <code>UserOnBoardComputer</code> into the <code>UserComponents</code> class. You can copy the <code>user_components</code> files to the <code>s2e-user/src/simulation/spacecraft</code> from the <code>component_method/src/simulation</code>.</li>
<li>Finally, users need to add new source codes to the <code>CMakeLists.txt</code> to compile them.
<ul>
<li>You have to add <code>reaction_wheel_xxx.ini</code> to <code>s2e-user/data/initialize_files/components</code></li>
<li>Refer to <code>SampleCodes/control_algorithm/component_method/data/reaction_wheel_xxx.ini</code> if necessary.</li>
</ul>
</li>
<li>By using the sample code, the following results are given.
<ul>
<li>
<p>The X-axis angular velocity is controlled, but other axes are not controlled well since the satellite only has an RW on X-axis. The X-axis angular velocity has offset value since the gyro has offset noise.</p>
<img src="Tutorials/./figs/ControlAlgorithm_ComponentControl_result1.png" alt="CA_CC_1" style="zoom: 80%;" />  
<img src="Tutorials/./figs/ControlAlgorithm_ComponentControl_result2.png" alt="CA_CC_2" style="zoom: 80%;" />  
<img src="Tutorials/./figs/ControlAlgorithm_ComponentControl_result3.png" alt="CA_CC_3" style="zoom: 80%;" />  
</li>
<li>
<p>The following two figure shows the observed angular velocity by gyro and the rotation speed of the RW. You can find the observed X-axis angular velocity reaches zero by the control.</p>
<img src="Tutorials/./figs/ControlAlgorithm_ComponentControl_result4.png" alt="CA_CC_4" style="zoom: 80%;" />  
<img src="Tutorials/./figs/ControlAlgorithm_ComponentControl_result5.png" alt="CA_CC_5" style="zoom: 80%;" />  
</li>
</ul>
</li>
</ul>
<h2 id="5-flightsw-method-control-algorithm-within-c2a"><a class="header" href="#5-flightsw-method-control-algorithm-within-c2a">5. FlightSW method: Control algorithm within C2A</a></h2>
<ul>
<li>TBW</li>
<li>Users can refer the <a href="https://github.com/ut-issl/s2e-aobc">s2e-aobc</a> as an example of the flight software method.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-integrate-c2a"><a class="header" href="#how-to-integrate-c2a">How to integrate C2A</a></h1>
<h2 id="1--overview-11"><a class="header" href="#1--overview-11">1.  Overview</a></h2>
<ul>
<li><a href="https://github.com/ut-issl/c2a-core">C2A</a> (Command Centric Architecture) is an architecture for spacecraft flight software developed by <a href="https://www.space.t.u-tokyo.ac.jp/nlab/index.html">ISSL</a>.</li>
<li>S2E can execute <a href="https://github.com/ut-issl/c2a-core">C2A</a> as flight software for onboard algorithm development and debugging.</li>
<li>This document describes how to integrate the C2A within S2E.</li>
<li>Notes
<ul>
<li>C2A is written in C language, but S2E builds C2A as C++.</li>
</ul>
</li>
<li>The supported version of this document
<ul>
<li>Please confirm that the version of the documents and s2e-core are compatible.</li>
</ul>
</li>
</ul>
<h2 id="2-overview-of-c2a-execution-in-s2e"><a class="header" href="#2-overview-of-c2a-execution-in-s2e">2. Overview of C2A execution in S2E</a></h2>
<ul>
<li>Directory Construction
<ul>
<li>Make <code>FlightSW</code> directory at same directory with <code>s2e-core</code> and <code>s2e-user</code>.</li>
<li>Make a <code>c2a-user</code> directory in <code>FlightSW</code> and set the C2A source code you want to use.
<pre><code>├─ FlightSW
│  └─ c2a-user
│    └─ src_user
│    └─ src_core
└─ s2e-user-example
  ├─ s2e-core
  └─ ExtLibraries
</code></pre>
</li>
<li>Edit <code>s2e-user/CMakeLists.txt</code> as follows.
<ul>
<li><code>set(C2A_NAME &quot;c2a_oss&quot;)</code>
<ul>
<li>Edit the directory name <code>c2a_oss</code> according to your situation.</li>
<li>In the case of the above directory structure, you need to edit as <code>c2a-user</code></li>
</ul>
</li>
<li><code>option(USE_C2A &quot;Use C2A&quot; OFF)</code>
<ul>
<li>Turn on the <code>USE_C2A</code> flag as <code>option(USE_C2A &quot;Use C2A&quot; ON)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Notes
<ul>
<li>In the default setting of S2E, C2A is built but isn't executed. To execute the C2A, users need to add an onboard computer, which can execute the C2A.</li>
<li>The <code>s2e-core</code> has the <a href="https://github.com/ut-issl/s2e-core/blob/develop/src/components/real/cdh/on_board_computer_with_c2a.hpp">ObcWithC2a</a> class as a component, and users can use it to execute the C2A.</li>
<li>Users can use the <code>ObcWithC2a</code> class in the <code>UserComponents</code> class, the same as other components.</li>
</ul>
</li>
<li>Build the <code>s2e_user</code>
<ul>
<li><strong>Note:</strong> When you add new source files in the C2A, you need to modify the <code>c2a-user/CMakeLists.txt</code> to compile them in the S2E.</li>
<li>Users can choose the construction of CMake as users need. For example, the sample codes have several <code>CMakeLists.txt</code> files in each directory to set the compile targets, so users need to modify them to add the target source codes.</li>
</ul>
</li>
</ul>
<h2 id="3-how-to-build-c2a-in-s2e-with-the-sample-codes"><a class="header" href="#3-how-to-build-c2a-in-s2e-with-the-sample-codes">3. How to build C2A in S2E with the sample codes</a></h2>
<ul>
<li>
<p>Sample codes</p>
<ul>
<li>A sample of s2e-user: <a href="https://github.com/ut-issl/s2e-user-example/tree/sample/how-to-integrate-c2a">s2e-user-example/sample/how-to-integrate-c2a</a></li>
<li>A sample of c2a-user: <a href="https://github.com/ut-issl/c2a-core/tree/develop/Examples/minimum_user">C2A minimum user</a> in <code>c2a-core</code>.</li>
</ul>
</li>
<li>
<p>Preparing development environment</p>
<ul>
<li>
<p>Clone the <code>s2e-user-example</code> and switch the branch to <code>sample/how-to-integrate-c2a</code>.</p>
</li>
<li>
<p>Make <code>FlightSW</code> directory at same directory with <code>s2e-core</code>.</p>
</li>
<li>
<p>Clone <code>c2a-core v3.8.0</code> in the <code>FlightSW</code> directory.</p>
</li>
<li>
<p>Execute setup script</p>
<ul>
<li>Mac or Linux Users: <code>c2a-core/setup.sh</code></li>
<li>Windows Users: <code>c2a-core/setup.bat</code></li>
</ul>
</li>
<li>
<p>Open <code>s2e-user-for-c2a-core/CMakeLists.txt</code> and edit <code>set(C2A_NAME &quot;c2a_sample&quot;)</code> to <code>set(C2A_NAME &quot;c2a-core/Examples/minimum_user&quot;)</code></p>
</li>
<li>
<p><strong>For users who don't use Windows</strong></p>
<ul>
<li>open <code>c2a-core/Examples/minimum_user/CMakeLists.txt</code> and edit <code>option(USE_SCI_COM_WINGS &quot;Use SCI_COM_WINGS&quot; ON)</code> to <code>option(USE_SCI_COM_WINGS &quot;Use SCI_COM_WINGS&quot; OFF)</code></li>
<li>This setting turns off the feature to communicate with <a href="https://github.com/ut-issl/wings">WINGS</a> ground station. Currently, this feature is available only for Windows users.</li>
</ul>
</li>
<li>
<p>Please check the following directory construction</p>
<pre><code>├─ FlightSW
│  └─ c2a-core
│    └─ Examples
│      └─ minimum_user
└─ s2e-user-example
  ├─ s2e-core
  └─ ExtLibraries
</code></pre>
</li>
<li>
<p>Build and execute the <code>s2e-user-example</code>.</p>
</li>
<li>
<p>Users can see the following output in a terminal. The <code>CYCLE: TOTAL</code> value is incremented.</p>
<p><img src="Tutorials/./figs/C2aBuild.JPG" alt="" /></p>
</li>
</ul>
</li>
</ul>
<h2 id="4-communication-between-c2a-and-s2e-for-sils-test"><a class="header" href="#4-communication-between-c2a-and-s2e-for-sils-test">4. Communication between C2A and S2E for SILS test</a></h2>
<ul>
<li>Generally, communication between flight software and S2E is executed via <code>OnBoardComputer</code> class.</li>
<li>The <code>OnBoardComputer</code> class has communication ports and communication functions. Other components and flight software can use the communication functions to communicate each other.</li>
<li>For C2A, the <code>ObcWithC2a</code> has the following functions for C2A flight software. The driver functions in the flight software can use these functions. It is essential to use the same <code>port_id</code> with the component setting in S2E. The details are described in specification documents for each feature. 
<ul>
<li>Serial communication functions
<pre><code class="language-cpp">int OBC_C2A_SendFromObc(int port_id, unsigned char* buffer, int offset, int count);
int OBC_C2A_ReceivedByObc(int port_id, unsigned char* buffer, int offset, int count);
</code></pre>
</li>
<li>I2C communication functions
<pre><code class="language-cpp">int OBC_C2A_I2cWriteCommand(int port_id, const unsigned char i2c_addr, const unsigned char* data, const unsigned char len);
int OBC_C2A_I2cWriteRegister(int port_id, const unsigned char i2c_addr, const unsigned char* data, const unsigned char len);
int OBC_C2A_I2cReadRegister(int port_id, const unsigned char i2c_addr, unsigned char* data, const unsigned char len);
</code></pre>
</li>
<li>GPIO
<pre><code class="language-cpp">int OBC_C2A_GpioWrite(int port_id, const bool is_high);
bool OBC_C2A_GpioRead(int port_id);
</code></pre>
</li>
</ul>
</li>
<li>Currently, the C2A uses the wrapper functions in <a href="https://github.com/ut-issl/c2a-core/tree/develop/Examples/minimum_user/src/src_user/IfWrapper/Sils">IfWrapper/Sils</a>. The functions automatically overload the normal IfWrapper functions when C2A is executed on the S2E.</li>
<li>Other interfaces like SPI, etc., will be implemented.</li>
</ul>
<h1 id="5-example-of-s2e-c2a-communication"><a class="header" href="#5-example-of-s2e-c2a-communication">5. Example of S2E-C2A communication</a></h1>
<ul>
<li>
<p>This section shows an example of communication between a component in S2E and an application in C2A. </p>
</li>
<li>
<p>The sample codes</p>
<ul>
<li>S2E: <a href="https://github.com/ut-issl/s2e-user-example/tree/sample/how-to-integrate-c2a">s2e-user-example/sample/how-to-integrate-c2a</a></li>
<li>C2A: <a href="Tutorials/./SampleCodes/c2a_integration/c2a_src_user/">Tutorials/SampleCodes/c2a_integration/</a></li>
</ul>
</li>
<li>
<p>Preparation</p>
<ul>
<li>See <code>Ch. 3 How to build C2A in S2E with the sample codes</code>.</li>
</ul>
</li>
<li>
<p>Modification of the S2E side</p>
<ul>
<li>Users can use the <a href="https://github.com/ut-issl/s2e-core/blob/v6.0.0/src/components/examples/example_serial_communication_with_obc.hpp">ExampleSerialCommunicationWithObc</a> class in <code>s2e-core</code> as a test component to communicate with C2A.</li>
<li>Please refer the sample codes in <a href="https://github.com/ut-issl/s2e-user-example/tree/sample/how-to-integrate-c2a">s2e-user-example/sample/how-to-integrate-c2a</a>.</li>
<li>Add <code>ExampleSerialCommunicationWithObc</code> as a component in <code>user_components.cpp and .hpp</code>.
<ul>
<li>In this example, the <code>ObcWithC2a</code> is executed as 1kHz, and the <code>ExampleSerialCommunicationWithObc</code> is executed as 1Hz.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Modification of the C2A side</p>
<ul>
<li>Please refer the sample codes in <code>Tutorials/SampleCodes/c2a_integration/c2a_src_user</code>. 
<ul>
<li>The directory structure of <code>c2a_src_user</code> is the same with that of <code>c2a-core/Examples/minimum_user/src/src_user</code>.</li>
</ul>
</li>
<li>We need to add a new driver instance application to communicate with the <code>ExampleSerialCommunicationWithObc</code> component.
<ul>
<li>Copy <code>Application/DriverInstances/di_s2e_uart_test.c and .h</code></li>
<li>Edit <code>CMakeLists.txt</code> in the Application directory to add <code>di_s2e_uart_test.c</code> as a compile target.</li>
</ul>
</li>
<li>Edit <code>app_registry.c, h</code> and <code>app_headers.h</code> in the <code>Application</code> directory to register the applications of <code>di_s2e_uart_test</code>.
<ul>
<li>We have two applications <code>AR_DI_S2E_UART_TEST</code> and <code>AR_DI_DBG_S2E_UART_TEST</code>.</li>
</ul>
</li>
<li>Edit <code>Setting/Modes/TaskLists/Elements/tl_elem_drivers_update.c</code> to add the <code>AR_DI_S2E_UART_TEST</code> to execute the application in the tasklist.</li>
<li>Edit <code>Setting/Modes/TaskLists/Elements/tl_elem_debug_display.c</code> to add the <code>AR_DI_DBG_S2E_UART_TEST</code> to execute the application in the tasklist.</li>
</ul>
</li>
<li>
<p>Execution and Result</p>
<ul>
<li>
<p>The C2A's <code>AR_DI_S2E_UART_TEST</code> application sends characters to the S2E's <code>ExampleSerialCommunicationWithObc</code> component like <code>SETA, SETB, SETC, ..., SETZ, SETA</code></p>
</li>
<li>
<p>The <code>ExampleSerialCommunicationWithObc</code> component receives the characters and stores the set characters like <code>A, B, C, ..., Z, A</code></p>
</li>
<li>
<p>The <code>ExampleSerialCommunicationWithObc</code> component sends the stored characters as telemetry like <code>A, BA, CBA, ..., ZYX</code></p>
</li>
<li>
<p>The <code>AR_DI_S2E_UART_TEST</code> application receives the telemetry, and the <code>AR_DI_DBG_S2E_UART_TEST</code> application prints the first three characters in the debug output console like the following figure.</p>
<p><img src="Tutorials/./figs/C2aCommunicationConfirmation.png" alt="" /></p>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-perform-uart-hils-test"><a class="header" href="#how-to-perform-uart-hils-test">How to Perform UART HILS Test</a></h1>
<h2 id="1--overview-12"><a class="header" href="#1--overview-12">1.  Overview</a></h2>
<ul>
<li>Using the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.ports.serialport?view=dotnet-plat-ext-5.0">SerialPort Class</a> in System.IO.Ports Namespace, you can perform serial communication from the COM port of your computer.</li>
<li>The HILS test can be performed by replacing satellite components with simulated components in S2E.</li>
<li>This document describes how to perform HILS Test with <strong>UART</strong> components.
<ul>
<li>If you want to perform HILS Test with <strong>I2C</strong> components, refer to <a href="Tutorials/./HowToPerformI2cHilsTest.html">here</a>.</li>
</ul>
</li>
</ul>
<h2 id="2-how-to-build-files-for-the-hils-test"><a class="header" href="#2-how-to-build-files-for-the-hils-test">2. How to build files for the HILS test</a></h2>
<ul>
<li><strong>Currently, the HILS test is only available for Visual Studio users on Windows.</strong></li>
<li>Serial port operations are written in <code>Interface/HilsInOut/Ports/HilsUartPort.cpp</code> in c++/cli language.</li>
<li>When users want to execute the HILS test, complete the following steps.
<ul>
<li>
<p>Edit <code>s2e-core/CMakeLists.txt</code></p>
<ul>
<li><code>option(USE_HILS &quot;Use HILS&quot; OFF)</code> -&gt; <code>option(USE_HILS &quot;Use HILS&quot; ON)</code></li>
</ul>
</li>
<li>
<p>build <code>s2e-core</code></p>
</li>
</ul>
</li>
<li><strong>Note</strong>: Currently, breakpoints do not work if you build c++/cli and c++ files simultaneously.</li>
</ul>
<h2 id="3-sample-codes-for-uart-communication"><a class="header" href="#3-sample-codes-for-uart-communication">3. Sample codes for UART communication</a></h2>
<ul>
<li>
<p>The supported version of this document</p>
<ul>
<li>Please confirm that the version of the documents and s2e-core is compatible.</li>
</ul>
</li>
<li>
<p>Hardware Settings</p>
<ul>
<li>Set loopback connection of two USB-UART converters using two USB ports of your computer.</li>
<li>Check the COM port number for each connection.</li>
<li>This tutorial assumes the use of <a href="https://www.titan.tw/product/usb-comi-si/">USB-COMi-SI</a>, a USB-UART converter.</li>
</ul>
</li>
<li>
<p>Software Settings</p>
<ul>
<li><code>s2e-core/src/Component/Abstract/ExpHils.cpp</code> is an example of a simulation component for serial port communication.</li>
<li><code>ExpHils</code> is instantiated in <code>s2e-core/src/Simulation/Spacecraft/SampleComponents.cpp</code>.</li>
<li>Uncomment as follows in <code>s2e-core/src/Simulation/Spacecraft/SampleComponents.cpp</code>.
<pre><code class="language-c++">// UART tutorial. Comment out when not in use.
exp_hils_uart_responder_ = new ExpHils(clock_gen, 1, obc_, 3, 9600, hils_port_manager_, 1);
exp_hils_uart_sender_ = new ExpHils(clock_gen, 0, obc_, 4, 9600, hils_port_manager_, 0);
</code></pre>
<pre><code class="language-c++">delete exp_hils_uart_responder_;
delete exp_hils_uart_sender_;
</code></pre>
<ul>
<li>Edit the constructor's argument based on the COM port number checked above.
<ul>
<li>The fourth argument of ExpHils constructor is COM port number.</li>
</ul>
</li>
</ul>
</li>
<li>Uncomment as follows in <code>s2e-core/src/Simulation/Spacecraft/SampleComponents.h</code>.
<pre><code class="language-c++">ExpHils* exp_hils_uart_responder_;
ExpHils* exp_hils_uart_sender_;
</code></pre>
</li>
<li>For the HILS test, edit the setting of simulation speed in <code>s2e-core/data/SampleSat/ini/SampleSimBase.ini</code>.
<pre><code class="language-ini">// Simulation speed. 0: as fast as possible, 1: real-time, &gt;1: faster than real-time, &lt;1: slower than real-time
SimulationSpeed = 1
</code></pre>
</li>
</ul>
</li>
<li>
<p>Execution and Result</p>
<ul>
<li>There are two ExpHils components, a sender component and a responder component.
<ul>
<li>The sender component sends out a new message like <code>ABC</code>, <code>BCD</code>, ....</li>
<li>The responder component returns the message as received.</li>
<li>Data returned from the responder to the sender is output to the console.
<img src="Tutorials/./figs/SerialPortCommunicationConfirmation.png" alt="SerialPortCommunicationConfirmation" style="zoom: 100%;" /></li>
</ul>
</li>
<li>If the comment <code>Error: the specified step_sec is too small for this computer.</code> appears, set <code>StepTimeSec</code> in SampleSimBase.ini to a larger value.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-perform-i2c-hils-test"><a class="header" href="#how-to-perform-i2c-hils-test">How to Perform I2C HILS Test</a></h1>
<h2 id="1--overview-13"><a class="header" href="#1--overview-13">1.  Overview</a></h2>
<ul>
<li>Using the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.ports.serialport?view=dotnet-plat-ext-5.0">SerialPort Class</a> in System.IO.Ports Namespace, you can perform serial communication from the COM port of your computer.</li>
<li>The HILS test can be performed by replacing satellite components with simulated components in S2E.</li>
<li>This document describes how to perform HILS Test with <strong>I2C</strong> components.
<ul>
<li>If you want to perform HILS Test with <strong>UART</strong> components, refer to <a href="Tutorials/./HowToPerformUartHilsTest.html">here</a>.</li>
</ul>
</li>
</ul>
<h2 id="2-how-to-build-files-for-the-hils-test-1"><a class="header" href="#2-how-to-build-files-for-the-hils-test-1">2. How to build files for the HILS test</a></h2>
<ul>
<li><strong>Currently, the HILS test is only available for Visual Studio users on Windows.</strong></li>
<li>Serial port operations are written in <code>Interface/HilsInOut/Ports/HilsUartPort.cpp</code> in c++/cli language.</li>
<li>When users want to execute the HILS test, complete the following steps.
<ul>
<li>Edit <code>s2e-core/CMakeLists.txt</code>
<ul>
<li><code>option(USE_HILS &quot;Use HILS&quot; OFF)</code> -&gt; <code>option(USE_HILS &quot;Use HILS&quot; ON)</code></li>
</ul>
</li>
<li>build <code>s2e-core</code></li>
</ul>
</li>
<li><strong>Note</strong>: Currently, breakpoints do not work if you build c++/cli and c++ files simultaneously.</li>
</ul>
<h2 id="3-sample-codes-for-i2c-communication"><a class="header" href="#3-sample-codes-for-i2c-communication">3. Sample codes for I2C communication</a></h2>
<ul>
<li>
<p>The SerialPort class can also be used to perform HILS tests on simulated I2C components. It is assumed that USB-I2C converters will be used and that serial communication will be performed between the COM port and the converter.</p>
</li>
<li>
<p>The supported version of this document</p>
<ul>
<li>Please confirm that the version of the documents and s2e-core is compatible.</li>
</ul>
</li>
<li>
<p>Hardware Settings</p>
<ul>
<li>Set loopback connection of a USB-I2C controller converter and a USB-I2C target converter using two USB ports of your computer.<img src="Tutorials/./figs/SerialPortCommunication_I2CLoopback.png" alt="SerialPortCommunicationConfirmation" style="zoom: 30%;" /></li>
<li>Check the COM port number for each connection.</li>
<li>This tutorial assumes the use of <a href="https://www.nxp.com/docs/en/data-sheet/SC18IM700.pdf">SC18IM700</a>, a USB-I2C Controller converter and <a href="https://www.ftdichip.com/Support/Documents/DataSheets/ICs/DS_FT200XD.pdf">MFT200XD</a>, a USB-I2C Target converter.</li>
<li><strong>Note</strong> Loopback is not always necessary. Only one of the I2C controller or the I2C target can be simulated in S2E. In a general HILS configuration, the I2C controller is an OBC. s2e-core provides a simulated component of the I2C controller in order to validate the simulated component of the I2C target.</li>
</ul>
</li>
<li>
<p>Software Settings</p>
<ul>
<li><code>s2e-core/src/Component/Abstract/ExpHilsI2cController.cpp</code> and <code>s2e-core/src/Component/Abstract/ExpHilsI2cTarget.cpp</code> are examples of simulation components for I2C communication.</li>
<li><code>ExpHilsI2cController</code> and <code>ExpHilsI2cTarget</code> are instantiated in <code>s2e-core/src/Simulation/Spacecraft/SampleComponents.cpp</code>.</li>
<li>Uncomment as follows in <code>s2e-core/src/Simulation/Spacecraft/SampleComponents.cpp</code>.
<pre><code class="language-c++">// I2C tutorial. Comment out when not in use.
exp_hils_i2c_controller_ = new ExpHilsI2cController(
  30, clock_gen, 5, 115200, 256, 256, hils_port_manager_);
exp_hils_i2c_target_ =
  new ExpHilsI2cTarget(1, clock_gen, 0, 0x44, obc_, 6, hils_port_manager_);
</code></pre>
<pre><code class="language-c++">delete exp_hils_i2c_controller_;
delete exp_hils_i2c_target_;
</code></pre>
<ul>
<li>Edit the constructor's argument based on the COM port number checked above.
<ul>
<li>The third argument of ExpHilsI2cController constructor and the sixth argument of ExpHilsI2cTarget constructor are COM port numbers.</li>
</ul>
</li>
<li>Edit the baud rate and I2C address according to the converter and simulation conditions.
<ul>
<li>The baud rate is specified by the fourth argument of the ExpHilsI2cController constructor and the I2C address by the fourth argument of the ExpHilsI2cTarget constructor.</li>
</ul>
</li>
</ul>
</li>
<li>Uncomment as follows in <code>s2e-core/src/Simulation/Spacecraft/SampleComponents.h</code>.
<pre><code class="language-c++">ExpHilsI2cController* exp_hils_i2c_controller_;
ExpHilsI2cTarget* exp_hils_i2c_target_;
</code></pre>
</li>
<li>If necessary, modify ExpHilsI2cController and ExpHilsI2cTarget files to adjust to the converter.</li>
<li>For the HILS test, edit the setting of simulation speed in <code>s2e-core/data/SampleSat/ini/SampleSimBase.ini</code>.
<pre><code class="language-ini">// Simulation speed. 0: as fast as possible, 1: real-time, &gt;1: faster than real-time, &lt;1: slower than real-time
SimulationSpeed = 1
</code></pre>
</li>
</ul>
</li>
<li>
<p>Execution and Result</p>
<ul>
<li>There are two components, an I2C controller component and an I2C target component.</li>
<li>I2C controller
<ul>
<li>Send a command to the I2C target.
<ul>
<li>Send a command to request a telemetry. 1 byte register address is sent to specify the first address of the data to be read from the I2C controller.</li>
<li>Send a command to read a telemetry from the USB-I2C target converter.</li>
</ul>
</li>
</ul>
</li>
<li>I2C target
<ul>
<li>Receive commands from the I2C controller and send telemetry to the I2C controller.
<ul>
<li>After receiving the telemetry request command, send the telemetry (like ABCDE, BCDEF, ...) to the USB-I2C target converter.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Note</strong> Currently, the latency from the time the USB-I2C target converter receives the data via I2C communication to the time it is sent to the I2C target component via serial communication is too long, at least 1ms, making it impossible to immediately respond to telemetry request commands.
<ul>
<li>Three frames of telemetry are stored in the USB-I2C target converter in advance.</li>
<li>Each time the I2C controller reads the telemetry stored in the USB-I2C target converter, the I2C target component adds the telemetry to the USB-I2C target converter.</li>
</ul>
</li>
<li>The data sent by the I2C target and the data received by the I2C controller are the outputs to the console. Since there are three frames accumulated in the USB-I2C target converter, the I2C controller receives telemetry sent three cycles before from the I2C target.
<img src="Tutorials/./figs/SerialPortCommunication_Confirmation2.png" alt="SerialPortCommunicationConfirmation" style="zoom: 50%;" /></li>
<li>If the comment <code>Error: the specified step_sec is too small for this computer.</code> appears, set <code>StepTimeSec</code> in SampleSimBase.ini to a larger value.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-simulate-multiple-satellites"><a class="header" href="#how-to-simulate-multiple-satellites">How to simulate multiple satellites</a></h1>
<h2 id="1--overview-14"><a class="header" href="#1--overview-14">1.  Overview</a></h2>
<ul>
<li>S2E can simulate multiple satellites.</li>
<li>This document describes how to simulate multiple satellites.</li>
<li>For the sample codes, please see <a href="https://github.com/ut-issl/s2e-user-example/tree/sample/how-to-simulate-multiple-satellites">s2e-user-example/sample/how-to-simulate-multiple-satellites</a>.</li>
<li>The supported version of this document
<ul>
<li>Please confirm that the version of the documents and s2e-core are compatible.</li>
</ul>
</li>
</ul>
<h2 id="2-how-to-add-a-new-satellite"><a class="header" href="#2-how-to-add-a-new-satellite">2. How to add a new satellite</a></h2>
<ol>
<li>
<p>Edit <code>ini</code> files</p>
<ol>
<li>Add <code>ini</code> files for the new satellite.
<ul>
<li><code>satellite.ini</code>, <code>disturbance.ini</code>, <code>local_environment.ini</code>, <code>structure.ini</code> are needed.</li>
</ul>
</li>
<li>Register the <code>ini</code> file for the new satellite in <code>simulation_base.ini</code>
<ul>
<li>The arguments of <code>satellite_file</code> are used as satellite ID in simulation.
<pre><code>[SIMULATION_SETTINGS]
number_of_simulated_spacecraft = 2
spacecraft_file(0) = INI_FILE_DIR_FROM_EXE/user_satellite.ini
spacecraft_file(1) = INI_FILE_DIR_FROM_EXE/user_satellite2.ini
</code></pre>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Edit source code</p>
<ol>
<li>
<p>Add new <code>UserSatellite</code> instances to <code>Case</code> members in <code>user_case.hpp</code>.</p>
<pre><code class="language-c++">UserSatellite *spacecraft0_;  //!&lt; Instance of spacecraft
UserSatellite *spacecraft1_;  //!&lt; Instance of spacecraft
</code></pre>
</li>
<li>
<p>Edit <code>user_case.cpp</code> to copy the spacecraft related codes as the sample code.</p>
<ul>
<li>Please see the sample code for more details.</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Build and execute the <code>s2e-user</code></p>
</li>
<li>
<p>You can see the log <code>spacecraft_angular_velocity_b_x[rad/s]</code> twice. The first one is the angular velocity of <code>satellite 0</code>, and the second one is the angular velocity of <code>satellite 1</code> in the log file.</p>
</li>
</ol>
<h2 id="3-advanced-usage"><a class="header" href="#3-advanced-usage">3. Advanced usage</a></h2>
<ul>
<li>In the sample, the <code>satellite0_</code> and the <code>satellite1_</code> are completely the same, but users can change the settings of these satellites with editing the <code>ini</code> files.
<ul>
<li>Users can change the orbit, initial attitude, satellite structure and so on.</li>
</ul>
</li>
<li>Users also can set the different components for the <code>satellite</code> 0 and 1, when users define different <code>UserSatellite</code> and <code>UserComponents</code> classes.</li>
<li>The document to use <code>relative information</code> will be written.</li>
<li>Users can also refer the <a href="https://github.com/ut-issl/s2e-ff">S2E-FF</a> repository.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overall-structure-of-s2e"><a class="header" href="#overall-structure-of-s2e">Overall Structure of S2E</a></h1>
<h2 id="1-overview-4"><a class="header" href="#1-overview-4">1. Overview</a></h2>
<ul>
<li>This document explains the overall structure of the S2E.</li>
</ul>
<h2 id="2-structure-of-s2e"><a class="header" href="#2-structure-of-s2e">2. Structure of S2E</a></h2>
<ul>
<li>The following figure shows the structure of the S2E.</li>
</ul>
<img src="Specifications/OverallStructure/./figs/S2E_structure.png" alt="S2EStructure" style="zoom: 90%;" />
<h3 id="21-simulation-case"><a class="header" href="#21-simulation-case">2.1. Simulation Case</a></h3>
<ul>
<li>The highest layer of the structure of S2E is the <code>Simulation Case</code>, which is defined in the <code>src/simulation/case/simulation_case.cpp</code>.</li>
<li>The <code>Simulation Case</code> always has <code>Simulation Configuration</code> and <code>Global Environment</code>.
<ul>
<li><code>Simulation Configuration</code> has basic information on the interface of the simulation, such as <code>log output</code> and <code>initialize input</code> information.</li>
<li><code>Global Environment</code> is defined as the common environment for the whole simulation case. It includes time, celestial information, star catalog, and GNSS satellite position.</li>
</ul>
</li>
<li>Users can make their <code>Simulation Case</code> by inheriting the <code>Simulation Case</code> base class and adding simulation target objects (e.g., spacecraft and ground station) for their demand.</li>
<li>The defined simulation objects can use the information of <code>Simulation Configuration</code> and <code>Global Environment</code>.</li>
</ul>
<h3 id="22-spacecraft"><a class="header" href="#22-spacecraft">2.2. Spacecraft</a></h3>
<ul>
<li>An essential simulation object is the <code>Spacecraft</code> class. </li>
<li><code>Spacecraft</code> class has the following features to simulate the behavior of spacecraft in space.
<ul>
<li><code>Structure</code>
<ul>
<li>This class handles the structure information of the spacecraft, such as the mass, the inertia tensor, surface information, and residual magnetic moment.</li>
<li>The information is used to calculate disturbance and propagate dynamics.</li>
</ul>
</li>
<li><code>LocalEnvironment</code>
<ul>
<li>This class handles space environment information around the spacecraft, such as air density, magnetic field, solar energy, and eclipse.</li>
<li>The information is used to calculate disturbance and emulate environment sensors.</li>
</ul>
</li>
<li><code>Disturbance</code>
<ul>
<li>This class handles disturbances forces(accelerations) and torques.</li>
<li>The information is used to propagate dynamics.</li>
</ul>
</li>
<li><code>Dynamics</code>
<ul>
<li>This class handles dynamics calculation for attitude, orbit, and thermal.</li>
<li>This is the core of the numerical simulation.</li>
</ul>
</li>
<li><code>Components</code>
<ul>
<li>This class emulates the behavior of components mounted on the spacecraft. The spacecraft can measure the physical quantities and generate control output by using the components.</li>
<li>This class is not defined in the Spacecraft base class, and users have to define it themselves.</li>
</ul>
</li>
</ul>
</li>
<li>Users can add multiple spacecraft into their <code>SimulationCase</code>, and these spacecraft can communicate via communication components.</li>
</ul>
<h3 id="23-ground-station"><a class="header" href="#23-ground-station">2.3. Ground Station</a></h3>
<ul>
<li>TBW</li>
</ul>
<h3 id="24-structure-of-initializing-files"><a class="header" href="#24-structure-of-initializing-files">2.4. Structure of initializing files</a></h3>
<ul>
<li>The structure of the initializing files follows the above figure.</li>
<li><code>simulation_base.ini</code> sets the parameters for <code>SimulationCase</code>, and file paths to each simulation object.</li>
<li><code>satellite.ini</code> sets the parameters for <code>Spacecraft</code> and file paths to each component.</li>
</ul>
<h2 id="3-structure-of-spacecraft-components"><a class="header" href="#3-structure-of-spacecraft-components">3. Structure of spacecraft components</a></h2>
<p><strong>Note:</strong> the structure of components is implemented now. So the following figure is just an idea, and it may be modified.</p>
<img src="Specifications/OverallStructure/./figs/Component_structure.png" alt="ComponentStructure" style="zoom: 90%;" />
- Each component can communicate with other components.
- All components have a power wire, and power control components control the switch.
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-of-component-class"><a class="header" href="#specification-of-component-class">Specification of Component class</a></h1>
<h2 id="1--overview-15"><a class="header" href="#1--overview-15">1.  Overview</a></h2>
<h3 id="1-functions"><a class="header" href="#1-functions">1. Functions</a></h3>
<ul>
<li>The <code>Component</code> class is an abstract class to handle the electrical power and the update timing of components.</li>
<li>This class has two virtual functions: <code>MainRoutine</code> and <code>FastUpdate</code>. Both are called periodically. Users can select the functions according to the required calling period.
<ul>
<li>The <code>MainRoutine</code> function is the components' main function. Most of the processing is handled in this function.</li>
<li>The <code>FastUpdate</code> function handles the processes that need to be computed in a high-speed cycle. So, users will use this function only when high-frequency disturbances need to be calculated (e.g., RW jitter).</li>
</ul>
</li>
</ul>
<h3 id="2-related-files-1"><a class="header" href="#2-related-files-1">2. Related Files</a></h3>
<ul>
<li>Main file: <code>component.hpp</code>, <code>component.cpp</code></li>
</ul>
<h3 id="3-how-to-use-1"><a class="header" href="#3-how-to-use-1">3. How to use</a></h3>
<ul>
<li>Inherit this class by the user's component class.</li>
<li>The <code>ReactionWheel</code> in <code>S2E_CORE</code> is useful as a usage example of the <code>FastUpdate</code>.</li>
</ul>
<h2 id="2-explanation-of-algorithm-1"><a class="header" href="#2-explanation-of-algorithm-1">2. Explanation of Algorithm</a></h2>
<h3 id="1-constructor"><a class="header" href="#1-constructor">1. Constructor</a></h3>
<h4 id="1-overview-5"><a class="header" href="#1-overview-5">1. overview</a></h4>
<ul>
<li>Users can set component update <code>prescaler</code> and power port. </li>
</ul>
<h4 id="2-inputs"><a class="header" href="#2-inputs">2. inputs</a></h4>
<ul>
<li><code>prescaler</code>
<ul>
<li><code>prescaler</code> determines the execution cycle of the <code>MainRoutine</code> function.</li>
<li>The period of <code>MainRoutine</code> equals to <code>SimTime::compo_update_interval_sec</code> $\times$ <code>prescaler</code>.</li>
</ul>
</li>
<li><code>clock_gen</code>
<ul>
<li><code>clock_gen</code> is an instance that simulates the clock of a component.</li>
<li>Users do not need to care about this.</li>
</ul>
</li>
<li><code>power_port</code>
<ul>
<li><code>power_port</code> is an instance that simulates the power supply</li>
</ul>
</li>
<li><code>fast_prescaler</code>
<ul>
<li><code>fast_prescaler</code> determines the execution cycle of the <code>FastUpdate</code> function.</li>
<li>The period of <code>FastUpdate</code> equals to <code>SimTime::compo_update_interval_sec</code> $\times$ <code>fast_prescaler</code>.</li>
<li>If you don't need to use <code>FastUpdate</code>, you don't need to specify this (it is set to 1 by default).</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-2"><a class="header" href="#3-algorithm-2">3. algorithm</a></h4>
<ul>
<li>N/A</li>
</ul>
<h4 id="4-note-3"><a class="header" href="#4-note-3">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h3 id="2-mainroutine"><a class="header" href="#2-mainroutine">2. <code>MainRoutine</code></a></h3>
<h4 id="1-overview-6"><a class="header" href="#1-overview-6">1. overview</a></h4>
<ul>
<li>Components' main function</li>
</ul>
<h4 id="2-inputs-1"><a class="header" href="#2-inputs-1">2. inputs</a></h4>
<ul>
<li><code>time_count</code>
<ul>
<li><code>time_count</code> is incremented each time the <code>Tick</code> function is called.</li>
<li>Users can use this timing information when they need for their components.</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-3"><a class="header" href="#3-algorithm-3">3. algorithm</a></h4>
<ul>
<li>N/A </li>
</ul>
<h4 id="4-note-4"><a class="header" href="#4-note-4">4. note</a></h4>
<ul>
<li>All the components have to override the <code>MainRoutine</code> function.</li>
</ul>
<h3 id="3-fastupdate"><a class="header" href="#3-fastupdate">3. <code>FastUpdate</code></a></h3>
<h4 id="1-overview-7"><a class="header" href="#1-overview-7">1. overview</a></h4>
<ul>
<li>This function handles the processes that need to be computed in a high-speed cycle.</li>
</ul>
<h4 id="2-inputs-2"><a class="header" href="#2-inputs-2">2. inputs</a></h4>
<ul>
<li>N/A</li>
</ul>
<h4 id="3-algorithm-4"><a class="header" href="#3-algorithm-4">3. algorithm</a></h4>
<ul>
<li>N/A </li>
</ul>
<h4 id="4-note-5"><a class="header" href="#4-note-5">4. note</a></h4>
<ul>
<li><code>FastUpdate</code> function is not a pure virtual function, so components without fast calculation do not need to override this function.</li>
<li>As explained in the <code>FastTick</code> section, <code>ITickable::needs_fast_update_</code> flag must be true to call <code>FastUpdate</code>. So, if users want to use <code>FastUpdate</code>, call <code>ITickable::SetNeedsFastUpdate(true)</code> in the constructor of each component.</li>
</ul>
<h3 id="4-tick"><a class="header" href="#4-tick">4. <code>Tick</code></a></h3>
<h4 id="1-overview-8"><a class="header" href="#1-overview-8">1. overview</a></h4>
<ul>
<li>This function executes <code>MainRoutine</code>.</li>
<li><code>ClockGenerator</code> class calls this function.</li>
</ul>
<h4 id="2-inputs-3"><a class="header" href="#2-inputs-3">2. inputs</a></h4>
<ul>
<li><code>count</code>
<ul>
<li><code>count</code> is incremented each time the <code>Tick</code> function is called.</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-5"><a class="header" href="#3-algorithm-5">3. algorithm</a></h4>
<ul>
<li>Execute <code>MainRoutine</code> when the <code>count</code> is divisible by the <code>prescaler</code>. By this mechanism, the execution period of <code>MainRoutine</code> is divided.</li>
</ul>
<h4 id="4-note-6"><a class="header" href="#4-note-6">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h3 id="5-fasttick"><a class="header" href="#5-fasttick">5. <code>FastTick</code></a></h3>
<h4 id="1-overview-9"><a class="header" href="#1-overview-9">1. overview</a></h4>
<ul>
<li>This function executes <code>FastUpdate</code>.</li>
<li><code>ClockGenerator</code> class calls this function.</li>
</ul>
<h4 id="2-inputs-4"><a class="header" href="#2-inputs-4">2. inputs</a></h4>
<ul>
<li><code>count</code>
<ul>
<li><code>count</code> is incremented each time the <code>FastTick</code> function is called.</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-6"><a class="header" href="#3-algorithm-6">3. algorithm</a></h4>
<ul>
<li>Execute <code>FastUpdate</code> when the <code>count</code> is divisible by the <code>fast_prescaler</code>. By this mechanism, the execution period of <code>FastUpdate</code> is divided.</li>
</ul>
<h4 id="4-note-7"><a class="header" href="#4-note-7">4. note</a></h4>
<ul>
<li><code>ITickable::needs_fast_update_</code> flag must be true to call <code>FastUpdate</code>. So, if you want to use <code>FastUpdate</code>, call <code>ITickable::SetNeedsFastUpdate(true)</code> in the constructor of each component.</li>
</ul>
<h2 id="3-results-of-verifications-1"><a class="header" href="#3-results-of-verifications-1">3. Results of verifications</a></h2>
<ul>
<li>N/A</li>
</ul>
<h2 id="4-references-1"><a class="header" href="#4-references-1">4. References</a></h2>
<ul>
<li>N/A</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-of-uartcommunicationwithobc-class"><a class="header" href="#specification-of-uartcommunicationwithobc-class">Specification of UartCommunicationWithObc class</a></h1>
<h2 id="1--overview-16"><a class="header" href="#1--overview-16">1.  Overview</a></h2>
<h3 id="1-functions-1"><a class="header" href="#1-functions-1">1. Functions</a></h3>
<ul>
<li>The <code>UartCommunicationWithObc</code> class is an abstract class to communicate with <code>OnBoardComputer</code>.</li>
<li>Component classes can use this abstract class to emulate telemetry/command communication with an <code>OnBoardComputer</code>.</li>
<li>This class also supports communication with <code>C2A</code> in the <code>ObcWithC2a</code> class.</li>
</ul>
<h3 id="2-related-files-2"><a class="header" href="#2-related-files-2">2. Related files</a></h3>
<ul>
<li>on_board_computer.cpp, hpp</li>
<li>example_serial_communication_with_obc.cpp, hpp
<ul>
<li>Users can find an example of using this class.</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-2"><a class="header" href="#3-how-to-use-2">3. How to use</a></h3>
<ul>
<li>Inherit this class by component class.
<ul>
<li>Users need to set <code>sils_port_id</code> and target <code>OnBoardComputer</code> for the communication.</li>
</ul>
</li>
<li>This class has the following protected functions for telemetry/command communication. Users can call these functions in the <code>MainRoutine</code> of the component.
<pre><code class="language-cpp">int ReceiveCommand(const int offset, const int rec_size);
int SendTelemetry(const int offset); 
</code></pre>
</li>
<li>In the protected functions, the following pure virtual functions are called. Users need to define the functions in the subclass.
<pre><code class="language-cpp">virtual int ParseCommand(const int cmd_size)=0;
virtual int GenerateTelemetry()=0;
</code></pre>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-2"><a class="header" href="#2-explanation-of-algorithm-2">2. Explanation of Algorithm</a></h2>
<h3 id="1-constructors"><a class="header" href="#1-constructors">1. Constructors</a></h3>
<h4 id="1-overview-10"><a class="header" href="#1-overview-10">1. overview</a></h4>
<ul>
<li>In the constructors, the communication port for the <code>OnBoardComputer</code> is connected.</li>
<li>If another component already connects the port, the connection function returns an error, and the constructors output a message.</li>
</ul>
<h4 id="2-inputs-and-outputs-2"><a class="header" href="#2-inputs-and-outputs-2">2. inputs and outputs</a></h4>
<ul>
<li>Both constructors require <code>sils_port_id</code> and target <code>OnBoardComputer</code>.</li>
<li>Users can set the communication data buffer size. When users do not put the size, the value is automatically set as the maximum value.
<ul>
<li>The maximum value is 1024, and it is defined in <code>uart_port.hpp</code></li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-7"><a class="header" href="#3-algorithm-7">3. algorithm</a></h4>
<ul>
<li>N/A</li>
</ul>
<h4 id="4-note-8"><a class="header" href="#4-note-8">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h3 id="2-destructor"><a class="header" href="#2-destructor">2. Destructor</a></h3>
<h4 id="1-overview-11"><a class="header" href="#1-overview-11">1. overview</a></h4>
<ul>
<li>In the destructor, the communication port is closed.</li>
<li>If another component has closed the port, the close function returns an error, and the constructors output a message.</li>
</ul>
<h4 id="2-inputs-and-outputs-3"><a class="header" href="#2-inputs-and-outputs-3">2. inputs and outputs</a></h4>
<ul>
<li>N/A</li>
</ul>
<h4 id="3-algorithm-8"><a class="header" href="#3-algorithm-8">3. algorithm</a></h4>
<ul>
<li>N/A </li>
</ul>
<h4 id="4-note-9"><a class="header" href="#4-note-9">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h3 id="3-receivecommand"><a class="header" href="#3-receivecommand">3. ReceiveCommand</a></h3>
<h4 id="1-overview-12"><a class="header" href="#1-overview-12">1. overview</a></h4>
<ul>
<li>Receive command data sent from the OBC.</li>
</ul>
<h4 id="2-inputs-and-outputs-4"><a class="header" href="#2-inputs-and-outputs-4">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li>offset: offset value of the rx_buffer [Byte]</li>
<li>rec_size: receiving data size = length of the command [Byte]</li>
</ul>
</li>
<li>output
<ul>
<li>return: Error code. (&lt;=0: Error was happened)</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-9"><a class="header" href="#3-algorithm-9">3. algorithm</a></h4>
<ul>
<li>N/A </li>
</ul>
<h4 id="4-note-10"><a class="header" href="#4-note-10">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h3 id="4-sendtelemetry"><a class="header" href="#4-sendtelemetry">4. SendTelemetry</a></h3>
<h4 id="1-overview-13"><a class="header" href="#1-overview-13">1. overview</a></h4>
<ul>
<li>Send telemetry data to the OBC.</li>
</ul>
<h4 id="2-inputs-and-outputs-5"><a class="header" href="#2-inputs-and-outputs-5">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li>offset: offset value of the tx_buffer [Byte]</li>
</ul>
</li>
<li>output
<ul>
<li>return: Error code. 0: fine, &lt;0: Error.</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-10"><a class="header" href="#3-algorithm-10">3. algorithm</a></h4>
<ul>
<li>N/A </li>
</ul>
<h4 id="4-note-11"><a class="header" href="#4-note-11">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h3 id="5-parsecommand"><a class="header" href="#5-parsecommand">5. ParseCommand</a></h3>
<h4 id="1-overview-14"><a class="header" href="#1-overview-14">1. overview</a></h4>
<ul>
<li>Users need to define this function to analyze the command.</li>
</ul>
<h4 id="2-inputs-and-outputs-6"><a class="header" href="#2-inputs-and-outputs-6">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li>cmd_size: command side [Byte]</li>
</ul>
</li>
<li>output
<ul>
<li>return: Error code. (&lt;=0: Error was happened)</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-11"><a class="header" href="#3-algorithm-11">3. algorithm</a></h4>
<ul>
<li>N/A </li>
</ul>
<h4 id="4-note-12"><a class="header" href="#4-note-12">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h3 id="6-generatetelemetry"><a class="header" href="#6-generatetelemetry">6. GenerateTelemetry</a></h3>
<h4 id="1-overview-15"><a class="header" href="#1-overview-15">1. overview</a></h4>
<ul>
<li>Users need to define this function to make telemetry.</li>
</ul>
<h4 id="2-inputs-and-outputs-7"><a class="header" href="#2-inputs-and-outputs-7">2. inputs and outputs</a></h4>
<ul>
<li>input: N/A</li>
<li>output
<ul>
<li>return: send data size [Byte]</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-12"><a class="header" href="#3-algorithm-12">3. algorithm</a></h4>
<ul>
<li>N/A </li>
</ul>
<h4 id="4-note-13"><a class="header" href="#4-note-13">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h2 id="3-results-of-verifications-2"><a class="header" href="#3-results-of-verifications-2">3. Results of verifications</a></h2>
<ul>
<li>N/A</li>
</ul>
<h2 id="4-references-2"><a class="header" href="#4-references-2">4. References</a></h2>
<ul>
<li>N/A</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-of-sensor-class"><a class="header" href="#specification-of-sensor-class">Specification of Sensor class</a></h1>
<h2 id="1--overview-17"><a class="header" href="#1--overview-17">1.  Overview</a></h2>
<h3 id="1-functions-2"><a class="header" href="#1-functions-2">1. Functions</a></h3>
<ul>
<li>The <code>Sensor</code> class is a base class to provide common features for sensors.</li>
<li>This class adds the following noises and output limits.
<ul>
<li>Constant offset noise</li>
<li>Normal random noise</li>
<li>Random Walk noise</li>
<li>Scale factor noise and cross-talk between axes</li>
</ul>
</li>
</ul>
<h3 id="2-related-files-3"><a class="header" href="#2-related-files-3">2. Related files</a></h3>
<ul>
<li>Main file: <code>sensor_base.cpp, .hpp</code></li>
<li>Used Libraries: <code>vector.hpp</code>, <code>matrix.hpp</code>, <code>normal_randomization.hpp</code>, <code>random_walk.hpp</code></li>
</ul>
<h3 id="3-how-to-use-3"><a class="header" href="#3-how-to-use-3">3. How to use</a></h3>
<ul>
<li>Inherit this class by your sensor class.</li>
<li>The <code>GyroSensor</code> and <code>Magnetometer</code> in <code>S2E_CORE</code> are useful as usage examples.</li>
</ul>
<h2 id="2-explanation-of-algorithm-3"><a class="header" href="#2-explanation-of-algorithm-3">2. Explanation of Algorithm</a></h2>
<h3 id="1-constructor-1"><a class="header" href="#1-constructor-1">1. Constructor</a></h3>
<h4 id="1-overview-16"><a class="header" href="#1-overview-16">1. overview</a></h4>
<ul>
<li>Users can set sensor noise parameters by using the Constructor.</li>
</ul>
<h4 id="2-inputs-5"><a class="header" href="#2-inputs-5">2. inputs</a></h4>
<ul>
<li><code>scale_factor</code>: Scale factor matrix to express scale factor noise and cross-talk</li>
<li>Range related parameters
<ul>
<li><code>range_to_const_c</code>: The output value cannot over this value</li>
<li><code>range_to_zero_c</code>: The output is set as zero when the true value is larger than this value.</li>
<li>This feature is optional. If you don't want to use the value, please set this huge value.</li>
<li><code>range_to_zero_c</code> should be larger than <code>range_to_const_c</code>.</li>
</ul>
</li>
<li><code>bias_noise_c</code>: Constant offset noise</li>
<li><code>normal_random_standard_deviation_c</code>: Standard deviation for normal random noise</li>
<li>Random Walk noise parameters
<ul>
<li><code>random_walk_step_width_s</code>: Step width for Random Walk propagation (unit: sec)
<ul>
<li>It should be the same as the update frequency of the sensor.</li>
</ul>
</li>
<li><code>random_walk_standard_deviation_c</code>: Standard deviation for Random Walk</li>
<li><code>random_walk_limit_c</code>: Soft limit of Random Walk</li>
</ul>
</li>
<li><strong>Note</strong>: The number of elements for all parameters can be set by using the <code>template</code> feature.</li>
<li><strong>Note</strong>: All parameters are defined in the component frame.</li>
<li><strong>Note</strong>: Normally, the unit of the parameters is the same as the unit of true value. Users also can change the unit by using the scale factor matrix.</li>
</ul>
<h4 id="3-algorithm-13"><a class="header" href="#3-algorithm-13">3. algorithm</a></h4>
<ul>
<li>The values of the <code>range_to_const_c</code> and <code>range_to_zero_c</code> are checked here with the <code>RangeCheck</code> function.</li>
</ul>
<h4 id="4-note-14"><a class="header" href="#4-note-14">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h3 id="2-measure"><a class="header" href="#2-measure">2. Measure</a></h3>
<h4 id="1-overview-17"><a class="header" href="#1-overview-17">1. overview</a></h4>
<ul>
<li>This function adds all noises, and the output is clipped by the <code>Clip</code> function not to over the ranges.</li>
</ul>
<h4 id="2-inputs-and-outputs-8"><a class="header" href="#2-inputs-and-outputs-8">2. inputs and outputs</a></h4>
<ul>
<li>input: True value on the component frame</li>
<li>output: Measured value on the component frame</li>
</ul>
<h4 id="3-algorithm-14"><a class="header" href="#3-algorithm-14">3. algorithm</a></h4>
<ul>
<li>N/A </li>
</ul>
<h4 id="4-note-15"><a class="header" href="#4-note-15">4. note</a></h4>
<ul>
<li>N/A</li>
</ul>
<h2 id="3-results-of-verifications-3"><a class="header" href="#3-results-of-verifications-3">3. Results of verifications</a></h2>
<ul>
<li>
<p>We verified the <code>Sensor</code> class with the following parameters.</p>
</li>
<li>
<p>Default parameters</p>
<ul>
<li><code>scale_factor</code> = Unit matrix</li>
<li><code>range_to_const_c</code> = 5</li>
<li><code>range_to_zero_c</code> = 10</li>
<li><code>bias_noise_c</code> = 0.0</li>
<li><code>normal_random_standard_deviation_c</code> = 0.0</li>
<li><code>random_walk_step_width_s</code>= 0.1 sec</li>
<li><code>random_walk_standard_deviation_c</code> = 0.0</li>
<li><code>random_walk_limit_c</code> = 0.0</li>
<li>input value: 0.0</li>
</ul>
</li>
<li>
<p>Case 1: <code>bias_noise_c</code> = 1.0, others = default</p>
<ul>
<li>The bottom figure shows the result of the output data.</li>
<li>We verified the constant offset noise calculation is correct according to the data.</li>
</ul>
<div align="center">
<figure id="bias_1">
<img src="Specifications/Component/Abstract/./figs/bias_1.png" width=400>
<figcaption>Result of constant offset noise (bias_noise_c = 1.0).</figcaption>
</figure>
</div>
</li>
<li>
<p>Case 2: <code>normal_random_standard_deviation_c</code> = 1.0, others = default</p>
<ul>
<li>The simulation time is 1000sec, and the log output period is 0.1sec.</li>
<li>The bottom figure shows the result of the output data.</li>
<li>The calculated average and standard deviation from the output data are shown as follows.
<ul>
<li><code>Average = 0.012</code></li>
<li><code>Standard Deviation = 1.000</code></li>
</ul>
</li>
<li>We verified the normal random noise calculation is correct according to the data.</li>
</ul>
<div align="center">
<figure id="normal_random_noise_1">
<img src="Specifications/Component/Abstract/./figs/normal_random_noise_1.png" width=400>
<figcaption>Result of normal random noise (normal_random_standard_deviation_c = 1.0).</figcaption>
</figure>
</div>
</li>
<li>
<p>Case 3: <code>random_walk_standard_deviation_c</code> = 0.3, <code>random_walk_limit_c</code> = 0.05, others = default</p>
<ul>
<li>The simulation time is 200sec, and the log output period is 0.5sec.</li>
<li>The bottom figure shows the result of the output data.</li>
<li>The output data randomly varies inside the limit value.
<ul>
<li><strong>Note</strong>: The limit is not hard.</li>
</ul>
</li>
<li>We verified the normal random noise calculation is correct according to the data.</li>
</ul>
<div align="center">
<figure id="random_walk_03_005">
<img src="Specifications/Component/Abstract/./figs/random_walk_03_005.png" width=400>
<figcaption>Result of Random Walk noise (random_walk_standard_deviation_c = 0.3, random_walk_limit_c = 0.05).</figcaption>
</figure>
</div>
</li>
</ul>
<h2 id="4-references-3"><a class="header" href="#4-references-3">4. References</a></h2>
<ul>
<li>N/A</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-starsensor-class"><a class="header" href="#specification-for-starsensor-class">Specification for StarSensor class</a></h1>
<h2 id="1--overview-18"><a class="header" href="#1--overview-18">1.  Overview</a></h2>
<h3 id="1-functions-3"><a class="header" href="#1-functions-3">1. functions</a></h3>
<ul>
<li><code>StarSensor</code> class simulates a star sensor.</li>
<li>The <code>StarSensor</code> class calculates and returns the observed quaternions and error flags.</li>
</ul>
<h3 id="2-files"><a class="header" href="#2-files">2. files</a></h3>
<ul>
<li><code>star_sensor.cpp, star_sensor.hpp</code> : Definitions and declarations of the class</li>
<li><code>star_sensor.ini</code> : Initialization file</li>
<li><code>plot_star_sensor.py</code>: An example of a Python script to plot star sensor output</li>
</ul>
<h3 id="3-how-to-use-4"><a class="header" href="#3-how-to-use-4">3. how to use</a></h3>
<ul>
<li>Set the parameters in <code>star_sensor.ini</code>.</li>
<li>Create an instance by using the initialization function <code>InitStarSensor</code></li>
<li>Use <code>Get*</code> function to get quaternion information.</li>
</ul>
<h2 id="2-explanation-of-algorithm-4"><a class="header" href="#2-explanation-of-algorithm-4">2. Explanation of Algorithm</a></h2>
<h3 id="1-update"><a class="header" href="#1-update">1. <code>Update</code></a></h3>
<ul>
<li>TBW</li>
</ul>
<h3 id="2-judgement"><a class="header" href="#2-judgement">2. <code>Judgement</code></a></h3>
<h4 id="1-earthjudgement"><a class="header" href="#1-earthjudgement">1. <code>EarthJudgement</code></a></h4>
<ul>
<li>Calculate the angle $\theta_{ce}$ between the earth's center direction $\boldsymbol{r_{sc}}$ and the earth's edge direction $\boldsymbol{r_{se}}$. $R_e$ is the earth's radius.</li>
<li>Calculate the angle $\theta_{es}$ between the sight direction $\boldsymbol{r_{sight}}$ and the earth's edge direction $\boldsymbol{r_{se}}$.</li>
<li>Judge the STT error flag by comparing $\theta_{es}$ with the earth forbidden angle $\theta_{efa}$. If $\theta_{es} &gt; \theta_{efa}$, the earth is completely outside the earth forbidden angle.</li>
</ul>
<p>\[
\begin{align}
\theta_{ce} = \arctan{\left(\frac{|\boldsymbol{r_{se}}|}{R_e}\right)}\\
\theta_{cs} = \arccos{(\boldsymbol{r_{se}}*\boldsymbol{r_{sight}})}\\
\theta_{es} = \theta_{ce} - \theta_{cs}
\tag{1}
\end{align}
\]</p>
<p><img src="Specifications/Component/AOCS/./figs/stt_earth_judgement.png" alt="" /></p>
<h2 id="3-results-of-verifications-4"><a class="header" href="#3-results-of-verifications-4">3. Results of verifications</a></h2>
<h3 id="1-verification-of-earth-judgement"><a class="header" href="#1-verification-of-earth-judgement">1. verification of Earth judgement</a></h3>
<h4 id="1-overview-18"><a class="header" href="#1-overview-18">1. overview</a></h4>
<ul>
<li>Check that Earth judgement is performed correctly</li>
</ul>
<h4 id="2-conditions-for-the-verification-1"><a class="header" href="#2-conditions-for-the-verification-1">2. conditions for the verification</a></h4>
<ul>
<li>PropStepSec: 0.001</li>
<li>StepTimeSec: 0.1</li>
<li>EndTimeSec: 200</li>
<li>Initial position [m] : [4.2164140100E+07,0,0]</li>
<li>Initial velocity [m/s] : [0,3.074661E+03,0]</li>
<li>ControlledAttitude
<ul>
<li>main mode = EARTH_CENTER_POINTING: the pointing direction is determined by each case</li>
<li>sub mode = SUN_POINTING: [0,0,1]</li>
</ul>
</li>
<li>STT quaternion from body frame to component frame: [0,0,0,1]</li>
<li>Earth forbidden half-angle: 10deg</li>
<li>The angle between the earth's center and edge direction: 8.6deg</li>
</ul>
<h4 id="3-results"><a class="header" href="#3-results">3. results</a></h4>
<ul>
<li>The angle between pointing direction and earth center = 15deg
<ul>
<li>STT flag is always 1, since the angle $\theta_{es}$ between the sight direction and the earth's edge direction is 15 - 8.6 = 6.4deg &lt; 10deg. </li>
</ul>
</li>
</ul>
<p><img src="Specifications/Component/AOCS/./figs/stt_flag_15.png" alt="" /></p>
<ul>
<li>The angle between pointing direction and earth center = 20deg
<ul>
<li>STT flag is always 0, since the angle $\theta_{es}$ between the sight direction and the earth's edge direction is 20 - 8.6 = 11.4deg &gt; 10deg.</li>
</ul>
</li>
</ul>
<p><img src="Specifications/Component/AOCS/./figs/stt_flag_20.png" alt="" /></p>
<ul>
<li>The angle between pointing direction and earth center = 30deg
<ul>
<li>STT flag is always 0, since the angle $\theta_{es}$ between the sight direction and the earth's edge direction is 30 - 8.6 = 21.4deg &gt; 10deg.</li>
</ul>
</li>
</ul>
<p><img src="Specifications/Component/AOCS/./figs/stt_flag_30.png" alt="" /></p>
<ul>
<li>The output result obtained by the default initial settings.
<ul>
<li>The figure is generated by the Python script.</li>
</ul>
</li>
</ul>
<p><img src="Specifications/Component/AOCS/./figs/star_sensor_output.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-reactionwheeljitter-class"><a class="header" href="#specification-for-reactionwheeljitter-class">Specification for ReactionWheelJitter class</a></h1>
<h2 id="1--overview-19"><a class="header" href="#1--overview-19">1.  Overview</a></h2>
<ul>
<li><code>ReactionWheelJitter</code> class simulates the high-frequency jitter of Reaction Wheels.</li>
<li>This class uses:
<ul>
<li>Angular velocity of the RW</li>
<li>Parameters of RW disturbance measured by experiments</li>
</ul>
</li>
<li>This class returns:
<ul>
<li>RW jitter forces and torques in the component frame</li>
<li>RW jitter forces and torques in the body frame</li>
</ul>
</li>
</ul>
<h3 id="1-functions-4"><a class="header" href="#1-functions-4">1. functions</a></h3>
<ul>
<li><code>CalcJitter</code> 
<ul>
<li>Simulates the reaction wheel jitter</li>
<li>(If Enabled) Calls <code>AddStructuralResonance()</code>. This function adds the effect of structural resonance to the high-frequency disturbance of RW. You can choose to consider the effect of structural resonance or not.</li>
</ul>
</li>
</ul>
<h3 id="2-files-1"><a class="header" href="#2-files-1">2. files</a></h3>
<ul>
<li><code>reaction_wheel_jitter.cpp</code>, <code>reaction_wheel_jitter.hpp</code></li>
<li><code>reaction_wheel.ini</code></li>
<li><code>radial_force_harmonics_coefficients.csv</code>,<code>radial_torque_harmonics_coefficients.csv</code> 
<ul>
<li>These files contain the harmonic coefficients from experiments.</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-5"><a class="header" href="#3-how-to-use-5">3. how to use</a></h3>
<ul>
<li>Set the harmonics coefficients in <code>radial_force_harmonics_coefficients.csv</code> and <code>radial_torque_harmonics_coefficients.csv</code></li>
<li>The first column is an array of the $h_i$( $i$-th harmonic number). The second column is an array of the $C_i$ (amplitude of the $i$-th harmonic).</li>
<li>Set parameters in <code>reaction_wheel.ini</code></li>
<li>When only the static imbalance and dynamic imbalance(correspond to $C_i$ at $h_i\ne1$) is known according to the spec sheet, edit the files as follows.
<ul>
<li><code>radial_force_harmonics_coefficients.csv</code>
<ul>
<li>Set $h_1$(the line 1 of the first column) as $1.0$.</li>
<li>Set $C_1$(the line 1 of the second column) as the static imbalance on the spec sheet.</li>
</ul>
</li>
<li><code>radial_torque_harmonics_coefficients.csv</code>
<ul>
<li>Set $h_1$(the line 1 of the first column) as $1.0$.</li>
<li>Set $C_1$(the line 1 of the second column) as the dynamic imbalance on the spec sheet.</li>
</ul>
</li>
<li><code>reaction_wheel.ini</code>
<ul>
<li>Set <code>harmonics_degree = 1</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Set the jitter update period to an appropriate value.
<ul>
<li>Jitter update period is equal to the product of <code>CompoUpdateIntervalSec</code> in <code>simulation_base.ini</code> and <code>fast_prescaler</code> in <code>reaction_wheel.ini</code>.</li>
<li>For correct calculation, the update period of the jitter should be set to approximately 0.1ms.</li>
<li>A larger update period is not a problem, but it will cause aliasing in the jitter waveform.</li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-5"><a class="header" href="#2-explanation-of-algorithm-5">2. Explanation of Algorithm</a></h2>
<h3 id="1-calcjitter"><a class="header" href="#1-calcjitter">1. <code>CalcJitter</code></a></h3>
<h4 id="1-overview-19"><a class="header" href="#1-overview-19">1. overview</a></h4>
<ul>
<li>Function to calculate jitter force and torque</li>
</ul>
<h4 id="2-input-and-output"><a class="header" href="#2-input-and-output">2. input and output</a></h4>
<ul>
<li>input
<ul>
<li>angular velocity of the RW</li>
</ul>
</li>
<li>output
<ul>
<li>jitter force and torque in the component frame</li>
<li>jitter force and torque in the body frame</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-15"><a class="header" href="#3-algorithm-15">3. algorithm</a></h4>
<ul>
<li>The disturbances consist of discrete harmonics of reaction wheel speed with amplitudes proportional to the square of the wheel speed:</li>
</ul>
<p>\[
u(t)=\sum_{i=1}^n C_i\Omega^2\sin(2\pi h_i\Omega t+\alpha_i)
\]</p>
<ul>
<li>where $u(t)$ is the disturbance force and torque in Newton (N) or Newton-meters (Nm), $n$ is the number of harmonics included in the model, $C_i$ is the amplitude of the $i$ th harmonic in $\mathrm{N^2/Hz}$ (or $\mathrm{(Nm)^2/Hz}$), $\Omega$ is the wheel speed in Hz, $h_i$ is the $i$ th harmonic number and $\alpha_i$ is a random phase (assumed to be uniform over $[0, 2\pi]$) [1].</li>
<li>$\alpha_i$ is generated as a uniform random number in the constructor.</li>
<li>When users want to use a more precise model, set <code>considers_structural_resonance</code> to ENABLE in <code>RW.ini</code> and use a model that takes structural resonance inside the RW into account.
<ul>
<li>If structural resonances are not taken into account, the RW disturbance will be underestimated, but it is not a significant change in general.</li>
<li>See the description of <code>AddStructuralResonance()</code> for the algorithm to calculate the structural resonance.</li>
</ul>
</li>
</ul>
<h3 id="2-addstructuralresonance"><a class="header" href="#2-addstructuralresonance">2. <code>AddStructuralResonance()</code></a></h3>
<h4 id="1-overview-20"><a class="header" href="#1-overview-20">1. overview</a></h4>
<ul>
<li>Function to add structural resonance inside the RW on the disturbance by harmonics of RW</li>
</ul>
<h4 id="2-input-and-output-1"><a class="header" href="#2-input-and-output-1">2. input and output</a></h4>
<ul>
<li>input:
<ul>
<li>N/A</li>
</ul>
</li>
<li>output:
<ul>
<li>jitter force and torque with structural resonance in component frame</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-16"><a class="header" href="#3-algorithm-16">3. algorithm</a></h4>
<ul>
<li>The transfer function from disturbance by harmonics of RW without resonance ( $u(t)$ ) to disturbance with resonance ( $y(t)$ ) is modeled as following equation: 
\[
G(s)=\frac{s^2+2\zeta\omega_ns+\omega_n^2}{s^2+2d\zeta\omega_ns+\omega_n^2}
\]
\[
Y(s)=G(s)U(s)
\]</li>
<li>where $\omega_n$ is the angular frequency on the structural resonance. Other parameters such as $\zeta$, $d$ are determined by the result of experiments.</li>
<li>To perform the simulation in discrete time, A bi-linear transformation $G(s)\rightarrow H(z)$ is applied. $T$ is the jitter update period. </li>
</ul>
<p>\[
\begin{aligned}
G(\frac{2}{T}\frac{z-1}{z+1})&amp;=\dfrac{(\frac{2}{T}\frac{z-1}{z+1})^2+2\zeta\omega_n(\frac{2}{T}\frac{z-1}{z+1})+\omega_n^2}{(\frac{2}{T}\frac{z-1}{z+1})^2+2d\zeta\omega_n(\frac{2}{T}\frac{z-1}{z+1})+\omega_n^2}\\
&amp;=\dfrac{(4+4\zeta T\omega_n+T^2\omega_n^2)+(-8+2T^2\omega_n^2)z^{-1}+(4-4\zeta T\omega_n+T^2\omega_n^2)z^{-2}}{(4+4d\zeta T\omega_n+T^2\omega_n^2)+(-8+2T^2\omega_n^2)z^{-1}+(4-4d\zeta T\omega_n+T^2\omega_n^2)z^{-2}}\\
&amp;=\dfrac{c_3+c_4z^{-1}+c_5z^{-2}}{c_0+c_1z^{-1}+c_2z^{-2}}\\
&amp;=H(z)
\end{aligned}
\]</p>
<ul>
<li>The $\omega_n$ should be the fixed value by pre-warping because there is frequency distortion due to bilinear transformation. The formula for calculating $\omega_n$ for the true resonant frequency $\omega_d$ is as follows:</li>
</ul>
<p>\[
\omega_n=\frac{2}{T}\tan(\frac{T\omega_d}{2})
\]</p>
<ul>
<li>The bi-linear transformation transforms the relationship between input $u$ and output $y$ as follows:</li>
</ul>
<p>\[
\begin{aligned}
Y(z)&amp;=H(z)U(z)\\
(c_0+c_1z^{-1}+c_2z^{-2})Y(z)&amp;=(c_3+c_4z^{-1}+c_5z^{-2})U(z)
\end{aligned}
\]</p>
<ul>
<li>
<p>By applying the inverse z-transform, the continuous relationship between $y(t)$ and $u(t)$ can be expressed as a  discrete relationship of a difference equation between $y[n]$ and $u[n]$, where $[n]$ is the current simulation time step. The difference equation is as follows:
\[
c_0y[n]+c_1y[n-1]+c_2y[n-2]=c_3u[n]+c_4u[n-1]+c_5u[n-2]
\]</p>
</li>
<li>
<p>Therefore, $y[n]$ is calculated as follows.
\[
y[n]=\frac{(-c_1y[n-1]-c_2y[n-2]+c_3u[n]+c_4u[n-1]+c_5u[n-2])}{c_0}
\]</p>
</li>
</ul>
<h2 id="3-results-of-verifications-5"><a class="header" href="#3-results-of-verifications-5">3. Results of verifications</a></h2>
<ul>
<li>In this section, jitter output when the RW is rotated at a constant speed is verified.</li>
</ul>
<h3 id="1-x-axis-torque-data-in-the-time-domain"><a class="header" href="#1-x-axis-torque-data-in-the-time-domain">1. X-axis torque data in the time domain</a></h3>
<h4 id="1-overview-21"><a class="header" href="#1-overview-21">1. overview</a></h4>
<ul>
<li>The RW model is rotated at 4000 rpm, 6000 rpm, and 8000 rpm, and the disturbance torque is compared with the actual experiment.</li>
</ul>
<h4 id="2-initial-condition"><a class="header" href="#2-initial-condition">2. initial condition</a></h4>
<ul>
<li>input files
<ul>
<li><code>sample_simulation_base.ini</code></li>
<li><code>reaction_wheel.ini</code></li>
</ul>
</li>
<li>initial condition
<ul>
<li><code>sample_simulation_base.ini</code>
<pre><code>EndTimeSec = 0.5
StepTimeSec = 0.0001
CompoUpdateIntervalSec = 0.0001
LogOutputIntervalSec = 0.0001
</code></pre>
</li>
<li><code>reaction_wheel.ini</code>
<pre><code>fast_prescaler = 1
max_angular_velocity = 9000.0
calculation = ENABLE
logging = ENABLE
harmonics_degree = 12
considers_structural_resonance = ENABLE
structural_resonance_freq = 585.0 //[Hz]
damping_factor = 0.1 //[ ]
bandwidth = 0.001 //[ ]
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="3-result-1"><a class="header" href="#3-result-1">3. result</a></h4>
<ul>
<li>The simulation result is compared with the disturbance experiment result of Sinclair RW0.003.</li>
</ul>
<div align="center">
<img src="Specifications/Component/AOCS/./figs/rw_jitter_torque_time_domain_sim.jpg" width=80% alt="Simulated RW jitter in time domain">
</div>
<ul>
<li>At all speeds, the characteristics of the actual RW are well simulated.</li>
</ul>
<h3 id="2-x-axis-torque-waterfall"><a class="header" href="#2-x-axis-torque-waterfall">2. X-axis torque waterfall</a></h3>
<h4 id="1-overview-22"><a class="header" href="#1-overview-22">1. overview</a></h4>
<ul>
<li>The RW model is rotated at 1000, 2000, ..., 9000rpm, and the jitter torque time-domain data was extracted. Then, FFT was applied to the data by Matlab, and the waterfall plot was plotted.</li>
</ul>
<h4 id="2-initial-condition-1"><a class="header" href="#2-initial-condition-1">2. initial condition</a></h4>
<ul>
<li>same as the initial condition of the verification about the time domain data</li>
</ul>
<h4 id="3-result-2"><a class="header" href="#3-result-2">3. result</a></h4>
<ul>
<li>The simulation result is compared with the disturbance experiment result of Sinclair RW0.003.</li>
</ul>
<div align="center">
<img src="Specifications/Component/AOCS/./figs/rw_waterfall_sim.jpg" width=80% alt="Simulated RW jitter in time domain">
</div>
<ul>
<li>Both the first-order mode and the structural resonance ($\omega_n=585\mathrm{Hz}$) are approximately simulated.</li>
</ul>
<h2 id="4-references-4"><a class="header" href="#4-references-4">4. References</a></h2>
<ol>
<li>Masterson, R. A. (1999). Development and validation of empirical and analytical reaction wheel disturbance models (Doctoral dissertation, Massachusetts Institute of Technology).</li>
<li>Shields, et al., (2017). Characterization of CubeSat reaction wheel assemblies. Journal of Small Satellites, 6(1), 565-580.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-telescope"><a class="header" href="#specification-for-telescope">Specification for Telescope</a></h1>
<h2 id="1--overview-20"><a class="header" href="#1--overview-20">1.  Overview</a></h2>
<ul>
<li>This class simulates a telescope.</li>
<li>This class uses the position information of celestial bodies and returns the following data:
<ul>
<li>Flags that show whether the bright celestial bodies(the Earth, the Moon, and the Sun) are in the forbidden angle of the telescope</li>
<li>Positions of the celestial bodies on the image sensor</li>
<li>Positions of stars on the image sensor</li>
</ul>
</li>
</ul>
<h3 id="1-functions-5"><a class="header" href="#1-functions-5">1. functions</a></h3>
<ul>
<li><code>MainRoutine</code> runs the following three functions:
<ul>
<li><code>JudgeForbiddenAngle</code>
<ul>
<li>Function to judge whether the celestial body is in the forbidden angle.</li>
</ul>
</li>
<li><code>Observe</code>
<ul>
<li>Function to 
<ul>
<li>judge whether the celestial body(provided by <code>CelesInfo</code>) is in the field of view.</li>
<li>output position of its image on the image sensor, if it is in the field of view.</li>
</ul>
</li>
</ul>
</li>
<li><code>ObserveStars</code>
<ul>
<li>Function to output some HIP IDs of the brightest stars in the field of view, using <code>HipparcosCatalogue</code>.</li>
<li>Specify how many stars this function outputs in <code>telescope.ini</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-files-2"><a class="header" href="#2-files-2">2. files</a></h3>
<ul>
<li><code>telescope.cpp</code> , <code>telescope.hpp</code>
<ul>
<li>Definitions and declarations of the class</li>
</ul>
</li>
<li><code>hipparcos_catalogue.cpp</code> , <code>hipparcos_catalogue.hpp</code>
<ul>
<li>Definitions and declarations of the class to read Hipparcos catalogue.</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-6"><a class="header" href="#3-how-to-use-6">3. how to use</a></h3>
<ul>
<li>Set the parameters in <code>telescope.ini</code></li>
<li>Create instance by using initialization function <code>InitTelescope</code>.
<ul>
<li>Each telescope is numbered as &quot;Telescope1,…&quot;</li>
</ul>
</li>
<li>To use <code>HipparcosCatalogue</code> data, <code>hip_main.csv</code> is necessary. <code>s2e-core/scripts/Common/download_HIPcatalogue.sh</code> is the script to download it. Run the following code using Git bash in <code>s2e-core/scripts/</code>:
<pre><code>bash download_HIPcatalogue.sh 
</code></pre>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-6"><a class="header" href="#2-explanation-of-algorithm-6">2. Explanation of Algorithm</a></h2>
<h3 id="1-judgeforbiddenangle"><a class="header" href="#1-judgeforbiddenangle">1. <code>JudgeForbiddenAngle</code></a></h3>
<h4 id="1-overview-23"><a class="header" href="#1-overview-23">1. overview</a></h4>
<ul>
<li>Function to judge whether a celestial body is in the forbidden angle.</li>
</ul>
<h4 id="2-input-and-output-2"><a class="header" href="#2-input-and-output-2">2. input and output</a></h4>
<ul>
<li>input
<ul>
<li>The position vector of the celestial body in the body-fixed coordinate.
<ul>
<li>This position vector is provided by <code>CelestialInformation</code>.</li>
</ul>
</li>
<li>The forbidden angle about the celestial body
<ul>
<li>Specify the forbidden angle in <code>telescope.ini</code>.</li>
</ul>
</li>
</ul>
</li>
<li>output
<ul>
<li>true: The celestial body is in forbidden angle</li>
<li>false: The celestial body is  not in forbidden angle</li>
</ul>
</li>
</ul>
<h4 id="3-process-to-judge"><a class="header" href="#3-process-to-judge">3. process to judge</a></h4>
<ul>
<li>The judging process is calculated in the telescope's component coordinate. $q_{b2c}$ is the quaternion to convert from the body coordinate(B) to the component coordinate(C). Specify $q_{b2c}$ in <code>telescope.ini</code>. The X-axis of the component coordinate is defined as the line of sight of the telescope.</li>
</ul>
<h3 id="2-observe"><a class="header" href="#2-observe">2. <code>Observe</code></a></h3>
<h4 id="1-overview-24"><a class="header" href="#1-overview-24">1. overview</a></h4>
<ul>
<li>This function judges whether the celestial bodies(provided by <code>CelestialInformation</code>) are in the field of view and outputs the position of them on the image sensor if they are in the field of view</li>
<li>If they are not in the field of view, this function outputs $(-1,-1)$.</li>
</ul>
<h4 id="2-input-and-output-3"><a class="header" href="#2-input-and-output-3">2. input and output</a></h4>
<ul>
<li>input
<ul>
<li>The reference to the position of the celestial body on the image sensor</li>
<li>The position vector of the celestial body in the body-fixed coordinate
<ul>
<li><code>CelestialInformation</code> provides the position vector.</li>
</ul>
</li>
</ul>
</li>
<li>output
<ul>
<li>(void)
<ul>
<li>This function rewrites the &quot;reference to the celestial body's position on the image sensor&quot; given as the input.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-17"><a class="header" href="#3-algorithm-17">3. algorithm</a></h4>
<h5 id="1-calculate-process-to-judge-whether-the-celestial-body-is-in-the-field-of-view"><a class="header" href="#1-calculate-process-to-judge-whether-the-celestial-body-is-in-the-field-of-view">1. Calculate process to judge whether the celestial body is in the field of view</a></h5>
<ul>
<li>A 2D coordinate on the image sensor is defined to handle the position on the image sensor. The definition is as follows:
<ul>
<li>The X-axis of the image sensor coordinate corresponds with the Z-axis of the component coordinate.</li>
<li>The Y-axis of the image sensor coordinate corresponds with the Y-axis of the component coordinate.</li>
</ul>
</li>
<li>Then, the inclination angle from the X-axis of the celestial body's direction in the XZ plane of the component coordinate is calculated using $(x_c, y_c, z_c)$ as follows:</li>
</ul>
<p>\[
tan^{-1}⁡\frac{z_c}{x_c}
\]</p>
<ul>
<li>In the same way, the inclination angle from the X-axis of the celestial body's direction in the XY plane of the component coordinate is calculated as follows:</li>
</ul>
<p>\[
tan^{-1}⁡\frac{y_c}{x_c}
\]</p>
<ul>
<li>They are written as <code>arg_x</code> and <code>arg_y</code> in the code. In this manual, $\theta_x$ and $\theta_y$ are used for them. If $\theta_x$ is within FOV_x and $\theta_y$ is within FOV_y, the celestial body is judged to be in the field of view.</li>
</ul>
<div align="center">
<figure id="coordinate">
<img src="Specifications/Component/Mission/./figs/coordinate.JPG" width=400 alt="The relationship between the component coordinate(C) and the sensor coordinate(imgsensor)">
<figcaption>Fig. 1. The relationship between the component coordinate(C) and the sensor coordinate(imgsensor)</figcaption>
</figure>
</div>
<h5 id="2-calculate-process-for-calculating-the-position-of-the-image"><a class="header" href="#2-calculate-process-for-calculating-the-position-of-the-image">2. Calculate process for calculating the position of the image</a></h5>
<ul>
<li>The origin of the sensor coordinate is the corner of the image sensor, so $x_{imgsensor}$ and $y_{imgsensor}$ have positive values. The unit of them is pixel(pix). In this manual, $N_x$ and $N_y$ are used for the total number of pixels along x, y axes of the sensor coordinate (They are <code>x_num_of_pix</code> and <code>y_num_of_pix</code> in the code). In the same way, <code>X</code> and <code>Y</code> are used for the position of the celestial body on the image sensor (They are <code>pos_imgsensor[0]</code> and <code>pos_imgsensor[1]</code>). Then, <code>X</code> and <code>Y</code> are calculated as follows:
\[
X=\frac{N_x}{2}\times\frac{\tan(\theta_x)}{\tan(FOV_x)}+\frac{N_x}{2}
\]
\[
Y=\frac{N_y}{2}\times\frac{\tan(\theta_y)}{\tan(FOV_y)}+\frac{N_y}{2}
\]</li>
</ul>
<p>If the celestial body is not in the field of view, the output is $X=Y=-1$.</p>
<h3 id="3-observestars"><a class="header" href="#3-observestars">3. <code>ObserveStars</code></a></h3>
<h4 id="1-overview-25"><a class="header" href="#1-overview-25">1. overview</a></h4>
<ul>
<li>Function to output some HIP IDs of the brightest stars in the field of view, using <code>HipparcosCatalogue</code></li>
</ul>
<h4 id="2-input-and-output-4"><a class="header" href="#2-input-and-output-4">2. input and output</a></h4>
<ul>
<li>input
<ul>
<li>(void)</li>
</ul>
</li>
<li>output
<ul>
<li>(void)</li>
</ul>
</li>
</ul>
<h4 id="3-main-process"><a class="header" href="#3-main-process">3. main process</a></h4>
<p>When <code>ObserveStars</code> is called in the <code>MainRoutine</code>, this function works as follows:</p>
<ol>
<li>Clear <code>star_in_sight</code></li>
<li>Judge the brightest star (provided by <code>HipparcosCatalogue</code>) is in the field of view</li>
<li>If the star is in the field of view, push the information (such as the HIP ID and its position on the image sensor) to <code>star_in_sight</code></li>
<li>Go to step 2. to judge the next brightest star</li>
<li>Exit the loop when the number of elements of <code>star_in_sight</code> reaches the specified number</li>
</ol>
<h4 id="4-error-handling"><a class="header" href="#4-error-handling">4. error handling</a></h4>
<p>If all the data in <code>HipparcosCatalogue</code> are checked before the number of elements of <code>star_in_sight</code> reaches the specified number, the data of lacking element is filled with -1.</p>
<h2 id="3-results-of-verifications-6"><a class="header" href="#3-results-of-verifications-6">3. Results of verifications</a></h2>
<p>In this section, the output of the functions when some angular velocity is input is verified.</p>
<h3 id="1-input-of-angular-velocity-around-x-axis-of-the-body-coordinate"><a class="header" href="#1-input-of-angular-velocity-around-x-axis-of-the-body-coordinate">1. Input of angular velocity around X-axis of the body coordinate</a></h3>
<h4 id="1-overview-26"><a class="header" href="#1-overview-26">1. overview</a></h4>
<ul>
<li>input $ω_b=[0.1~0~0]^T$ ． </li>
</ul>
<h4 id="2-conditions-for-the-verification-2"><a class="header" href="#2-conditions-for-the-verification-2">2. conditions for the verification</a></h4>
<ul>
<li>input files
<ul>
<li><code>sample_simulation_base.ini</code></li>
<li><code>telescope.ini</code></li>
</ul>
</li>
<li>initial condition
<ul>
<li><code>sample_simulation_base.ini</code>
<pre><code>Simulation start date[UTC] : 2017/12/01 11:00:00.0
Simulation finish time[sec] : 1500
Quaternion : q_i2b=[0 0 0 1]^T
</code></pre>
</li>
<li><code>telescope.ini</code>
<pre><code>q_b2c=[0 0 0 1]^T
sun_forbidden_angle = 60
earth_forbidden_angle = 60
moon_forbidden_angle = 60
x_num_of_pix = 2048
y_num_of_pix = 2048
x_fov_par_pix = 0.02
y_fov_par_pix = 0.02
</code></pre>
</li>
<li><code>sample_simulation_base.ini</code>
<pre><code>[HIPPARCOS_CATALOGUE]
max_magnitude = 5.0
calculation = ENABLE
logging = DISABLE
</code></pre>
</li>
</ul>
</li>
</ul>
<p>The disturbance torque in the main function of <code>sample_case.cpp</code> is commented out.</p>
<h4 id="3-result-3"><a class="header" href="#3-result-3">3. result</a></h4>
<ol>
<li>judge for forbidden angle
<ul>
<li>The angle from the line of sight about the direction of the Sun, the Earth, the Moon is as follows:</li>
</ul>
</li>
</ol>
<div align="center">
  <figure id="angle_celes1">
  <img src="Specifications/Component/Mission/./figs/angle_celes1.jpg" width=400 alt="The angle from the line of sight about the direction of the Sun, the Earth, the Moon">
  <figcaption>The angle from the line of sight about the direction of the Sun, the Earth, the Moon</figcaption>
  </figure>
  </div>
  Then, the result of the judge for the forbidden angles is as follows:
  <div align="center">
  <figure id="forbidden_angle1">
  <img src="Specifications/Component/Mission/./figs/forbidden_angle1.jpg" width=400 alt="result of the judge for the forbidden angles about the Sun, the Earth, the Moon">
  <figcaption>result of the judge for the forbidden angles about the Sun, the Earth, the Moon</figcaption>
  </figure>
  </div>
  The above figures show that the judge correctly detects when a celestial body in its forbidden angle.
<ol start="2">
<li><code>Observe</code> function
<ul>
<li>Only the Moon and the Earth are in the field of view (See the figure &quot;The angle from the line of sight about the direction of the Sun, the Earth, the Moon&quot;). The track of the image of the Moon on the image sensor is as follows: </li>
</ul>
</li>
</ol>
<div align="center">
  <figure id="track_moon1">
  <img src="Specifications/Component/Mission/./figs/track_moon1.jpg" width=400 alt="The track of the image of the Moon on the image sensor">
  <figcaption>The track of the image of the Moon on the image sensor</figcaption>
  </figure>
  </div>
  This figure shows the track makes a circle. This result seems to be reasonable, because the angular velocity around the X-axis of the body coordinate correspond with that of the component coordinate, for $q_{b2c}=[0~0~0~1]^T$ . The 3D plot of MOON_POS_B for further verification is as follows:
  <div align="center">
  <figure id="moon_pos_b1">
  <img src="Specifications/Component/Mission/./figs/moon_pos_b1.jpg" width=400 alt="3D plot of MOON_POS_B">
  <figcaption>3D plot of MOON_POS_B</figcaption>
  </figure>
  </div>
  Considering that the projection of the track of MOON_POS_B to the YZ plane corresponds the track of the image on the image sensor because the line of sight is the X-axis, the result also seems to be reasonable. Next, the track of the image of the Moon on the image sensor is as follows:
  <div align="center">
  <figure id="track_earth1">
  <img src="Specifications/Component/Mission/./figs/track_earth1.jpg" width=400 alt="The track of the image of the Earth on the image sensor">
  <figcaption>The track of the image of the Earth on the image sensor</figcaption>
  </figure>
  </div>
<p>In addition, the 3D plot of EARTH_POS_B is as follows:</p>
<div align="center">
  <figure id="earth_pos_b1">
  <img src="Specifications/Component/Mission/./figs/earth_pos_b1.jpg" width=400 alt="3D plot of EARTH_POS_B">
  <figcaption>3D plot of EARTH_POS_B</figcaption>
  </figure>
  </div>
  As well as the Moon case, this result seems to be reasonable because the projection of the track of the Earth to the YZ plane corresponds with the track of the image.
<ol start="3">
<li><code>ObserveStars</code>function</li>
</ol>
<ul>
<li>The first, second, and third HIP ID outputs were 113368, 9884, and 3419. Their track on the image sensor are as follows:</li>
</ul>
<div align="center">
  <figure id="observe_stars1">
  <img src="Specifications/Component/Mission/./figs/observe_stars1.jpg" width=400 alt="The stars' track on the image sensor">
  <figcaption>The stars' track on the image sensor</figcaption>
  </figure>
  </div>
<p>The tracks make circles, which are the reasonable outputs because of the same reason stated in the verification of <code>Observe</code> function. In addition, the each Vmag of HIP ID=113368，9884，and 3419 is 1.17，2.01，and 2.04, so it is verified that the outputs are in order of brightness.</p>
<h3 id="2-input-of-angular-velocity-around-y-axis-of-the-body-coordinate"><a class="header" href="#2-input-of-angular-velocity-around-y-axis-of-the-body-coordinate">2. input of angular velocity around y axis of the body coordinate</a></h3>
<h4 id="1-overview-27"><a class="header" href="#1-overview-27">1. overview</a></h4>
<ul>
<li>The angular velocity input is $ω_b=[0.1~0~0]^T$ ．The other condition is the same as the case of 1. Note that the verification of the case around z axis is omitted because y and z are equivalent under this condition.</li>
</ul>
<h4 id="2-result"><a class="header" href="#2-result">2. result</a></h4>
<ol>
<li>judge for forbidden angle</li>
</ol>
<ul>
<li>The angle from the line of sight about the direction of the Sun, the Earth, the Moon is as follows:</li>
</ul>
<div align="center">
<figure id="angle_celes2">
<img src="Specifications/Component/Mission/./figs/angle_celes2.jpg" width=400 alt="The angle from the line of sight about the direction of the Sun, the Earth, the Moon">
<figcaption>The angle from the line of sight about the direction of the Sun, the Earth, the Moon</figcaption>
</figure>
Then, the result of the judge for the forbidden angles is as follows:
<figure id="forbidden_angle2">
<img src="Specifications/Component/Mission/./figs/forbidden_angle2.jpg" width=400 alt="The result of the judge for the forbidden angles">
<figcaption>The result of the judge for the forbidden angles</figcaption>
</figure>
</div>
These above figures show that the judge is correctly conducted when a celestial body in its forbidden angle.
<ol start="2">
<li><code>Observe</code> function</li>
</ol>
<ul>
<li>The figure &quot;The angle from the line of sight about the direction of the Sun, the Earth, the Moon&quot; shows that the earth is mainly in the field of view, so this section discusses only about the Earth. The track of the image of the Earth is as follows (For the sake of ease, only 4 tracks in the field of view are displayed):</li>
</ul>
<div align="center">
<figure id="track_earth2">
<img src="Specifications/Component/Mission/./figs/track_earth2.jpg" width=400 alt="The track of the image of the Earth on the image sensor">
<figcaption>The track of the image of the Earth on the image sensor</figcaption>
</figure>
</div>
In addition, the 3D plot of EARTH_POS_B is as follows:
<div align="center">
<figure id="earth_pos_b2">
<img src="Specifications/Component/Mission/./figs/earth_pos_b2.jpg" width=400 alt="3D plot of EARTH_POS_B">
<figcaption>3D plot of EARTH_POS_B</figcaption>
</figure>
</div>
The 3D plot of EARTH_POS_B shows that the track of EARTH_POS_B is a spiral which axis is at right angle to the line of sight. In this case, it can be showed that the track on image sensor forms a hyperbola(The proof for this is omitted). Considering this fact, the result seems to be reasonable.
<ol start="3">
<li><code>ObserveStars</code> function</li>
</ol>
<ul>
<li>The tracks of the stars are partially as follows:</li>
</ul>
<div align="center">
<figure id="observe_stars2">
<img src="Specifications/Component/Mission/./figs/observe_stars2.jpg" width=400 alt="The stars' track on the image sensor">
<figcaption>The stars' track on the image sensor</figcaption>
</figure>
</div>
As mentioned in `Observe` function section, they form hyperbolas which axis of symmetry is Y=1024. In addition, it was confirmed that the data was output in order of the brightness on each time (The result is complicated, so it is not list in this manual).
<h2 id="4-references-5"><a class="header" href="#4-references-5">4. References</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-of-powercontrolunit-class"><a class="header" href="#specification-of-powercontrolunit-class">Specification of PowerControlUnit class</a></h1>
<h2 id="1--overview-21"><a class="header" href="#1--overview-21">1.  Overview</a></h2>
<h3 id="1-functions-6"><a class="header" href="#1-functions-6">1. Functions</a></h3>
<ul>
<li><code>PowerControlUnit</code> class is a base class of power control units and manages multiple <code>PowerPorts</code>.</li>
</ul>
<h3 id="2-related-files-4"><a class="header" href="#2-related-files-4">2. Related files</a></h3>
<ul>
<li>Main file: <code>power_control_unit.cpp, .hpp</code></li>
<li>Related file: <code>power_port.cpp, .hpp</code></li>
</ul>
<h3 id="3-how-to-use-7"><a class="header" href="#3-how-to-use-7">3. How to use</a></h3>
<ul>
<li><strong>Example</strong>: The <code>sample_components</code> in the <code>s2e-core/simulation_sample/spacecraft</code> is useful to know how to use this class.</li>
<li>Users can make their original <code>PowerControlUnit</code> class by inheriting this base class.</li>
<li>Users need to override the <code>MainRoutine</code>, <code>GetLogHeader</code>, and <code>GetLogValue</code> functions to define the behavior of their PCUs. </li>
</ul>
<h2 id="2-explanation-of-algorithm-7"><a class="header" href="#2-explanation-of-algorithm-7">2. Explanation of Algorithm</a></h2>
<h3 id="1-connectport"><a class="header" href="#1-connectport">1. ConnectPort</a></h3>
<h4 id="1-overview-28"><a class="header" href="#1-overview-28">1. overview</a></h4>
<ul>
<li>This function makes a new <code>PowerPort</code>.</li>
</ul>
<h4 id="2-inputs-and-outputs-9"><a class="header" href="#2-inputs-and-outputs-9">2. inputs and outputs</a></h4>
<ul>
<li>Inputs: the port ID and the arguments for <code>PowerPort</code></li>
<li>Outputs: the error code (0 is a success, -1 is an error)</li>
</ul>
<h4 id="3-algorithm-18"><a class="header" href="#3-algorithm-18">3. algorithm</a></h4>
<ul>
<li>Make a new <code>PowerPort</code> when the port ID is not used.</li>
</ul>
<h4 id="4-note-na"><a class="header" href="#4-note-na">4. note: N/A</a></h4>
<h3 id="2-closeport"><a class="header" href="#2-closeport">2. ClosePort</a></h3>
<h4 id="1-overview-29"><a class="header" href="#1-overview-29">1. overview</a></h4>
<ul>
<li>This function deletes the designated <code>PowerPort</code>.</li>
</ul>
<h4 id="2-inputs-and-outputs-10"><a class="header" href="#2-inputs-and-outputs-10">2. inputs and outputs</a></h4>
<ul>
<li>Inputs: the port ID.</li>
<li>Outputs: the error code (0 is a success, -1 is an error).</li>
</ul>
<h4 id="3-algorithm-19"><a class="header" href="#3-algorithm-19">3. algorithm</a></h4>
<ul>
<li>Delete the designated <code>PowerPort</code> when the port still exists.</li>
</ul>
<h4 id="4-note-na-1"><a class="header" href="#4-note-na-1">4. note: N/A</a></h4>
<h2 id="3-results-of-verifications-7"><a class="header" href="#3-results-of-verifications-7">3. Results of verifications</a></h2>
<p>N/A</p>
<h2 id="4-references-6"><a class="header" href="#4-references-6">4. References</a></h2>
<p>N/A</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-thruster"><a class="header" href="#specification-for-thruster">Specification for Thruster</a></h1>
<h2 id="1--overview-22"><a class="header" href="#1--overview-22">1.  Overview</a></h2>
<ul>
<li>This class simulates a thruster and contains functions for it.</li>
</ul>
<h3 id="1-functions-7"><a class="header" href="#1-functions-7">1. functions</a></h3>
<ul>
<li>By setting the thruster valve open and close, thruster torque and force are generated.</li>
<li>The thruster model includes the magnitude and directional errors in the ini file.</li>
<li>According to the thruster output, users can set the thrust duty to the value between 0 and 1.</li>
</ul>
<h3 id="2-files-3"><a class="header" href="#2-files-3">2. files</a></h3>
<ul>
<li><code>simple_thruster.cpp</code> , <code>simple_thruster.hpp</code>
<ul>
<li>Definitions and declarations of the class</li>
</ul>
</li>
<li><code>thruster.ini</code>
<ul>
<li>Parameters for a/multiple thruster(s)</li>
</ul>
</li>
<li><code>plot_simple_thruster.py</code>: An example of a Python script to plot simple thruster output</li>
</ul>
<h3 id="3-how-to-use-8"><a class="header" href="#3-how-to-use-8">3. how to use</a></h3>
<ul>
<li>Set the parameters written in <code>thruster.ini</code>.
<ul>
<li>Users can set multiple thrusters.</li>
</ul>
</li>
<li>Create an instance by <code>SimpleThruster</code> function.</li>
<li>Add <code>calc_thrust</code> function to <code>GenerateForce_b()</code> in <code>SatComponents</code> class and <code>calc_torque</code> function to <code>GenerateTorque_b()</code> in <code>SatComponents</code> class
<ul>
<li><code>calc_torque</code> function requires a position of the spacecraft's mass center as an argument.</li>
</ul>
</li>
<li>When a thruster is open, set the duty to 1 by <code>set_duty(1)</code> function.
<ul>
<li>Users can set duty to the value between 0 and 1.</li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-8"><a class="header" href="#2-explanation-of-algorithm-8">2. Explanation of Algorithm</a></h2>
<h3 id="1-thrust"><a class="header" href="#1-thrust">1. Thrust</a></h3>
<h4 id="1-overview-30"><a class="header" href="#1-overview-30">1. overview</a></h4>
<ul>
<li>Thrust magnitude is a scalar value of thrust.</li>
<li>Thrust contains the magnitude and direction errors according to the ini file setting.</li>
<li>Thrust magnitude calculation considers the duty of thruster. If the thruster valve is closed, the thrust magnitude is 0. </li>
</ul>
<h4 id="2-input-and-output-5"><a class="header" href="#2-input-and-output-5">2. input and output</a></h4>
<ul>
<li>input
<ul>
<li>Thruster duty ratio</li>
<li>Maximum thrust magnitude <code>thrust_magnitude_N</code></li>
<li>Thrust direction <code>thruster_direction_b</code></li>
<li>Thrust magnitude error <code>thrust_error_standard_deviation_N</code></li>
<li>Thrust direction error <code>direction_error_standard_deviation_deg</code></li>
</ul>
</li>
<li>output
<ul>
<li>Thrust magnitude and direction</li>
</ul>
</li>
</ul>
<h4 id="3-algorithms"><a class="header" href="#3-algorithms">3. algorithms</a></h4>
<p>Thrust magnitude can be calculated as follows:</p>
<p>\[
F_{thrust}  = \epsilon * F_{max} + n_{f}
\]</p>
<p>where $F_{thrust}$ is thrust magnitude, $\epsilon$ is the duty of thruster, $F_{max}$ is the maximum thrust magnitude, and $n_{f}$ is the error of thrust magnitude.</p>
<p>Thrust direction can be calculated as follows:</p>
<p>\[
\boldsymbol{d}_{err} = \boldsymbol{q}(\boldsymbol{d}_{true},n) * \boldsymbol{d}<em>x
\]
\[
\boldsymbol{d}_{thrust} = \boldsymbol{q}(\boldsymbol{d}_{err},n</em>{d}) * \boldsymbol{d}_{true}
\]</p>
<p>where</p>
<ul>
<li>$\boldsymbol{d}_{true}$ is the thrust vector without errors</li>
<li>$n$ is the random angles to rotate the direction of error $\boldsymbol{d}_{err}$</li>
<li>$\boldsymbol{d}_{x}$ is the vector which is not equal to $\boldsymbol{d}_{true}$</li>
<li>$n_d$ is the directional error</li>
<li>$\boldsymbol{d}_{thrust}$ is the thrust vector with errors</li>
<li>$\boldsymbol{q}(\boldsymbol{d},n)$ is the quaternion which has the rotation axis $\boldsymbol{d}$ and the rotation angle $n$ .</li>
</ul>
<p>Thrust can be calculated as follows:</p>
<p>\[
\boldsymbol{F}_{thrust} = F_{thrust} * \boldsymbol{d}_{thrust}
\]</p>
<p>where $\boldsymbol{F}_{thrust}$ is thrust.</p>
<h3 id="2-torque"><a class="header" href="#2-torque">2. Torque</a></h3>
<h4 id="1-overview-31"><a class="header" href="#1-overview-31">1. overview</a></h4>
<ul>
<li>Torque by thruster is calculated from the thrust vector and the vector between the center of mass of the spacecraft and thruster.</li>
</ul>
<h4 id="2-input-and-output-6"><a class="header" href="#2-input-and-output-6">2. input and output</a></h4>
<ul>
<li>input
<ul>
<li>Thruster position <code>thruster_position_b_m</code></li>
<li>Mass center of spacecraft</li>
<li>Thrust magnitude and direction</li>
</ul>
</li>
<li>output
<ul>
<li>Torque</li>
</ul>
</li>
</ul>
<h4 id="3-algorithms-1"><a class="header" href="#3-algorithms-1">3. algorithms</a></h4>
<p>Torque by the thruster can be calculated as follows:</p>
<p>\[
\boldsymbol{T}_{thrust} = (\boldsymbol{v}_{thruster}-\boldsymbol{v}_{SC}) \times \boldsymbol{F}_{thrust}
\]</p>
<p>where</p>
<ul>
<li>$\boldsymbol{T}_{thrust}$ is torque by the thruster</li>
<li>$\boldsymbol{v}_{thruster}$ is thruster position</li>
<li>$\boldsymbol{v}_{SC}$ is the mass center of spacecraft.</li>
</ul>
<h2 id="3-results-of-verifications-8"><a class="header" href="#3-results-of-verifications-8">3. Results of verifications</a></h2>
<h3 id="1-case1"><a class="header" href="#1-case1">1. Case1</a></h3>
<ul>
<li>
<p>input</p>
<ul>
<li>Position <code>thruster_position_b_m</code> : [0m, 0m, 0.1m]</li>
<li>Direction <code>thruster_direction_b</code> : [0, 0, 1]</li>
<li>Thrust magnitude <code>thrust_magnitude_N</code> : 0.001N </li>
<li>Thrust magnitude error <code>thrust_error_standard_deviation_N</code> : 0.0N</li>
<li>Thrust direction error <code>direction_error_standard_deviation_deg</code> : 0.0deg</li>
<li>Simulation time: 100sec</li>
</ul>
</li>
<li>
<p>result</p>
<ul>
<li>
<p>Force Mean: [0,0,0.001] N</p>
</li>
<li>
<p>Force Std Dev: [0,0,0] N</p>
<div align="center">
<figure id="thrust_force1">
<img src="Specifications/Component/Propulsion/./figs/thrust_force1.png" width=400>
<figcaption>Thrust force values in N unit.</figcaption>
</figure>
</div>
</li>
<li>
<p>Torque Mean: [0,0,0] Nm</p>
</li>
<li>
<p>Torque Std Dev: [0,0,0] Nm</p>
<div align="center">
<figure id="thrust_torque1">
<img src="Specifications/Component/Propulsion/./figs/thrust_torque1.png" width=400>
<figcaption>Thrust torque values in Nm unit.</figcaption>
</figure>
</div>
</li>
</ul>
</li>
</ul>
<h3 id="2-case2"><a class="header" href="#2-case2">2. Case2</a></h3>
<ul>
<li>input
<ul>
<li>Position <code>thruster_position_b_m</code> : [0, 0, 0.1] m</li>
<li>Direction <code>thruster_direction_b</code> : [0, 0, 1]</li>
<li>Thrust magnitude <code>thrust_magnitude_N</code> : 0.001N </li>
<li>Thrust magnitude error <code>thrust_error_standard_deviation_N</code> : 0.00001N</li>
<li>Thrust direction error <code>direction_error_standard_deviation_deg</code> : 0.0deg</li>
<li>Simulation time: 100sec </li>
</ul>
</li>
<li>result
<ul>
<li>
<p>Force Mean: [0,0,0.999611e-3] N</p>
</li>
<li>
<p>Force Std Dev: [0,0,1.09804e-5] N</p>
<div align="center">
<figure id="thrust_force2">
<img src="Specifications/Component/Propulsion/./figs/thrust_force2.png" width=400>
<figcaption>Thrust force values in N unit.</figcaption>
</figure>
</div>
</li>
<li>
<p>Torque Mean: [0,0,0] Nm</p>
</li>
<li>
<p>Torque Std Dev: [0,0,0] Nm</p>
<div align="center">
<figure id="thrust_torque2">
<img src="Specifications/Component/Propulsion/./figs/thrust_torque2.png" width=400>
<figcaption>Thrust torque values in Nm unit.</figcaption>
</figure>
</div>
</li>
</ul>
</li>
</ul>
<h3 id="3-case3"><a class="header" href="#3-case3">3. Case3</a></h3>
<ul>
<li>input
<ul>
<li>Position <code>thruster_position_b_m</code> : [0, 0, 0.1] m</li>
<li>Direction <code>thruster_direction_b</code> : [0, 0, 1]</li>
<li>Thrust magnitude <code>thrust_magnitude_N</code> : 0.001N </li>
<li>Thrust magnitude error <code>thrust_error_standard_deviation_N</code> : 0.0N</li>
<li>Thrust direction error <code>direction_error_standard_deviation_deg</code> : 10.0deg</li>
<li>Simulation time: 100sec</li>
</ul>
</li>
<li>result
<ul>
<li>
<p>Force Mean: [-4.93e-6, -1.04e-5, 0.9834e-3] N</p>
</li>
<li>
<p>Force Std Dev: [1.0e-4, 9.79e-5, 1.216e-5] N</p>
<div align="center">
<figure id="thrust_force3">
<img src="Specifications/Component/Propulsion/./figs/thrust_force3.png" width=400>
<figcaption>Thrust force values in N unit.</figcaption>
</figure>
</div>
</li>
<li>
<p>Torque Mean: [1.04e-6,-4.94e-7,0] Nm</p>
</li>
<li>
<p>Torque Std Dev: [1.29e-5, 1.26e-5, 0] Nm</p>
<div align="center">
<figure id="thrust_torque3">
<img src="Specifications/Component/Propulsion/./figs/thrust_torque3.png" width=400>
<figcaption>Thrust torque values in Nm unit.</figcaption>
</figure>
</div>
</li>
</ul>
</li>
</ul>
<h3 id="4-case4"><a class="header" href="#4-case4">4. Case4</a></h3>
<ul>
<li>input
<ul>
<li>Position <code>thruster_position_b_m</code> : [0, 0.1, 0] m</li>
<li>Direction <code>thruster_direction_b</code> : [0, 0, 1]</li>
<li>Thrust magnitude <code>thrust_magnitude_N</code> : 0.001N </li>
<li>Thrust magnitude error <code>thrust_error_standard_deviation_N</code> : 0.0N</li>
<li>Thrust direction error <code>direction_error_standard_deviation_deg</code> : 0.0deg</li>
<li>Simulation time: 100sec</li>
</ul>
</li>
<li>result
<ul>
<li>
<p>Force Mean: [0,0,0.001] N</p>
</li>
<li>
<p>Force Std Dev: [0,0,0] N</p>
<div align="center">
<figure id="thrust_force4">
<img src="Specifications/Component/Propulsion/./figs/thrust_force4.png" width=400>
<figcaption>Thrust force values in N unit.</figcaption>
</figure>
</div>
</li>
<li>
<p>Torque Mean: [0.0001,0,0] Nm</p>
</li>
<li>
<p>Torque Std Dev: [0,0,0] Nm</p>
<div align="center">
<figure id="thrust_torque4">
<img src="Specifications/Component/Propulsion/./figs/thrust_torque4.png" width=400>
<figcaption>Thrust torque values in Nm unit.</figcaption>
</figure>
</div>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-of-geopotential-calculation"><a class="header" href="#specification-of-geopotential-calculation">Specification of Geopotential Calculation</a></h1>
<h2 id="1--overview-23"><a class="header" href="#1--overview-23">1.  Overview</a></h2>
<h3 id="1-functions-8"><a class="header" href="#1-functions-8">1. Functions</a></h3>
<ul>
<li>The <code>Geopotential</code> class calculates the gravity acceleration of the earth with the <a href="https://cddis.nasa.gov/926/egm96/">EGM96</a> geo-potential model.</li>
</ul>
<h3 id="2-related-files-5"><a class="header" href="#2-related-files-5">2. Related files</a></h3>
<ul>
<li><code>src/disturbances/geopotential.cpp, .hpp</code></li>
<li><code>src/library/gravity/gravity_potential.cpp, .hpp</code></li>
<li><code>s2e-core/ExtLibraries/GeoPotential/egm96_to360.ascii</code>
<ul>
<li>The EGM96 geopotential coefficients file was downloaded from <a href="https://cddis.nasa.gov/926/egm96/getit.html">NASA's EMG96 website</a>, but we cannot access it now.</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-9"><a class="header" href="#3-how-to-use-9">3. How to use</a></h3>
<ul>
<li>Make an instance of the <code>Geopotential</code> class in <code>InitializeInstances</code> function in <code>disturbances.cpp</code>
<ul>
<li>Create an instance by using the initialization function <code>InitGeopotential</code></li>
</ul>
</li>
<li>Choose an orbit propagator mode that considers disturbances.</li>
<li>Edit the <code>disturbance.ini</code> file
<ul>
<li>Select <code>ENABLE</code> for <code>calculation</code> and <code>logging</code></li>
<li>Select <code>degree</code> of calculation
<ul>
<li>When the <code>degree</code> is smaller than 1, it is overwritten as 0.</li>
<li>When the <code>degree</code> is larger than 360, it is overwritten as 360.</li>
<li><strong>NOTE</strong>: The calculation time is related to the selected degree.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-9"><a class="header" href="#2-explanation-of-algorithm-9">2. Explanation of Algorithm</a></h2>
<ul>
<li>The base algorithm is referred to <a href="https://www.springer.com/jp/book/9783540672807">Satellite Orbits</a> chapter 3.2.</li>
</ul>
<h3 id="1-read-coefficients"><a class="header" href="#1-read-coefficients">1. Read coefficients</a></h3>
<h4 id="1-overview-32"><a class="header" href="#1-overview-32">1. overview</a></h4>
<ul>
<li>This function reads the geopotential coefficients from the EGM96 file <code>egm96_to360.ascii</code>.</li>
<li>The file doesn't have coefficients for <code>n=0,m=0</code>, <code>n=1,m=0</code>, and <code>n=1,m=1</code>. </li>
<li>All coefficients are completely normalized by following normalization function $N_{n,m}$</li>
</ul>
<p>\[
N_{n,m}=\sqrt{\frac{(n+m)!}{(2-\delta_{0m})(2n+1)(n-m)!}}\\
\]</p>
<ul>
<li>where $\delta_{0m}$ is the Kronecker delta.</li>
</ul>
<h4 id="2-inputs-and-outputs-11"><a class="header" href="#2-inputs-and-outputs-11">2. inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>file path of <code>egm96_to360.ascii</code></li>
<li>maximum degree for geopotential calculation</li>
</ul>
</li>
<li>Output
<ul>
<li><strong>Return</strong>: reading is succeeded or not.</li>
<li>Normalized coefficient  $C_{n,m}$ and $S_{n,m}$ </li>
</ul>
</li>
</ul>
<ol start="3">
<li>algorithm</li>
</ol>
<ul>
<li>The file format of <code>egm96_to360.ascii</code> is <code>n,m,Cnm,Snm,sigmaCnm,sigmaSnm</code> in line with space  delimiter. In this calculation, the <code>sigmaCnm</code> and <code>sigmaSnm</code> are not used.</li>
<li>The total number of reading lines is defined as the following equation
\[
N_{line}=\frac{1}{2}(n+1)(n+2)-3
\]
<ul>
<li>where $n$ is maximum degree, and -3 is for the coefficients of <code>n=0,m=0</code>, <code>n=1,m=0</code>, and <code>n=1,m=1</code>, which are not in the file. </li>
</ul>
</li>
</ul>
<ol start="4">
<li>note</li>
</ol>
<ul>
<li><strong>When the reading file process is failed</strong>, the maximum degree is set to zero, and a simple Kepler calculation will be executed.</li>
</ul>
<h3 id="2-calculate-legendre-polynomials-with-recursion-algorithm"><a class="header" href="#2-calculate-legendre-polynomials-with-recursion-algorithm">2. Calculate Legendre polynomials with recursion algorithm</a></h3>
<h4 id="1-overview-33"><a class="header" href="#1-overview-33">1. overview</a></h4>
<ul>
<li>We chose to use the recursion algorithm written in chapter 3.2.4 of <a href="https://www.springer.com/jp/book/9783540672807">Satellite Orbits</a> since the calculation of the Legendre polynomials for spherical harmonics is time-consuming.
<ul>
<li>However, the original equation in the book is unnormalized form, and it is not suitable with the normalized coefficients. </li>
<li>For a small degree, users can directly use the normalized function $N_{n,m}$  to unnormalize the coefficients or to normalize the functions $V_{n,m}$ and $V_{n,m}$ . But for a large degree, the factorial calculation in the $N_{n,m}$ reaches a huge value, which standard <code>double</code> variables cannot handle.</li>
<li>To avoid that, the normalized recursion algorithm was derived as described in Section 3.</li>
</ul>
</li>
<li>There are the following two functions:
<ul>
<li><code>v_w_nn_update</code></li>
<li><code>v_w_nm_update</code></li>
</ul>
</li>
</ul>
<h4 id="2-inputs-and-outputs-12"><a class="header" href="#2-inputs-and-outputs-12">2. inputs and outputs</a></h4>
<ul>
<li>Inputs
<ul>
<li>Both functions
<ul>
<li>Satellite position in ECEF frame $x, y, z$</li>
<li>degree and order as $n$ and $m$</li>
</ul>
</li>
<li><code>v_w_nn_update</code>: $V_{n-1,n-1}$ and $W_{n-1,n-1}$</li>
<li><code>v_w_nm_update</code>: $V_{n-1,m}, W_{n-1,m}, V_{n-2,m}$, and $W_{n-2,m}$</li>
</ul>
</li>
<li>Outputs
<ul>
<li><code>v_w_nn_update</code>: $V_{n,n}$ and $W_{n,n}$</li>
<li><code>v_w_nm_update</code>: $V_{n,m}$ and $W_{n,m}$</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-20"><a class="header" href="#3-algorithm-20">3. algorithm</a></h4>
<p>For unnormalized algorithms, see chapter 3.2.4 of <a href="https://www.springer.com/jp/book/9783540672807">Satellite Orbits</a>.</p>
<p>For normalized algorithm, we use following normalizing relation for Legendre polynomials,</p>
<p>\[
\begin{align}
\bar{P}_{n,m} &amp;= \frac{1}{N_{n,m}}P_{n,m}\\
\bar{V}_{n,m} &amp;= \frac{1}{N_{n,m}}V_{n,m}\\
\bar{W}_{n,m} &amp;= \frac{1}{N_{n,m}}W_{n,m}\\
\end{align}
\]</p>
<p>The recursion calculation of V and W can be changed to a normalized version as follows</p>
<p>\[
\begin{align}
N_{m,m}\bar{V}_{m,m} &amp;= (2m-1)(\frac{xR_{e}}{r^2}N_{m-1,m-1}\bar{V}_{m-1,m-1}-\frac{yR_e}{r^2}N_{m-1,m-1}\bar{W}_{m-1,m-1})\\
\bar{V}_{m,m} &amp;= \frac{N_{m-1,m-1}}{N_{m,m}}(2m-1)(\frac{xR_{e}}{r^2}\bar{V}_{m-1,m-1}-\frac{yR_e}{r^2}\bar{W}_{m-1,m-1})\\
\bar{W}_{m,m} &amp;= \frac{N_{m-1,m-1}}{N_{m,m}}(2m-1)(\frac{xR_{e}}{r^2}\bar{W}_{m-1,m-1}+\frac{yR_e}{r^2}\bar{V}_{m-1,m-1})\\
\end{align}
\]</p>
<p>\[
\begin{align}
N_{n,m}\bar{V}_{n,m} &amp;= \frac{2n-1}{n-m}(\frac{zR_{e}}{r^2}N_{n-1,m}\bar{V}_{n-1,m}-\frac{n+m-1}{n-m}\frac{R_e^2}{r^2}N_{n-2,m}\bar{V}_{n-2,m})\\
\bar{V}_{n,m} &amp;= \frac{2n-1}{n-m}\frac{zR_{e}}{r^2}\frac{N_{n-1,m}}{N_{n,m}}\bar{V}_{n-1,m}-\frac{n+m-1}{n-m}\frac{R_e^2}{r^2}\frac{N_{n-2,m}}{N_{n,m}}\bar{V}_{n-2,m}\\
\bar{W}_{n,m} &amp;= \frac{2n-1}{n-m}\frac{zR_{e}}{r^2}\frac{N_{n-1,m}}{N_{n,m}}\bar{W}_{n-1,m}-\frac{n+m-1}{n-m}\frac{R_e^2}{r^2}\frac{N_{n-2,m}}{N_{n,m}}\bar{W}_{n-2,m}\\
\end{align}
\]</p>
<p>The recurrence relation of normalize function can be expressed as follows</p>
<p>\[
\begin{align}
N_{0,0} &amp;= 1\\
N_{m,m} &amp;= (2m-1)\sqrt{\frac{2m}{2m+1}}N_{m-1,m-1}\quad(m\geq1)\\
N_{n,m} &amp;= \sqrt{\frac{2n-1}{2n+1}}\sqrt{\frac{n+m}{n-m}}N_{n-1,m}\quad(n\geq1,0\leq m \leq n)
\end{align}
\]</p>
<p>So, the divisions of the normalized functions are described as follows
\[
\begin{align}
\frac{N_{0,0}}{N_{1,1}} &amp;= \sqrt{2m+1}=\sqrt{3}\\
\frac{N_{m-1,m-1}}{N_{m,m}} &amp;= \frac{1}{2m-1}\sqrt{\frac{2m+1}{2m}}\quad(m\geq2)\\
\frac{N_{n-1,m}}{N_{n,m}} &amp;= \sqrt{\frac{2n+1}{2n-1}}\sqrt{\frac{n-m}{n+m}}\quad(n\geq1,0\leq m \leq n)\\
\frac{N_{n-2,m}}{N_{n,m}} &amp;= \frac{N_{n-2,m}}{N_{n-1,m}}\frac{N_{n-1,m}}{N_{n,m}}\\
\frac{N_{n-2,m}}{N_{n,m}} &amp;= \sqrt{\frac{2n-1}{2n-3}}\sqrt{\frac{n-m-1}{n+m-1}}\frac{N_{n-1,m}}{N_{n,m}}\quad(n\geq2,0\leq m \leq n)
\end{align}
\]
The recurrence relations for normalized V and W are derived as  follows
\[
\begin{align}
\bar{V}_{0,0} &amp;= \frac{Re}{r}\\
\bar{W}_{0,0} &amp;= 0\\
\bar{V}_{1,1} &amp;= \sqrt{3}(2m-1)(\frac{xR_{e}}{r^2}\bar{V}_{0,0}-\frac{yR_e}{r^2}\bar{W}_{0,0})\\
\end{align}
\]
\[
\begin{align}
\bar{V}_{m,m} &amp;= \sqrt{\frac{2m+1}{2m}}(\frac{xR_{e}}{r^2}\bar{V}_{m-1,m-1}-\frac{yR_e}{r^2}\bar{W}_{m-1,m-1})\quad(m\geq2)\\
\bar{W}_{m,m} &amp;= \sqrt{\frac{2m+1}{2m}}(\frac{xR_{e}}{r^2}\bar{W}_{m-1,m-1}+\frac{yR_e}{r^2}\bar{V}_{m-1,m-1})\quad(m\geq2)\\
\end{align}
\]
\[
\begin{align}
\bar{V}_{n,m} &amp;= \sqrt{\frac{2n+1}{2n-1}}\sqrt{\frac{n-m}{n+m}}(\frac{2n-1}{n-m}\frac{zR_{e}}{r^2}\bar{V}_{n-1,m})\quad(n=1,0\leq m \leq n)\\
\bar{W}_{n,m} &amp;= \sqrt{\frac{2n+1}{2n-1}}\sqrt{\frac{n-m}{n+m}}(\frac{2n-1}{n-m}\frac{zR_{e}}{r^2}\bar{W}_{n-1,m})\quad(n=1,0\leq m \leq n)\\
\end{align}
\]
\[
\begin{align}
\bar{V}_{n,m} &amp;= \sqrt{\frac{2n+1}{2n-1}}\sqrt{\frac{n-m}{n+m}}(\frac{2n-1}{n-m}\frac{zR_{e}}{r^2}\bar{V}_{n-1,m}-\frac{n+m-1}{n-m}\frac{R_e^2}{r^2}\sqrt{\frac{2n-1}{2n-3}}\sqrt{\frac{n-m-1}{n+m-1}}\bar{V}_{n-2,m})\quad(n\geq2,0\leq m \leq n)\\
\bar{W}_{n,m} &amp;= \sqrt{\frac{2n+1}{2n-1}}\sqrt{\frac{n-m}{n+m}}(\frac{2n-1}{n-m}\frac{zR_{e}}{r^2}\bar{W}_{n-1,m}-\frac{n+m-1}{n-m}\frac{R_e^2}{r^2}\sqrt{\frac{2n-1}{2n-3}}\sqrt{\frac{n-m-1}{n+m-1}}\bar{W}_{n-2,m})\quad(n\geq2,0\leq m \leq n)\\
\end{align}
\]</p>
<h3 id="3-calculate-acceleration-calcaccelerationecef"><a class="header" href="#3-calculate-acceleration-calcaccelerationecef">3. Calculate acceleration: <code>CalcAccelerationECEF</code></a></h3>
<h4 id="1-overview-34"><a class="header" href="#1-overview-34">1. overview</a></h4>
<ul>
<li>This function calculates gravity acceleration</li>
</ul>
<h4 id="2-inputs-and-outputs-13"><a class="header" href="#2-inputs-and-outputs-13">2. inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>normalized coefficients
<ul>
<li>$\bar{C}_{n,m}$</li>
<li>$\bar{S}_{n,m}$ </li>
</ul>
</li>
<li>normalized function
<ul>
<li>$\bar{V}_{n,m}$</li>
<li>$\bar{W}_{n,m}$</li>
</ul>
</li>
</ul>
</li>
<li>Output
<ul>
<li>Gravity acceleration in ECEF frame </li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-21"><a class="header" href="#3-algorithm-21">3. algorithm</a></h4>
<p>For unnormalized algorithms, See  chapter 3.2.5 of <a href="https://www.springer.com/jp/book/9783540672807">Satellite Orbits</a>. </p>
<p>When we use the normalized coefficients and normalized functions, the acceleration calculation is described like follows
\[
\begin{align}
\ddot{x}_{n,m} &amp;= -\frac{GM}{Re^{2}}\bar{C}_{n,0}\bar{V}_{n+1,1}\\
&amp;= -\frac{GM}{Re^{2}} C_{n,0}V_{n+1,1} \frac{N_{n,0}}{N_{n+1,1}}\quad(m=0)
\end{align}
\]
The division of normalized function $\frac{N_{n,0}}{N_{n+1,1}}$ should be removed, so we have to multiply following correction factors into the equation. </p>
<p>When $m=0$, following correction factors are useful for x and y acceleration
\[
\begin{align}
\frac{N_{n+1,1}}{N_{n,0}}=\sqrt{\frac{1}{2}}\sqrt{\frac{2n+1}{2n+3}}\sqrt{(n+2)(n+1)}
\end{align}
\]
When $m=1$, following correction factors are useful for x and y acceleration
\[
\begin{align}
\frac{N_{n+1,0}}{N_{n,1}}=\sqrt{2}\sqrt{\frac{2n+1}{2n+3}}\sqrt{\frac{1}{n(n+1)}}\quad(m=1)\\
\end{align}
\]
When $m&gt;1$, following correction factors are useful for x and y acceleration
\[
\begin{align}
\frac{N_{n+1,m+1}}{N_{n,m}} &amp;= \sqrt{\frac{2n+1}{2n+3}}\sqrt{(n+m+1)(n+m+2)}\\
\frac{N_{n+1,m-1}}{N_{n,m}} &amp;= \sqrt{\frac{2n+1}{2n+3}}\sqrt{\frac{1}{(n-m+1)(n-m+2)}}\\
\end{align}
\]
When $m&gt;=0$, following correction factors are useful for z acceleration
\[
\begin{align}
\frac{N_{n+1,m}}{N_{n,m}}=\sqrt{\frac{2n+1}{2n+3}}\sqrt{\frac{n+m+1}{n-m+1}}
\end{align}
\]</p>
<h4 id="4-note-16"><a class="header" href="#4-note-16">4. note</a></h4>
<ul>
<li>To accelerate the calculation, the double <code>for loop</code> of acceleration calculation and the recursion loop need to be integrated in future.</li>
</ul>
<h2 id="3-results-of-verifications-9"><a class="header" href="#3-results-of-verifications-9">3. Results of verifications</a></h2>
<h4 id="1-calculation-accuracy"><a class="header" href="#1-calculation-accuracy">1. Calculation accuracy</a></h4>
<h5 id="1-overview-35"><a class="header" href="#1-overview-35">1. overview</a></h5>
<ul>
<li>The  calculated gravity acceleration is compared with <a href="https://jp.mathworks.com/help/aerotbx/ug/gravitysphericalharmonic.html">Matlab's Gravity Spherical Harmonics</a> calculation.</li>
<li>The satellite position in the ECEF frame calculated by S2E is inputted to the  <code>CalcAccelerationECEF</code> and <code>gravitysphericalharmonic( r, 'EGM96',360, 'Error' );</code> function of Matlab.
<ul>
<li>Both calculations use EGM96.</li>
<li>The degree of Matlab is fixed to 360, the degree of S2E is changed to check the relationship between the degree and the accuracy.</li>
</ul>
</li>
</ul>
<h5 id="2-conditions-for-the-verification-3"><a class="header" href="#2-conditions-for-the-verification-3">2. conditions for the verification</a></h5>
<ul>
<li>
<p>input files</p>
<ul>
<li>Default initialize files</li>
</ul>
</li>
<li>
<p>initial values</p>
<ul>
<li>
<p>Default initialize files</p>
<pre><code>simulation_start_time_utc = 2020/01/01 11:00:00.0
simulation_duration_s = 200
simulation_step_s = 0.1
orbit_update_period_s = 0.1
log_output_period_s = 5
simulation_speed_setting = 0
</code></pre>
</li>
<li>
<p>Especially, we chose following TLE for orbit calculation</p>
<pre><code>tle1=1 38666U 12003B   12237.00000000 +.00000100  00000-0  67980-4 0 00008
tle2=2 38666 098.6030 315.4100 0000010 300.0000 180.0000 14.09465034  0011
</code></pre>
</li>
<li>
<p>Inputted satellite position in ECEF frame</p>
<img src="Specifications/Disturbance/./figs/PositionInECEF.jpg" alt="PositionInECEF" style="zoom: 90%;" />
</li>
</ul>
</li>
</ul>
<ol start="3">
<li>results</li>
</ol>
<ul>
<li>Calculated gravity acceleration by <code>gravitysphericalharmonic(r,'EGM96',360,'Error' )</code></li>
</ul>
<img src="Specifications/Disturbance/./figs/AccelerationECEF_Matlab.jpg" alt="AccelerationECEF_Matlab" style="zoom: 90%;" />
<ul>
<li>Difference between <code>CalcAccelerationECEF</code> output when <code>degree=0=1</code> and Matlab's output (<code>degree = 360</code>) 
<ul>
<li>You can see significant error since <code>CalcAccelerationECEF</code> does not care about high-order gravity potential.</li>
</ul>
</li>
</ul>
<img src="Specifications/Disturbance/./figs/AccelerationDiffECEF_S2E_deg0.jpg" alt="AccelerationDiffECEF_S2E_deg0" style="zoom: 90%;" />
<ul>
<li>Difference between <code>CalcAccelerationECEF</code> output when <code>degree=360 and Matlab's output (</code>degree = 360`) 
<ul>
<li>The error is relatively small</li>
</ul>
</li>
</ul>
<img src="Specifications/Disturbance/./figs/AccelerationDiffECEF_S2E_deg360.jpg" alt="AccelerationDiffECEF_S2E_deg360" style="zoom: 90%;" />
<ul>
<li>Finally, the relationship between degree and accuracy is summarized.
<ul>
<li>The error is limited to 1e-8 [m/s2]. The cause of the error should be considered when users need accurate orbit propagation.</li>
</ul>
</li>
</ul>
<img src="Specifications/Disturbance/./figs/SummaryAccuracy.jpg" alt="SummaryAccuracy" style="zoom: 90%;" />
<ol start="4">
<li>Note
<ul>
<li>To check the accuracy of the calculation, the resolution of <code>log output</code> should be larger than 10.
<ul>
<li>In this case, the author chose the resolution as 15.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="2-calculation-speed"><a class="header" href="#2-calculation-speed">2. Calculation speed</a></h4>
<h5 id="1-overview-36"><a class="header" href="#1-overview-36">1. overview</a></h5>
<ul>
<li>The author has checked the relationship between the degree and the calculation speed.</li>
<li><code>chrono</code> class was used as follows</li>
</ul>
<pre><code class="language-c++">  chrono::system_clock::time_point start, end;
  start = chrono::system_clock::now();

  debug_pos_ecef_m_ = spacecraft.dynamics_-&gt;orbit_-&gt;GetPosition_ecef_m();
  CalcAccelerationEcef(dynamics.GetOrbit().GetPosition_ecef_m());

  end = chrono::system_clock::now();
  time_ms_ = static_cast&lt;double&gt;(chrono::duration_cast&lt;chrono::microseconds&gt;(end - start).count() / 1000.0);
</code></pre>
<ul>
<li>The <code>time_ms_</code> is logged every log output step, and 400 data of the calculation time is saved. The averaged value of the 400 data is evaluated here.</li>
<li>Environment
<ul>
<li>Core i7-8650U(2.11GHz)</li>
<li>VS2017 32bit debug</li>
</ul>
</li>
</ul>
<h5 id="2-conditions-for-the-verification-4"><a class="header" href="#2-conditions-for-the-verification-4">2. conditions for the verification</a></h5>
<ul>
<li>input files
<ul>
<li>Same with accuracy verification</li>
</ul>
</li>
<li>initial values
<ul>
<li>Same with accuracy verification</li>
</ul>
</li>
</ul>
<h5 id="3-results-1"><a class="header" href="#3-results-1">3. results</a></h5>
<ul>
<li>When <code>degree=0=1</code>, the calculation time is just <code>0.018 msec</code>.</li>
<li>When <code>degree=2 and 10</code>, the calculation time is <code>0.035 msec and 0.2 msec</code>, respectively.</li>
<li>When <code>degree=360</code>, the calculation time reaches  <code>110 msec</code>, but it is faster than the calculation time of  <code>gravitysphericalharmonic( r, 'EGM96',360, 'Error' )</code>, which is <code>700 ms</code>.</li>
</ul>
<img src="Specifications/Disturbance/./figs/SummaryCalculationTime.jpg" alt="SummaryCalculationTime" style="zoom: 90%;" />
<ol start="4">
<li>Note</li>
</ol>
<ul>
<li></li>
</ul>
<h2 id="4-references-7"><a class="header" href="#4-references-7">4. References</a></h2>
<ol>
<li>Oliver Montenbruck, and Eberhard Gill, &quot;<a href="https://www.springer.com/jp/book/9783540672807">Satellite Orbits</a>&quot;, Springer</li>
<li><a href="https://cddis.nasa.gov/926/egm96/getit.html">NASA's EMG96 website</a></li>
<li><a href="https://jp.mathworks.com/help/aerotbx/ug/gravitysphericalharmonic.html">Matlab Gravity Spherical Harmonics</a></li>
<li><a href="https://ai-solutions.com/_help_Files/gravity_model_files.htm">Summary of gravity models</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gravity-gradient-torque"><a class="header" href="#gravity-gradient-torque">Gravity Gradient Torque</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="magnetic-disturbance-torque"><a class="header" href="#magnetic-disturbance-torque">Magnetic Disturbance Torque</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="surface-force"><a class="header" href="#surface-force">Surface Force</a></h1>
<h2 id="1--overview-24"><a class="header" href="#1--overview-24">1.  Overview</a></h2>
<h3 id="1-functions-9"><a class="header" href="#1-functions-9">1. Functions</a></h3>
<ul>
<li>S2E handles air drag and Solar Radiation Pressure(SRP) as surface force disturbances since both disturbances affect spacecraft surfaces. The structure of both equations is identical, but they have different coefficients. </li>
<li>Thus, the <code>SurfaceForce</code> base class provides the structure of the equation, and <code>AirDrag</code> and <code>SolarRadiationPressureDisturbance</code> subclasses provide specific calculations with appropriate coefficients.</li>
<li>Currently, the <code>SurfaceForce</code> class supports multi-surface spacecraft without a self-shadowing effect. Users can select the number of surfaces.</li>
<li>For the detailed description of <code>AirDrag</code> and <code>SolarRadiationPressureDisturbance</code>, please refer <a href="Specifications/Disturbance/./Spec_SurfaceForce_AirDrag.html">Air Drag</a> and <a href="Specifications/Disturbance/./Spec_SurfaceForce_SolarRadiation.html">Solar Radiation Pressure</a>.</li>
</ul>
<h3 id="2-related-files-6"><a class="header" href="#2-related-files-6">2. Related files</a></h3>
<ul>
<li><code>surface_force.cpp</code>, <code>surface_force.hpp</code> : The base class <code>SurfaceForce</code> is defined.</li>
</ul>
<h3 id="3-how-to-use-10"><a class="header" href="#3-how-to-use-10">3. How to use</a></h3>
<ul>
<li>Make a subclass that inherits the <code>SurfaceForce</code> class.</li>
<li>Define the <code>CalcCoefficients</code> function in the subclass.</li>
<li>Execute <code>CalcTorqueForce</code> in the update function of the subclass.</li>
</ul>
<h2 id="2-explanation-of-algorithm-10"><a class="header" href="#2-explanation-of-algorithm-10">2. Explanation of Algorithm</a></h2>
<h3 id="1-constructor-2"><a class="header" href="#1-constructor-2">1. Constructor</a></h3>
<h4 id="1-overview-37"><a class="header" href="#1-overview-37">1. overview</a></h4>
<ul>
<li>Initialize structure parameters</li>
</ul>
<h4 id="2-inputs-and-outputs-14"><a class="header" href="#2-inputs-and-outputs-14">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li>List of <code>Surface</code> class which manages surface area, position, and normal direction.</li>
<li>Position vector of the center of gravity in the body fixed frame [m].</li>
</ul>
</li>
<li>output
<ul>
<li>The instance of the class</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-na"><a class="header" href="#3-algorithm-na">3. algorithm: NA</a></h4>
<h4 id="4-note-17"><a class="header" href="#4-note-17">4. note</a></h4>
<ul>
<li>The origin of all vectors defined here is the body-fixed frame. Users can define the origin of the body-fixed frame by themselves. If users want to define the origin as the center of gravity, they need to set <code>center_of_gravity_b_m = zero vector</code> in the <code>Structure.ini</code>. If users want to define the origin as a specific point, they need to carefully set all vectors to suit their definition.</li>
</ul>
<h3 id="2-calctorqueforce-function"><a class="header" href="#2-calctorqueforce-function">2. <code>CalcTorqueForce</code> function</a></h3>
<h4 id="1-overview-38"><a class="header" href="#1-overview-38">1. overview</a></h4>
<ul>
<li>This is the main function to calculate the force and torque generated by the surface force disturbances.</li>
</ul>
<h4 id="2-inputs-and-outputs-15"><a class="header" href="#2-inputs-and-outputs-15">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li><code>input_direction_b</code>: direction of disturbance source at the body frame</li>
<li><code>item</code>: parameter which decides the magnitude of the disturbances (Solar flux, air density)</li>
<li>Surface information defined in the constructor</li>
</ul>
</li>
<li>output
<ul>
<li><code>force_b_N_</code>: Force at the body frame (unit: N)</li>
<li><code>torque_b_Nm_</code> : Torque at the body frame (unit: Nm)</li>
<li>Both variables are defined in the <code>SimpleDisturbance</code> base class</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-22"><a class="header" href="#3-algorithm-22">3. algorithm</a></h4>
<ul>
<li>Let us consider the following coordinate on a surface for surface force calculation
<ul>
<li>$\boldsymbol{n}$ is the normal vector of the surface</li>
<li>$\boldsymbol{v}$ is the direction vector of the disturbance source (e.g., sun direction vector or velocity vector)</li>
</ul>
</li>
</ul>
<img src="Specifications/Disturbance/./figs/SurfaceForce_overview.JPG" alt="SummaryCalculationTime" style="zoom: 70%;" />
<ul>
<li>$\boldsymbol{t}$ is the direction of in-plane force. </li>
</ul>
<p>\[
\boldsymbol{t}=\frac{\boldsymbol{v}\times\boldsymbol{n}}{|\boldsymbol{v}\times\boldsymbol{n}|}\times\boldsymbol{n}
\]</p>
<ul>
<li>Surface force and torque acting on the surface is expressed as following equation
<ul>
<li>$\boldsymbol{r}_{s}$ is the position vector of the surface</li>
<li>$\boldsymbol{r}_{cg}$ is the position vector of the center of mass</li>
</ul>
</li>
</ul>
<p>\[
\begin{align}
\boldsymbol{F} &amp;= -C_{n}\boldsymbol{n}+C_{t}\boldsymbol{t}\\
\boldsymbol{T} &amp;= (\boldsymbol{r}_{s}-\boldsymbol{r}_{cg})\times\boldsymbol{F}
\end{align}
\]</p>
<ul>
<li>Detail of the $C_{n}$ and $C_{t}$ are defined by subclasses by using <code>CalcCoefficients</code> function</li>
</ul>
<h4 id="4-note-18"><a class="header" href="#4-note-18">4. note</a></h4>
<ul>
<li>NA</li>
</ul>
<h2 id="3-results-of-verifications-10"><a class="header" href="#3-results-of-verifications-10">3. Results of verifications</a></h2>
<ul>
<li>Verifications will be done by the subclasses.</li>
</ul>
<h2 id="4-references-8"><a class="header" href="#4-references-8">4. References</a></h2>
<ol>
<li>NA</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="surface-force-air-drag"><a class="header" href="#surface-force-air-drag">Surface Force: Air Drag</a></h1>
<h2 id="1--overview-25"><a class="header" href="#1--overview-25">1.  Overview</a></h2>
<h3 id="1-functions-10"><a class="header" href="#1-functions-10">1. Functions</a></h3>
<ul>
<li><code>AirDrag</code> class inherits <code>SurfaceForce</code> base class and calculates air drag disturbance force and torque. </li>
</ul>
<h3 id="2-related-files-7"><a class="header" href="#2-related-files-7">2. Related files</a></h3>
<ul>
<li><code>air_drag.cpp</code>, <code>air_drag.hpp</code> : The <code>AirDrag</code> class is defined.</li>
<li><code>surface_force.cpp</code>, <code>surface_force.hpp</code> : The base class <code>SurfaceForce</code> is defined.
<ul>
<li><strong>Note</strong>: <code>SurfaceForce</code> class inherits <code>SimpleDisturbance</code> class, and <code>SimpleDisturbance</code> class inherits <code>Disturbance</code> class. So, please refer them if users want to understand the structure deeply.</li>
</ul>
</li>
<li><code>disturbance.ini</code> : Initialization file</li>
</ul>
<h3 id="3-how-to-use-11"><a class="header" href="#3-how-to-use-11">3. How to use</a></h3>
<ul>
<li>Make an instance of the <code>AirDrag</code> class in <code>InitializeInstances</code> function in <code>disturbances.cpp</code>
<ul>
<li>Create an instance by using the initialization function <code>InitAirDrag</code></li>
</ul>
</li>
<li>Set the parameters in the <code>disturbance.ini</code>
<ul>
<li>Select <code>ENABLE</code> for <code>calculation</code> and <code>logging</code></li>
<li>Select the following conditions of air drag calculation
<ul>
<li>Surface Temperature degC</li>
<li>Atmosphere Temperature degC</li>
<li>Molecular weight of the thermosphere g/mol</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-11"><a class="header" href="#2-explanation-of-algorithm-11">2. Explanation of Algorithm</a></h2>
<h3 id="1-calccoefficients"><a class="header" href="#1-calccoefficients">1. <code>CalcCoefficients</code></a></h3>
<h4 id="1-overview-39"><a class="header" href="#1-overview-39">1. overview</a></h4>
<ul>
<li><code>CalcCoefficients</code> calculates the normal and in-plane coefficients for <code>SurfaceForce</code> calculation. The air drag force acting on a surface is expressed as the following equation</li>
</ul>
<p>\[
\begin{align}
\boldsymbol{F}=-C_{n}\boldsymbol{n}+C_{t}\boldsymbol{t}\\
C_{n}=\frac{1}{2}\rho A v^2 C_{n}^{\prime}\\
C_{t}=\frac{1}{2}\rho A v^2 C_{t}^{\prime}
\end{align}
\]</p>
<ul>
<li>This  function mainly calculates the common part of the coefficient calculation. $C_{n}^{\prime}$ and $C_{t}^{\prime}$ are calculated in <code>CalCnCt</code> function, and they will be used in this function.</li>
</ul>
<h4 id="2-inputs-and-outputs-16"><a class="header" href="#2-inputs-and-outputs-16">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li>$\boldsymbol{v}$: Relative velocity vector between the spacecraft and the atmosphere [m/s]</li>
<li>$\rho$: air density [kg/m3]</li>
</ul>
</li>
<li>output
<ul>
<li>coefficients $C_{n}$ and $C_{t}$</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-23"><a class="header" href="#3-algorithm-23">3. algorithm</a></h4>
<ul>
<li>See above equations.</li>
</ul>
<h4 id="4-note-na-2"><a class="header" href="#4-note-na-2">4. note: NA</a></h4>
<h3 id="2-calcnct"><a class="header" href="#2-calcnct">2. <code>CalCnCt</code></a></h3>
<h4 id="1-overview-40"><a class="header" href="#1-overview-40">1. overview</a></h4>
<ul>
<li><code>CalCnCt</code> calculates  $C_{n}^{\prime}$ and $C_{t}^{\prime}$.</li>
</ul>
<h4 id="2-inputs-and-outputs-17"><a class="header" href="#2-inputs-and-outputs-17">2. inputs and outputs</a></h4>
<ul>
<li>input variables
<ul>
<li>$\boldsymbol{v}$: Relative velocity vector between the spacecraft and the atmosphere [m/s]
<ul>
<li>Currently, we assume that this value equals spacecraft velocity in the body-fixed frame.</li>
</ul>
</li>
</ul>
</li>
<li>input parameters 
<ul>
<li>$\sigma_{d}$: Diffuse coefficients for air drag
<ul>
<li>Ini file provide specularity for air drag $\sigma_{s}$, and the diffuse coefficient is derived as $\sigma_{d}=1-\sigma_{s}$.</li>
<li><strong>Note</strong>: There is no absorption term for air drag. Thus total reflectivity is set as 1.</li>
</ul>
</li>
<li>$T_{w}$: Temperature of the surface [K]</li>
<li>$T_{m}$: Temperature of the atmosphere [K]</li>
<li>$M$: Molecular weight of the thermosphere [g/mol]
<ul>
<li>In the default ini file, we use $M=18$, and it is a little bit smaller than the molecular weight of atmosphere $M=29$.  <a href="https://www.sciencedirect.com/science/article/pii/0032063361900368?via%3Dihub">Structure of the Thermosphere</a> provides information on the molecular weight of the thermosphere. </li>
</ul>
</li>
</ul>
</li>
<li>outputs
<ul>
<li>$C_{n}^{\prime}$ and $C_{t}^{\prime}$ </li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-24"><a class="header" href="#3-algorithm-24">3. algorithm</a></h4>
<ul>
<li>$C_{n}^{\prime}$ and $C_{t}^{\prime}$  are calculated as following equations</li>
</ul>
<p>\[
\begin{align}
C_{n}^{\prime} &amp;= \frac{2-\sigma_{d}}{\sqrt{\pi}}\frac{\Pi(S_{n})}{S^{2}}+\frac{\sigma_{d}}{2}\frac{\chi(S_{n})}{S^{2}}\sqrt{\frac{T_{w}}{T_{m}}}\\
C_{t}^{\prime} &amp;=\frac{\sigma_{d}}{\sqrt{\pi}}\frac{\chi(S_{n})}{S^{2}}S_{t}
\end{align}
\]</p>
<ul>
<li>$S, S_{n}, S_{t}$ are defined as follows
<ul>
<li>$k=1.38064852E-23$ is the Boltzmann constant</li>
<li>$\theta$ is the angle between the normal vector and the velocity vector</li>
<li>$\cos{\theta}$ and $\sin{\theta}$ are calculated in <code>SurfaceForce</code> base class.</li>
</ul>
</li>
</ul>
<p>\[
\begin{align}
S &amp;= \sqrt{\frac{Mv^{2}}{2kT_{w}}}\\
S_{n} &amp;= S\cos{\theta}\\
S_{t} &amp;= S\sin{\theta}\\
\end{align}
\]</p>
<ul>
<li>$\Pi(x)$ and $\chi(x)$ are defined as follows
<ul>
<li>where <code>erf</code> is the <a href="https://en.wikipedia.org/wiki/Error_function">Gauss error function</a>.</li>
<li>These functions are defined as <code>CalcFunctionPi</code> and <code>CalcFunctionChi</code>.</li>
</ul>
</li>
</ul>
<p>\[
\begin{align}
\Pi(x) &amp;= x e^{-x^{2}}+\sqrt{\pi}(x^2+0.5)(1+erf(x))\\
\chi(x) &amp;= e^{-x^{2}}+\sqrt{\pi}x(1+erf(x))
\end{align}
\]</p>
<h4 id="4-note-19"><a class="header" href="#4-note-19">4. note</a></h4>
<ul>
<li>Please see the reference document for more information on detailed calculations.</li>
</ul>
<h2 id="3-results-of-verifications-11"><a class="header" href="#3-results-of-verifications-11">3. Results of verifications</a></h2>
<h3 id="1-verification-of-magnitude-of-the-force"><a class="header" href="#1-verification-of-magnitude-of-the-force">1. Verification of magnitude of the force</a></h3>
<h4 id="1-overview-41"><a class="header" href="#1-overview-41">1. overview</a></h4>
<ul>
<li>The calculated magnitude of the air drag force is compared with other calculation results in three cases.</li>
</ul>
<h4 id="2-conditions-for-the-verification-5"><a class="header" href="#2-conditions-for-the-verification-5">2. conditions for the verification</a></h4>
<ul>
<li>See the bottom table.</li>
</ul>
<h4 id="3-results-2"><a class="header" href="#3-results-2">3. results</a></h4>
<ul>
<li>
<p>The calculation result is completely the same as the other calculation.</p>
<div class="table-wrapper"><table><thead><tr><th>parameters/results</th><th>Case 1</th><th>Case 2</th><th>Case 3</th></tr></thead><tbody>
<tr><td>$\sigma_{d}$</td><td>0.8</td><td>0.6</td><td>0.4</td></tr>
<tr><td>$\theta$ rad</td><td>0.202</td><td>0.202</td><td>0.202</td></tr>
<tr><td>$v$ m/s</td><td>7420</td><td>7420</td><td>7420</td></tr>
<tr><td>Out-plane force (S2E)</td><td>2.30297</td><td>2.68680</td><td>3.07062</td></tr>
<tr><td>Out-plane force (reference)</td><td>2.30297</td><td>2.68680</td><td>3.07062</td></tr>
<tr><td>Out-plane force (S2E)</td><td>0.31514</td><td>0.23636</td><td>0.15757</td></tr>
<tr><td>Out-plane force (reference)</td><td>0.31514</td><td>0.23636</td><td>0.15757</td></tr>
</tbody></table>
</div></li>
</ul>
<h3 id="1-verification-of-direction-of-the-force"><a class="header" href="#1-verification-of-direction-of-the-force">1. Verification of direction of the force</a></h3>
<h4 id="1-overview-42"><a class="header" href="#1-overview-42">1. overview</a></h4>
<ul>
<li>Next, we confirmed that the direction of the calculated force is correct.</li>
</ul>
<h4 id="2-conditions-for-the-verification-6"><a class="header" href="#2-conditions-for-the-verification-6">2. conditions for the verification</a></h4>
<ul>
<li>S2E is executed using the default setting.</li>
</ul>
<h4 id="3-results-3"><a class="header" href="#3-results-3">3. results</a></h4>
<ul>
<li>We confirmed that the direction of the force is opposite the direction of the velocity of the spacecraft.</li>
</ul>
<img src="Specifications/Disturbance/./figs/AirDrag_result_1.jpg" alt="SummaryCalculationTime" style="zoom: 70%;" />
<h2 id="4-references-9"><a class="header" href="#4-references-9">4. References</a></h2>
<ol>
<li>H. Klinkrad and B. Fritsche, &quot;<a href="https://pdfs.semanticscholar.org/a16c/1abab4c081b4434bda9190f4f7be789c246a.pdf">ORBIT AND ATTITUDE PERTURBATIONS DUE TO AERODYNAMICS AND RADIATION PRESSURE</a>&quot;, in <em>ESA Workshop on Space Weather</em>, 1998. </li>
<li>Marcel Nicolet, <a href="https://www.sciencedirect.com/science/article/pii/0032063361900368?via%3Dihub">Structure of the Thermosphere</a>, Planetary and Space Science, 1961</li>
<li><a href="https://en.wikipedia.org/wiki/Error_function">Gauss error function</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="surface-force-solar-radiation-pressure-disturbance"><a class="header" href="#surface-force-solar-radiation-pressure-disturbance">Surface Force: Solar Radiation Pressure disturbance</a></h1>
<h2 id="1--overview-26"><a class="header" href="#1--overview-26">1.  Overview</a></h2>
<h3 id="1-functions-11"><a class="header" href="#1-functions-11">1. Functions</a></h3>
<ul>
<li><code>SolarRadiationPressureDisturbance</code> class inherits <code>SurfaceForce</code> base class and calculates air drag disturbance force and torque. </li>
</ul>
<h3 id="2-related-files-8"><a class="header" href="#2-related-files-8">2. Related files</a></h3>
<ul>
<li><code>solar_radiation_pressure_disturbance.cpp</code>, <code>solar_radiation_pressure_disturbance.hpp</code> : The <code>SolarRadiationPressureDisturbance</code> class is defined.</li>
<li><code>surface_force.cpp</code>, <code>surface_force.hpp</code> : The base class <code>SurfaceForce</code> is defined.
<ul>
<li><strong>Note</strong>: <code>SurfaceForce</code> class inherits <code>SimpleDisturbance</code> class, and <code>SimpleDisturbance</code> class inherits <code>Disturbance</code> class. So, please refer them if users want to understand the structure deeply.</li>
</ul>
</li>
<li><code>disturbance.ini</code> : Initialization file</li>
</ul>
<h3 id="3-how-to-use-12"><a class="header" href="#3-how-to-use-12">3. How to use</a></h3>
<ul>
<li>Make an instance of the <code>SolarRadiationPressureDisturbance</code> class in <code>InitializeInstances</code> function in <code>disturbances.cpp</code>
<ul>
<li>Create an instance by using the initialization function <code>InitSolarRadiationPressureDisturbance</code></li>
</ul>
</li>
<li>Set the parameters in the <code>disturbance.ini</code>
<ul>
<li>Select <code>ENABLE</code> for <code>calculation</code> and <code>logging</code></li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-12"><a class="header" href="#2-explanation-of-algorithm-12">2. Explanation of Algorithm</a></h2>
<h3 id="1-calccoefficients-function"><a class="header" href="#1-calccoefficients-function">1. <code>CalcCoefficients</code> function</a></h3>
<h4 id="1-overview-43"><a class="header" href="#1-overview-43">1. overview</a></h4>
<ul>
<li><code>CalcCoefficients</code> calculates the normal and in-plane coefficients for <code>SurfaceForce</code> calculation.</li>
</ul>
<h4 id="2-inputs-and-outputs-18"><a class="header" href="#2-inputs-and-outputs-18">2. inputs and outputs</a></h4>
<ul>
<li>inputs
<ul>
<li>$v_{s}$:Direction vector of the sun (spacecraft to the sun) at the body frame</li>
<li>$P$ Solar pressure at the position of the spacecraft [N/m^2]</li>
</ul>
</li>
<li>setting parameters
<ul>
<li>$\nu$ : Total reflectance
<ul>
<li>$\nu = 1-\alpha$, where $\alpha$ is the absorption of the sun spectrum.</li>
</ul>
</li>
<li>$\mu$ : Specularity. Ratio of specular reflection inside the total reflected light.</li>
<li>$A$ : Area of the surface</li>
</ul>
</li>
<li>outputs
<ul>
<li>$C_{n}$ and $C_{t}$</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-25"><a class="header" href="#3-algorithm-25">3. algorithm</a></h4>
<ul>
<li>$C_{n}$ and $C_{t}$ are calculated as follows:
<ul>
<li>$\theta$ is the angle between the normal vector and the sun vector.</li>
</ul>
</li>
</ul>
<p>\[
\begin{align}
C_{n} &amp;= AP \left((1+\nu\mu)\cos^{2}{\theta}+\frac{2}{3}\nu(1-\mu)\cos{\theta} \right)\\
C_{t} &amp;= AP(1-\nu\mu)\cos{\theta}\sin{\theta}
\end{align}
\]</p>
<h4 id="4-note-20"><a class="header" href="#4-note-20">4. note</a></h4>
<ul>
<li>NA</li>
</ul>
<h2 id="3-results-of-verifications-12"><a class="header" href="#3-results-of-verifications-12">3. Results of verifications</a></h2>
<h3 id="1-verification-of-perfect-reflection-case"><a class="header" href="#1-verification-of-perfect-reflection-case">1. Verification of perfect reflection case</a></h3>
<h4 id="1-overview-44"><a class="header" href="#1-overview-44">1. overview</a></h4>
<ul>
<li>In the perfect reflection case, the direction of the SRP force will be opposite from the direction of the sun.</li>
</ul>
<h4 id="2-conditions-for-the-verification-7"><a class="header" href="#2-conditions-for-the-verification-7">2. conditions for the verification</a></h4>
<ul>
<li>We assumed that the structure of the spacecraft is a 50-cm cube whose optical property is the perfect specular reflection($\nu=\mu=1$).</li>
</ul>
<h4 id="3-results-4"><a class="header" href="#3-results-4">3. results</a></h4>
<ul>
<li>We confirmed that the direction of the SRP force is opposite from the direction of the sun at the body frame.</li>
</ul>
<img src="Specifications/Disturbance/./figs/SRP_result_1.jpg" alt="SummaryCalculationTime" style="zoom: 70%;" />
<h2 id="4-references-10"><a class="header" href="#4-references-10">4. References</a></h2>
<ol>
<li>NA</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-of-third-body-gravity-disturbance-calculation"><a class="header" href="#specification-of-third-body-gravity-disturbance-calculation">Specification of Third Body Gravity Disturbance Calculation</a></h1>
<h2 id="1--overview-27"><a class="header" href="#1--overview-27">1.  Overview</a></h2>
<h3 id="1-functions-12"><a class="header" href="#1-functions-12">1. Functions</a></h3>
<ul>
<li>The <code>ThirdBodyGravity</code> class calculates the gravity acceleration generated by the third body, such as Sun, Moon, or planets.</li>
</ul>
<h3 id="2-related-files-9"><a class="header" href="#2-related-files-9">2. Related files</a></h3>
<ul>
<li><code>src/disturbance/third_body_gravity.cpp</code></li>
<li><code>src/disturbance/third_body_gravity.hpp</code></li>
</ul>
<h3 id="3-how-to-use-13"><a class="header" href="#3-how-to-use-13">3. How to use</a></h3>
<ul>
<li>Make an instance of the <code>ThirdBodyGravity</code> class in <code>InitializeInstances</code> function in <code>disturbances.cpp</code>
<ul>
<li>Create an instance by using the initialization function <code>InitThirdBodyGravity</code></li>
</ul>
</li>
<li>Chose a orbit propagator mode that considers disturbances.</li>
<li>Edit the <code>disturbance.ini</code> file
<ul>
<li>Select <code>ENABLE</code> for <code>calculation</code> and <code>logging</code></li>
<li>Select <code>number_of_third_body</code> and <code>third_body_name</code> you need.</li>
<li><strong>NOTE</strong>: All of the <code>third_body_name</code> objects must be included in the <code>selected_body_name</code> of the <code>[CELESTIAL_INFORMATION]</code> section in the <code>simulation_base.ini</code>.</li>
</ul>
</li>
<li><strong>NOTE</strong>: When the class <code>ThirdBodyGravity</code> is instantiated, the class reports an error in the following cases.
<ol>
<li>The target specified by <code>center_object</code> of the <code>[CELESTIAL_INFORMATION]</code> section in the <code>simulation_base.ini</code>. is included in the list of <code>third_body</code>.</li>
<li>The list of <code>third_body_name</code> includes objects which are not in the list of <code>selected_body_name</code> in the <code>[CELESTIAL_INFORMATION]</code> section in the <code>simulation_base.ini</code>.</li>
</ol>
</li>
<li><strong>NOTE</strong>: If the same body is specified more than once in the list of <code>third_body_name</code> in <code>disturbance.ini</code>, the second and subsequent entries of the body are ignored.</li>
</ul>
<h2 id="2explanation-of-algorithm"><a class="header" href="#2explanation-of-algorithm">2.Explanation of Algorithm</a></h2>
<ul>
<li>The base algorithm is referred to <a href="https://www.springer.com/jp/book/9783540672807">Satellite Orbits</a> chapter 3.3. </li>
</ul>
<h3 id="1--calcacceleration_i_m_s2-function"><a class="header" href="#1--calcacceleration_i_m_s2-function">1. <code> CalcAcceleration_i_m_s2</code> function</a></h3>
<h4 id="1-overview-45"><a class="header" href="#1-overview-45">1. overview</a></h4>
<ul>
<li>This function calculates the acceleration in the inertial frame generated by the third body.</li>
</ul>
<h4 id="2-inputs-and-outputs-19"><a class="header" href="#2-inputs-and-outputs-19">2. inputs and outputs</a></h4>
<ul>
<li>
<p>Input</p>
<ul>
<li>position of the third body seen from the <strong>center object</strong> in the inertial coordinate system</li>
<li>position of the third body seen from the <strong>spacecraft</strong> in the inertial coordinate system </li>
<li>gravity constant (GM) of the third body</li>
<li>NOTE: These inputs are derived from <code>CelestialInformation</code>. </li>
</ul>
</li>
<li>
<p>Output</p>
<ul>
<li>acceleration generated by the third body in the inertial coordinate system</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-26"><a class="header" href="#3-algorithm-26">3. algorithm</a></h4>
<ul>
<li>Definition of the variables
<ul>
<li>$\boldsymbol{r}$: the position of the spacecraft (written as <code>sc_position_i_m</code> in the code)</li>
<li>$\boldsymbol{s}$: the position of the third body (written as <code>third_body_pos_i_m</code> in the code)</li>
<li>$\boldsymbol{s}-\boldsymbol{r}$: the position of the third body seen from the spacecraft (written as <code>third_body_position_from_sc_i_m</code> in the code)</li>
</ul>
</li>
</ul>
<img src="Specifications/Disturbance/./figs/ThirdBodyGravity_general.jpg" alt="ThirdBodyGravity_general" style="zoom: 90%;" />
<ul>
<li>The acceleration disturbance effect by the third body is written as follows:</li>
</ul>
<p>\[
\ddot{\boldsymbol{r}}=GM\left(\frac{\boldsymbol{s}-\boldsymbol{r}}{|\boldsymbol{s}-\boldsymbol{r}|^3}-\frac{\boldsymbol{s}}{|\boldsymbol{s}|^3}\right)
\]</p>
<ul>
<li>See section 3.3.1 of <a href="https://www.springer.com/jp/book/9783540672807">Satellite Orbits</a> for a detailed explanation.</li>
</ul>
<h2 id="3-results-of-verifications-13"><a class="header" href="#3-results-of-verifications-13">3. Results of verifications</a></h2>
<h3 id="1-overview-46"><a class="header" href="#1-overview-46">1. overview</a></h3>
<ul>
<li>The deformation of the orbit caused by the acceleration of the third body gravity is compared between S2E and STK.</li>
</ul>
<h3 id="2-conditions-for-the-verification-8"><a class="header" href="#2-conditions-for-the-verification-8">2. conditions for the verification</a></h3>
<ul>
<li>
<p>input files</p>
<ul>
<li>Default initialize files</li>
</ul>
</li>
<li>
<p>initial values </p>
<pre><code>simulation_start_time_utc = 2020/01/01 11:00:00.0
simulation_duration_s = 86400
simulation_step_s = 10
orbit_update_period_s = 10
log_output_period_s = 5
simulation_speed_setting = 0
</code></pre>
<ul>
<li>
<p>Since the effect of third body gravity increases as one moves away from the central object, it is verified for GEO.</p>
<pre><code>initial_position_i_m(0) = 42241095.67425744
initial_position_i_m(1) = 0
initial_position_i_m(2) = 0

initial_velocity_i_m_s(0) = 0
initial_velocity_i_m_s(1) = 2.978E+4
initial_velocity_i_m_s(1) = 3071.859163190527
</code></pre>
<ul>
<li>
<p>All the disturbance calculations, except for the third-object gravity, are set to DISABLE.</p>
</li>
<li>
<p>The following cases are tested.</p>
<ol>
<li>Only the gravity of the Sun is taken into account</li>
<li>Only the gravity of the Moon is taken into account</li>
<li>Both the gravity of the Sun and the Moon are taken into account</li>
<li>Only the gravity of Mars is taken into account (TBW)</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="3">
<li>results</li>
</ol>
<ul>
<li>Without the third body, S2E and STK show the same result.</li>
</ul>
<img src="Specifications/Disturbance/./figs/ThirdBodyGravity_result1.jpg" alt="ThirdBodyGravity_result1" style="zoom: 90%;" />
<ol>
<li>Only the gravity of the Sun is taken into account</li>
</ol>
<ul>
<li>The deformation of the orbit compared to GEO is shown in the following figure.</li>
</ul>
<img src="Specifications/Disturbance/./figs/ThirdBodyGravity_s2e_stk_sun.jpg" alt="ThirdBodyGravity_s2e_stk_sun" style="zoom: 90%;" />
<ul>
<li>The acceleration disturbance caused by the Sun's gravity is shown in the following figure.</li>
</ul>
<img src="Specifications/Disturbance/./figs/ThirdBodyGravity_acc_sun.jpg" alt="ThirdBodyGravity_acc_sun" style="zoom: 90%;" />
<ol start="2">
<li>Only the gravity of the Moon is taken into account</li>
</ol>
<ul>
<li>The deformation of the orbit compared to GEO is shown in the following figure.</li>
</ul>
<img src="Specifications/Disturbance/./figs/ThirdBodyGravity_s2e_stk_moon.jpg" alt="ThirdBodyGravity_s2e_stk_moon" style="zoom: 90%;" />
<ul>
<li>The acceleration disturbance caused by the Moon's gravity is shown in the following figure.</li>
</ul>
<img src="Specifications/Disturbance/./figs/ThirdBodyGravity_acc_moon.jpg" alt="ThirdBodyGravity_acc_moon" style="zoom: 90%;" />
<ol start="3">
<li>Both the gravity of the Sun and the Moon are taken into account</li>
</ol>
<ul>
<li>The deformation of the orbit compared to GEO is shown in the following figure.</li>
</ul>
<img src="Specifications/Disturbance/./figs/ThirdBodyGravity_s2e_stk_sun_moon.jpg" alt="ThirdBodyGravity_s2e_stk_sun_moon" style="zoom: 90%;" />
<ul>
<li>The gravitational disturbance of both the Sun and the Moon is shown in the following figure.</li>
</ul>
<img src="Specifications/Disturbance/./figs/ThirdBodyGravity_acc_sun_moon.jpg" alt="ThirdBodyGravity_acc_sun" style="zoom: 90%;" />
<ul>
<li>In all of the above cases, the S2E and STK results are consistent.</li>
</ul>
<h2 id="4-references-11"><a class="header" href="#4-references-11">4. References</a></h2>
<ol>
<li><a href="https://www.springer.com/jp/book/9783540672807">Satellite Orbits</a> chapter 3.3. </li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="attitude-dynamics"><a class="header" href="#attitude-dynamics">Attitude Dynamics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="controlled-attitude"><a class="header" href="#controlled-attitude">Controlled Attitude</a></h1>
<h2 id="1--overview-28"><a class="header" href="#1--overview-28">1.  Overview</a></h2>
<h3 id="1-functions-13"><a class="header" href="#1-functions-13">1. Functions</a></h3>
<ul>
<li>The <code>ControlledAttitude</code> class provides a perfectly controlled attitude instead of free motion attitude dynamics by numerical propagation.</li>
<li>Users can set the attitude as sun pointing, earth pointing, and others for any direction in the spacecraft body frame. Of course, users can select an inertial stabilized attitude.</li>
<li>It is useful for power, communication, and orbit analyses with S2E.</li>
</ul>
<h3 id="2-related-files-10"><a class="header" href="#2-related-files-10">2. Related files</a></h3>
<ul>
<li><code>src/dynamics/attitude/attitude.hpp, .cpp</code>
<ul>
<li>Definition of <code>Attitude</code> base class</li>
</ul>
</li>
<li><code>src/dynamics/attitude/controlled_attitude.hpp, .cpp</code>
<ul>
<li><code>ControlledAttitude</code> class is defined here.</li>
</ul>
</li>
<li><code>src/dynamics/attitude/initialize_attitude.hpp, .cpp</code>
<ul>
<li>Make an instance of <code>Attitude</code> class.	</li>
</ul>
</li>
<li><code>sample_satellite.ini</code> : Initialization file</li>
</ul>
<h3 id="3-how-to-use-14"><a class="header" href="#3-how-to-use-14">3. How to use</a></h3>
<ul>
<li>Inside the codes
<ul>
<li><code>ControlledAttitude</code> class inherits the <code>Attitude</code> class, so other functions can access the <code>ControlledAttitude</code> class by using get functions in the <code>Attitude</code> class.</li>
</ul>
</li>
<li>User I/F
<ul>
<li>Firstly, users should set <code>propagate_mode = CONTROLLED</code> at the <code>[ATTITUDE]</code> section in the <code>sample_satellite.ini</code> file.</li>
<li>Users can set a target attitude in the initialize file. There are the following setting parameters: <code>main_mode</code>, <code>sub_mode</code>, <code>initial_quaternion_i2t</code>, <code>pointing_t_b</code>, and <code>pointing_sub_t_b</code>.</li>
<li>Firstly, users select the control mode by using <code>main_mode</code> and <code>sub_mode</code>. For the control mode.</li>
<li>When <code>main_mode</code> is set as <code>INERTIAL_STABILIZE</code>, <code>sub_mode</code> is ignored, and the spacecraft attitude is fixed to the <code>initial_quaternion_i2t</code> value in the simulation.</li>
<li>When <code>main_mode</code> is set as <code>HOGE_POINTING</code> modes, the direction of the body-fixed frame defined by <code>pointing_t_b</code> is controlled to point the specific direction of the modes. 
<ul>
<li>Ex. 1, the body-fixed +X axis directs to the sun when <code>main_mode = SUN_POINTING</code> and <code>pointing_t_b = [1.0,0.0,0.0]</code>.</li>
<li>Ex. 2, the body-fixed -Z axis directs to the earth center when <code>main_mode = EARTH_CENTER_POINTING</code> and <code>pointing_t_b = [0.0,0.0,-1.0]</code>.</li>
</ul>
</li>
<li><code>sub_mode</code> is only used when users select <code>POINTING</code> modes for <code>main_mode</code>. <code>sub_mode</code> is defined to stop rotation around the pointing direction of <code>main_mode</code>. The selected sub-direction in the body-fixed frame cannot perfectly direct the target direction since the primary target and sub-target usually do not satisfy the vertical relationship.</li>
<li><code>sub_mode</code> cannot be <code>INERTIAL_STABILIZE</code> and the same mode with <code>main_mode</code>.</li>
<li>The angle between <code>pointing_t_b</code> and <code>pointing_sub_t_b</code> should be larger than 30 degrees. (90 degrees is recommended)</li>
</ul>
</li>
<li>List of attitude control mode
<ul>
<li>INERTIAL_STABILIZE = 0</li>
<li>SUN_POINTING = 1</li>
<li>EARTH_CENTER_POINTING = 2</li>
<li>VELOCITY_DIRECTION_POINTING = 3</li>
<li>ORBIT_NORMAL_POINTING = 4</li>
<li>orbit normal $n$ is defined as $n=r\times v$, where $r$ is radial direction and $v$ is velocity direction.</li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-13"><a class="header" href="#2-explanation-of-algorithm-13">2. Explanation of Algorithm</a></h2>
<h3 id="1-initialize-function"><a class="header" href="#1-initialize-function">1. Initialize function</a></h3>
<h4 id="1-overview-47"><a class="header" href="#1-overview-47">1. overview</a></h4>
<ul>
<li>This function initializes the target attitude and confirms that the setting parameters are correct. </li>
<li>The parameter checklist
<ul>
<li>Out of range check for both mode definitions.</li>
<li><code>main_mode</code> and <code>sub_mode</code> is not the same</li>
<li>The angle between <code>pointing_t_b</code> and <code>pointing_sub_t_b</code> should be larger than 30 degrees.</li>
</ul>
</li>
</ul>
<h4 id="2-inputs-and-outputs-20"><a class="header" href="#2-inputs-and-outputs-20">2. inputs and outputs</a></h4>
<ul>
<li>NA </li>
</ul>
<h4 id="3-algorithm-27"><a class="header" href="#3-algorithm-27">3. algorithm</a></h4>
<ul>
<li>NA</li>
</ul>
<h4 id="4-note-21"><a class="header" href="#4-note-21">4. note</a></h4>
<ul>
<li>NA</li>
</ul>
<h3 id="2-propagate-function"><a class="header" href="#2-propagate-function">2. Propagate function</a></h3>
<h4 id="1-overview-48"><a class="header" href="#1-overview-48">1. overview</a></h4>
<ul>
<li>This is the main function executed in every loop of attitude dynamics calculation.</li>
</ul>
<h4 id="2-inputs-and-outputs-21"><a class="header" href="#2-inputs-and-outputs-21">2. inputs and outputs</a></h4>
<ul>
<li>inputs 
<ul>
<li>setting parameters</li>
</ul>
</li>
<li>outputs
<ul>
<li>quaternion_i2b</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-28"><a class="header" href="#3-algorithm-28">3. algorithm</a></h4>
<ul>
<li>Detail algorithm is described in the next function.</li>
</ul>
<h4 id="4-note-22"><a class="header" href="#4-note-22">4. note</a></h4>
<ul>
<li>NA</li>
</ul>
<h3 id="3-calctargetdirection"><a class="header" href="#3-calctargetdirection">3. CalcTargetDirection</a></h3>
<h4 id="1-overview-49"><a class="header" href="#1-overview-49">1. overview</a></h4>
<ul>
<li>This function calculates the target direction according to the pointing mode.</li>
</ul>
<h4 id="2-inputs-and-outputs-22"><a class="header" href="#2-inputs-and-outputs-22">2. inputs and outputs</a></h4>
<ul>
<li>inputs 
<ul>
<li>control mode</li>
<li>orbit class</li>
<li>celestial information class</li>
</ul>
</li>
<li>outputs
<ul>
<li>the direction of the target object</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-29"><a class="header" href="#3-algorithm-29">3. algorithm</a></h4>
<ul>
<li>As written in the code.</li>
</ul>
<h4 id="4-note-23"><a class="header" href="#4-note-23">4. note</a></h4>
<ul>
<li>NA</li>
</ul>
<h3 id="3-pointingctrl"><a class="header" href="#3-pointingctrl">3. PointingCtrl</a></h3>
<h4 id="1-overview-50"><a class="header" href="#1-overview-50">1. overview</a></h4>
<ul>
<li>This function calculates the <code>quaternion_i2b</code>.</li>
</ul>
<h4 id="2-inputs-and-outputs-23"><a class="header" href="#2-inputs-and-outputs-23">2. inputs and outputs</a></h4>
<ul>
<li>inputs 
<ul>
<li>the main direction of the target object in ECI frame $t_m^i$</li>
<li>the sub direction of the target object  in ECI frame $t_s^i$</li>
<li>the main controlled direction in the body frame $d_m^b$</li>
<li>the sub controlled direction in the body frame $d_s^b$</li>
</ul>
</li>
<li>outputs
<ul>
<li>quaternion_i2b</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-30"><a class="header" href="#3-algorithm-30">3. algorithm</a></h4>
<ul>
<li>Firstly, the $DCM_{t2i}$, which is the frame transformation from the target frame to the inertial frame, is calculated using $t_m^i$ and $t_s^i$ with <code>CalcDCM</code>.</li>
<li>Next, the $DCM_{t2b}$, which is the frame transformation from the target frame to the body-fixed frame, is calculated using $d_m^b$ and $d_s^b$ with <code>CalcDCM</code>.</li>
<li>Finally, both DCMs are combined as follows. And <code>quaternion_i2b</code> is calculated from the $DCM_{i2b}$.
\[
DCM_{i2b} = DCM_{t2b} \cdot DCM_{t2i}'
\]</li>
</ul>
<h4 id="4-note-24"><a class="header" href="#4-note-24">4. note</a></h4>
<ul>
<li>NA</li>
</ul>
<h3 id="3-calcdcm"><a class="header" href="#3-calcdcm">3. CalcDCM</a></h3>
<h4 id="1-overview-51"><a class="header" href="#1-overview-51">1. overview</a></h4>
<ul>
<li>This function calculates a DCM from two given directions.</li>
<li>The DCM represents the coordinate transform matrix from the new frame defined by the two directions to the original frame.</li>
</ul>
<h4 id="2-inputs-and-outputs-24"><a class="header" href="#2-inputs-and-outputs-24">2. inputs and outputs</a></h4>
<ul>
<li>inputs 
<ul>
<li>the main direction in the frame $a$ : $d_m^a$</li>
<li>the sub direction in the frame $a$ : $d_s^a$</li>
</ul>
</li>
<li>outputs
<ul>
<li>Coordinate transform matrix from the new frame to the original frame $a$</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-31"><a class="header" href="#3-algorithm-31">3. algorithm</a></h4>
<ul>
<li>The first basis vector of the new frame is defined as the main direction.
\[
e_1=d_m^a
\]</li>
<li>The second basis vector needs to be direct to the sub direction, but it should be vertical with $e_1$.
\[
e_2 = \frac{(e_1\times d_s^a) \times e_1}{|(e_1\times d_s^a) \times e_1|}
\]</li>
<li>The third basis vector is defined as right-hand coordinate.
\[
e_3=\frac{e_1\times e_2}{|e_1\times e_2|}
\]</li>
</ul>
<h4 id="4-note-25"><a class="header" href="#4-note-25">4. note</a></h4>
<ul>
<li>NA</li>
</ul>
<h3 id="3-note"><a class="header" href="#3-note">3. note</a></h3>
<ul>
<li>Currently, the <code>ControlledAttitude</code> class does not calculate angular velocity, and it is set as 0. The feature will be implemented in the near future. </li>
</ul>
<h2 id="3-results-of-verifications-14"><a class="header" href="#3-results-of-verifications-14">3. Results of verifications</a></h2>
<h3 id="1-inertial-stabilize"><a class="header" href="#1-inertial-stabilize">1. Inertial stabilize</a></h3>
<h4 id="1-overview-52"><a class="header" href="#1-overview-52">1. overview</a></h4>
<ul>
<li>To verify the correctness of pointing control</li>
</ul>
<h4 id="2-conditions-for-the-verification-9"><a class="header" href="#2-conditions-for-the-verification-9">2. conditions for the verification</a></h4>
<ul>
<li>input files
<ul>
<li>default files</li>
</ul>
</li>
<li>initial values
<ul>
<li>main_mode = sub_mode = INERTIAL_STABILIZE</li>
<li>initial_quaternion_i2b = [0.5,0.5,0.5,0.5]</li>
</ul>
</li>
</ul>
<h4 id="3-results-5"><a class="header" href="#3-results-5">3. results</a></h4>
<ul>
<li>The inertial stabilize control is succeeded.
<img src="Specifications/Dynamics/./figs/CtrlAtt_InertialStabilize.jpg" alt="InertialStabilize" style="zoom: 90%;" /></li>
</ul>
<h3 id="1-pointing-control"><a class="header" href="#1-pointing-control">1. Pointing Control</a></h3>
<h4 id="1-overview-53"><a class="header" href="#1-overview-53">1. overview</a></h4>
<ul>
<li>Several cases described at the bottom were checked to verify the correctness of pointing control.</li>
</ul>
<h4 id="2-conditions-for-the-verification-10"><a class="header" href="#2-conditions-for-the-verification-10">2. conditions for the verification</a></h4>
<ul>
<li>
<p>input files</p>
<ul>
<li>default files</li>
</ul>
</li>
<li>
<p>cases　　</p>
<div class="table-wrapper"><table><thead><tr><th>case</th><th>main mode</th><th>sub mode</th><th>main_pointing_direction_b</th><th>sub_pointing_direction_b</th></tr></thead><tbody>
<tr><td>1</td><td>Sun</td><td>Earth Center</td><td>[1,0,0]</td><td>[0,1,0]</td></tr>
<tr><td>2</td><td>Sun</td><td>Earth Center</td><td>[0,0,-1]</td><td>[-1,0,0]</td></tr>
<tr><td>3</td><td>Earth Center</td><td>Velocity</td><td>[0,-1,0]</td><td>[0,0,1]</td></tr>
<tr><td>4</td><td>Velocity</td><td>Sun</td><td>[0.707,0.707,0]</td><td>[0,0,1]</td></tr>
<tr><td></td><td></td><td></td><td></td><td></td></tr>
</tbody></table>
</div></li>
</ul>
<h4 id="3-results-6"><a class="header" href="#3-results-6">3. results</a></h4>
<ol>
<li>Case 1</li>
</ol>
<ul>
<li>The spacecraft +X axis correctly directs to the sun, and its +Y axis roughly directs to the earth.</li>
</ul>
<img src="Specifications/Dynamics/./figs/CtrlAtt_case1.jpg" alt="Case1" style="zoom: 90%;" />  
<ol>
<li>Case 2</li>
</ol>
<ul>
<li>The spacecraft -Z axis correctly directs to the sun, and its -X axis roughly directs to the earth.</li>
</ul>
<img src="Specifications/Dynamics/./figs/CtrlAtt_case2.jpg" alt="Case2" style="zoom: 90%;" />  
<ol>
<li>Case 3</li>
</ol>
<ul>
<li>The spacecraft -Y axis correctly directs to the earth, and its +Z axis roughly directs to the velocity direction.</li>
</ul>
<img src="Specifications/Dynamics/./figs/CtrlAtt_case3.jpg" alt="Case3" style="zoom: 90%;" />  
<ol>
<li>Case 4</li>
</ol>
<ul>
<li>The spacecraft +XY direction correctly directs to the velocity direction, and its +Z axis roughly directs to the sun.</li>
</ul>
<img src="Specifications/Dynamics/./figs/CtrlAtt_case4.jpg" alt="Case4" style="zoom: 90%;" />  
<h2 id="4-references-12"><a class="header" href="#4-references-12">4. References</a></h2>
<ol>
<li>NA</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-orbit"><a class="header" href="#specification-for-orbit">Specification for Orbit</a></h1>
<h2 id="1--overview-29"><a class="header" href="#1--overview-29">1.  Overview</a></h2>
<h3 id="1-functions-14"><a class="header" href="#1-functions-14">1. functions</a></h3>
<ul>
<li>The <code>Orbit</code> class calculates the position and velocity of satellites with the following propagation mode.
<ul>
<li><code>KEPLER</code>   : Kepler orbit propagation without disturbances and thruster maneuver</li>
<li><code>SGP4</code>     : SGP4 propagation using TLE without thruster maneuver</li>
<li><code>RK4</code>      : RK4 propagation with disturbances and thruster maneuver</li>
<li><code>ENCKE</code>    : Encke's orbit propagation with disturbances and thruster maneuver</li>
<li><code>RELATIVE</code> : Relative dynamics (for formation flying simulation)</li>
</ul>
</li>
<li>The <code>KEPLER</code> mode is the simplest and general for all users.</li>
<li>The <code>SGP4</code> mode is useful for LEO satellites users without orbit control.</li>
<li>When users need to analyze the orbit disturbance force effect or the orbit control algorithm, the users should choose <code>RK4</code> or <code>ENCKE</code> mode.</li>
<li>For multiple satellite operation, <code>RELATIVE</code> mode is useful.`</li>
</ul>
<h3 id="2-files-4"><a class="header" href="#2-files-4">2. files</a></h3>
<ul>
<li><code>src/dynamics/orbit/orbit.hpp, cpp</code>
<ul>
<li>Definition of <code>Orbit</code> base class</li>
</ul>
</li>
<li><code>src/dynamics/orbit/initialize_orbit.hpp, .cpp</code>
<ul>
<li>Make an instance of orbit class.	</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-15"><a class="header" href="#3-how-to-use-15">3. How to use</a></h3>
<ul>
<li>Make an instance of the orbit class in <code>Initialize</code> function in <code>dynamics.cpp</code></li>
<li>Select <code>propagate_mode</code> in the spacecraft's ini file(eg. <code>sample_spacecraft.ini</code>).</li>
<li>Select <code>initialize_mode</code> in the spacecraft's ini file(eg. <code>sample_spacecraft.ini</code>).
<ul>
<li>This setting works only for <code>RK4</code>, <code>KEPLER</code>, and <code>ENCKE</code> mode.</li>
</ul>
</li>
<li>Set the orbit information in the ini file
<ul>
<li>You can see the details in the documents for each orbit propagation mode.</li>
</ul>
</li>
<li>The definition of the coordinate system is decided at <code>[CELESTIAL_INFORMATION]</code> section in <code>sample_simulation_base.ini</code>.</li>
</ul>
<h2 id="2-explanation-of-algorithm-14"><a class="header" href="#2-explanation-of-algorithm-14">2. Explanation of Algorithm</a></h2>
<p>In the Orbit base class provides the following common functions for every propagator.</p>
<h3 id="1-updatebyattitude-function"><a class="header" href="#1-updatebyattitude-function">1. <code>UpdateByAttitude</code> function</a></h3>
<ul>
<li>The <code>UpdateByAttitude</code> function simply converts the velocity vector of the spacecraft (in ECI coordinate system) to body coordinate system notation using the argument: <code>quaternion_i2b</code>.</li>
</ul>
<h3 id="2-setacceleration_i_m_s2-addacceleration_i_m_s2-addforce_i_n-addforce_b_n-function"><a class="header" href="#2-setacceleration_i_m_s2-addacceleration_i_m_s2-addforce_i_n-addforce_b_n-function">2. <code>SetAcceleration_i_m_s2</code>, <code>AddAcceleration_i_m_s2</code>, <code>AddForce_i_N</code>, <code>AddForce_b_N</code> function</a></h3>
<ul>
<li>These functions provides the interface to include orbital disturbance or control forces.</li>
</ul>
<h3 id="2-transformeceftogeodetic-function"><a class="header" href="#2-transformeceftogeodetic-function">2. <code>TransformEcefToGeodetic</code> function</a></h3>
<ul>
<li>The <code>TransformEcefToGeodetic</code> function calculates latitude[rad], longitude[rad], and altitude[m]. Currently, we use the <code>Geodetic</code> class to calculate the information.</li>
</ul>
<h3 id="3-transformecitoecef-function"><a class="header" href="#3-transformecitoecef-function">3. <code>TransformEciToEcef</code> function</a></h3>
<ul>
<li>The <code>TransformEciToEcef</code> function can convert the position and the velocity of the satellite from the ECI frame to the ECEF frame, which considers the earth's rotation.</li>
</ul>
<h2 id="3-results-of-verifications-15"><a class="header" href="#3-results-of-verifications-15">3. Results of verifications</a></h2>
<ul>
<li>The verification results are described in the document of each propagation method.</li>
</ul>
<h2 id="4-references-13"><a class="header" href="#4-references-13">4. References</a></h2>
<p>NA</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-kepler-orbit-propagation"><a class="header" href="#specification-for-kepler-orbit-propagation">Specification for Kepler Orbit Propagation</a></h1>
<h2 id="1--overview-30"><a class="header" href="#1--overview-30">1.  Overview</a></h2>
<h3 id="1-functions-15"><a class="header" href="#1-functions-15">1. Functions</a></h3>
<ul>
<li>The <code>KeplerOrbit</code> class calculates the satellite position and velocity with the simple two-body problem. We ignored any disturbances and generated forces by the satellite.</li>
<li>This orbit propagation mode provides the simplest and fastest orbit calculation for any orbit(LEO, GEO, Deep Space, and so on.).</li>
</ul>
<h3 id="2-files-5"><a class="header" href="#2-files-5">2. Files</a></h3>
<ul>
<li><code>src/dynamics/orbit/orbit.hpp, cpp</code>
<ul>
<li>Definition of <code>Orbit</code> base class</li>
</ul>
</li>
<li><code>src/dynamics/orbit/initialize_orbit.hpp, .cpp</code>
<ul>
<li>Make an instance of orbit class.	</li>
</ul>
</li>
<li><code>src/dynamics/orbit/kepler_orbit_propagation.hpp, .cpp</code></li>
<li>Libraries
<ul>
<li><code>src/library/orbit/kepler_orbit.cpp, hpp</code></li>
<li><code>src/library/orbit/orbital_elements.cpp, hpp</code></li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-16"><a class="header" href="#3-how-to-use-16">3. How to use</a></h3>
<ul>
<li>Select <code>propagate_mode = KEPLER</code> in the spacecraft's ini file.</li>
<li>Select <code>initialize_mode</code> as you want.
<ul>
<li><code>DEFAULT</code>             : Use default initialize method (<code>RK4</code> and <code>ENCKE</code> use position and velocity, <code>KEPLER</code> uses init_mode_kepler)</li>
<li><code>POSITION_VELOCITY_I</code> : Initialize with position and velocity in the inertial frame</li>
<li><code>ORBITAL_ELEMENTS</code>    : Initialize with orbital elements</li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-15"><a class="header" href="#2-explanation-of-algorithm-15">2. Explanation of Algorithm</a></h2>
<h3 id="1-keplerorbitcalcconstkeplermotion-function"><a class="header" href="#1-keplerorbitcalcconstkeplermotion-function">1. <code>KeplerOrbit::CalcConstKeplerMotion</code> function</a></h3>
<h4 id="1-overview-54"><a class="header" href="#1-overview-54">1. Overview</a></h4>
<ul>
<li>This function calculates the following constant values.
<ul>
<li>Mean motion</li>
<li>Frame conversion matrix from in-plane position to the inertial frame position</li>
</ul>
</li>
</ul>
<h4 id="2-inputs-and-outputs-25"><a class="header" href="#2-inputs-and-outputs-25">2. Inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>Orbital Elements</li>
<li>$\mu$ : The standard gravitational parameter of the central body</li>
</ul>
</li>
<li>Output
<ul>
<li>$n$ : Mean motion</li>
<li>$R_{p2i}$ : Frame conversion matrix from in-plane position to the inertial frame position</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-32"><a class="header" href="#3-algorithm-32">3. Algorithm</a></h4>
<ul>
<li>Mean motion
\[
n = \sqrt{\frac{\mu}{a^3}}
\]</li>
<li>Frame conversion matrix from in-plane position to ECI position
\[
R_{p2i} = R_z(-\Omega)R_x(-i)R_z(-\omega)
\]
\[
R_x(\theta) = \begin{pmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp;  \cos{\theta} &amp; \sin{\theta} \\
0 &amp; -\sin{\theta} &amp; \cos{\theta}
\end{pmatrix}
\]
\[
R_z(\theta) = \begin{pmatrix}
\cos{\theta} &amp; \sin{\theta} &amp; 0 \\
-\sin{\theta} &amp; \cos{\theta} &amp; 0 \\
0 &amp; 0 &amp; 1
\end{pmatrix}
\]</li>
</ul>
<h3 id="2-keplerorbitcalcorbit-function"><a class="header" href="#2-keplerorbitcalcorbit-function">2. <code>KeplerOrbit::CalcOrbit</code> function</a></h3>
<h4 id="1-overview-55"><a class="header" href="#1-overview-55">1. Overview</a></h4>
<ul>
<li>This function calculates the position and velocity of the spacecraft in the inertial frame at the designated time.</li>
</ul>
<h4 id="2-inputs-and-outputs-26"><a class="header" href="#2-inputs-and-outputs-26">2. Inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>$t$ : Time in Julian day</li>
<li>Orbital Elements</li>
<li>Constants</li>
</ul>
</li>
<li>Output
<ul>
<li>$\boldsymbol{r}_{i}$ : Position in the inertial frame</li>
<li>$\boldsymbol{v}_{i}$ : Velocity in the inertial frame</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-33"><a class="header" href="#3-algorithm-33">3. Algorithm</a></h4>
<ul>
<li>Calculate mean anomaly $l$[rad]
\[
l = n * (t-t_{epoch})
\]</li>
<li>Calculate eccentric anomaly $u$[rad] by solving the Kepler Equation
<ul>
<li>Details are described in <code>KeplerOrbit::SolveKeplerFirstOrder</code></li>
</ul>
</li>
<li>Calculate two dimensional position $x^{*}$, $y^{*}$ and velocity $\dot{x}^{*}$, $\dot{y}^{*}$ in the orbital plane
\[
\begin{align}
x^* &amp;= a(\cos{u}-e)\\
y^* &amp;= a\sqrt{1-e^2}\sin{u}\\
\dot{x}^* &amp;= -an\frac{\sin{u}}{1^e\cos{u}}\\
\dot{y}^* &amp;= an\sqrt{1-e^2}\frac{\cos{u}}{1^e\cos{u}}\\
\end{align}
\]</li>
<li>Convert to the inertial frame
\[
\begin{align}
\boldsymbol{r}_{i} &amp;= R_{p2i}\begin{bmatrix} x^* \\
y^* \\
0
\end{bmatrix}\\
\boldsymbol{v}_{i} &amp;= R_{p2i}\begin{bmatrix} \dot{x}^* \\
\dot{y}^* \\
0
\end{bmatrix}\\
\end{align}
\]</li>
</ul>
<h3 id="3-keplerorbitsolvekeplerfirstorder-function"><a class="header" href="#3-keplerorbitsolvekeplerfirstorder-function">3. <code>KeplerOrbit::SolveKeplerFirstOrder</code> function</a></h3>
<h4 id="1-overview-56"><a class="header" href="#1-overview-56">1. Overview</a></h4>
<ul>
<li>This function solves the Kepler Equation with the first-order iterative method.</li>
<li>Note: This method is not suited to the high eccentricity orbit. It is better to use the Newton-Raphson method for such a case.
<ul>
<li>From <code>v6.0.0</code> we have <code>SolveKeplerNewtonMethod</code> and use it. The detail of the method will be write.</li>
</ul>
</li>
</ul>
<h4 id="2-inputs-and-outputs-27"><a class="header" href="#2-inputs-and-outputs-27">2. Inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>$e$ : eccentricity</li>
<li>$l$ : mean anomaly [rad]</li>
<li>$\epsilon$ : threshold for convergence [rad]</li>
<li>Limit of iteration</li>
</ul>
</li>
<li>Output
<ul>
<li>$u$ : eccentric anomaly [rad]</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-34"><a class="header" href="#3-algorithm-34">3. Algorithm</a></h4>
<ul>
<li>Set the initial value of eccentric anomaly as follows
<ul>
<li>$u_0=l$</li>
</ul>
</li>
<li>Calculate $u_{n+1}$ with the following equation
\[
u_{n+1} = l + e\sin{u_n}
\]</li>
<li>Iterate the calculation until the following conditions are satisfied
<ul>
<li>$|u_{n+1} - u_{n}| &lt; \epsilon$</li>
<li>The iteration number over the limit of iteration</li>
</ul>
</li>
</ul>
<h3 id="4-orbitalelementscalcoefromposvel-function"><a class="header" href="#4-orbitalelementscalcoefromposvel-function">4. <code>OrbitalElements::CalcOeFromPosVel</code> function</a></h3>
<h4 id="1-overview-57"><a class="header" href="#1-overview-57">1. Overview</a></h4>
<ul>
<li>This function calculates the orbital elements from the initial position and velocity in the inertial frame.</li>
</ul>
<h4 id="2-inputs-and-outputs-28"><a class="header" href="#2-inputs-and-outputs-28">2. Inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>$\mu$ : The standard gravitational parameter of the central body</li>
<li>$t$ : Time in Julian day</li>
<li>$\boldsymbol{r}_{i}$ : Initial position in the inertial frame</li>
<li>$\boldsymbol{v}_{i}$ : Initial velocity in the inertial frame</li>
</ul>
</li>
<li>Output
<ul>
<li>orbital element</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-35"><a class="header" href="#3-algorithm-35">3. Algorithm</a></h4>
<ul>
<li>$\boldsymbol{h}_{i}$ : Angular momentum vector of the orbit
\[
\boldsymbol{h}_{i} = \boldsymbol{r}_{i} \times \boldsymbol{v}_{i}
\]</li>
<li>$a$ : Semi-major axis
\[
a = \frac{\mu}{2\frac{\mu}{r} - v^2}
\]</li>
<li>$i$ : Inclination
\[
i = \cos^{-1}{h_z}
\]</li>
<li>$\Omega$ : Right Ascension of the Ascending Node (RAAN)
<ul>
<li>Note: This equation is not support $i = 0$ case.
\[
\Omega = \sin^{-1}\left(\frac{h_x}{\sqrt{h_x^2 + h_y^2}}\right)
\]</li>
</ul>
</li>
<li>$x_{p}, y_{p}$ : Position in the orbital plane
\[
\begin{align}
x_{p} &amp;= r_{ix} \cos{\Omega} + r_{iy} \sin{\Omega};\\
y_{p} &amp;= (-r_{ix} \sin{\Omega} + r_{iy} \cos{\Omega})\cos{i} + r_{iz}\sin{i}
\end{align}
\]</li>
<li>$\dot{x}_{p}, \dot{y}_{p}$ : Velocity in the orbital plane
\[
\begin{align}
\dot{x}_{p} &amp;= v_{ix} \cos{\Omega} + v_{iy} \sin{\Omega};\\
\dot{y}_{p} &amp;= (-v_{ix} \sin{\Omega} + v_{iy} \cos{\Omega})\cos{i} + v_{iz}\sin{i}
\end{align}
\]</li>
<li>$e$ : Eccentricity
\[
\begin{align}
c_1 &amp;= \frac{h}{\mu}\dot{y}_p - \frac{x_p}{r}\\
c_2 &amp;= -\frac{h}{\mu}\dot{x}_p - \frac{y_p}{r}\\
e &amp;= \sqrt{c_1^2 + c_2^2}
\end{align}
\]</li>
<li>$\omega$ : Argument of Perigee
\[
\omega = \tan^{-1}\left(\frac{c_2}{c_1}\right)
\]</li>
<li>$t_{epoch}$ : Epoch [Julian day]
\[
\begin{align}
f &amp;= \tan^{-1}\left(\frac{y_p}{x_p}\right) - \omega\\
u &amp;= \tan^{-1}\frac{\frac{r \sin{f}}{\sqrt{1-e^2}}}{r\cos{f} + ae}\\
\end{align}
\]
\[
\begin{align}
n &amp;= \sqrt{\frac{\mu}{a^3}}\\
dt &amp;= \frac{u - e\sin{u}}{n}\\
t_{epoch} &amp;= t - \frac{dt}{24<em>60</em>60}
\end{align}
\]</li>
</ul>
<h2 id="3-results-of-verifications-16"><a class="header" href="#3-results-of-verifications-16">3. Results of verifications</a></h2>
<h3 id="1-comparison-with-rk4"><a class="header" href="#1-comparison-with-rk4">1. Comparison with RK4</a></h3>
<h4 id="1-overview-58"><a class="header" href="#1-overview-58">1. Overview</a></h4>
<ul>
<li>We compared the calculated orbit result between RK4 mode and Kepler mode. In the RK4 mode, all disturbances are disabled since the Kepler mode ignores them.</li>
<li>In the Kepler mode, we verified the correctness of both initialize modes (<code>ORBITAL_ELEMENTS</code> and <code>POSITION_VELOCITY_I</code>).</li>
</ul>
<h4 id="2-conditions-for-the-verification-11"><a class="header" href="#2-conditions-for-the-verification-11">2. Conditions for the verification</a></h4>
<ul>
<li>sample_simulation_base.ini
<ul>
<li>The following values are modified from the default.
<pre><code>EndTimeSec = 10000
LogOutPutIntervalSec = 5
</code></pre>
</li>
</ul>
</li>
<li>SampleDisturbance.ini
<ul>
<li>All disturbances are disabled.</li>
</ul>
</li>
<li>SampleSat.ini
<ul>
<li>The following values are modified from the default.
<ul>
<li><code>propagate_mode</code> is changed for each mode.</li>
<li>Orbital elements for Kepler
<pre><code>semi_major_axis_m = 6794500.0
eccentricity = 0.0015
inclination_rad = 0.9012
raan_rad = 0.1411
arg_perigee_rad = 1.7952
epoch_jday = 2.458940966402607e6
</code></pre>
</li>
<li>Initial position and velocity (compatible value with the orbital elements)
<pre><code>init_position(0) = 1791860.131
init_position(1) = 4240666.743
init_position(2) = 4985526.129
init_velocity(0) = -7349.913889
init_velocity(1) = 631.6563971
init_velocity(2) = 2095.780148
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-results-7"><a class="header" href="#3-results-7">3. Results</a></h4>
<ul>
<li>
<p>The following figure shows the orbit calculation result of Kepler mode with <code>ORBITAL_ELEMENTS</code> initialize mode.</p>
<ul>
<li>The result looks correct.</li>
</ul>
<div align="center">
<img src="Specifications/Dynamics/./figs/orbit_kepler_oe.jpg" width=80% alt="">
</div>
</li>
<li>
<p>The difference between Kepler mode with <code>ORBITAL_ELEMENTS</code> initialize mode and RK4 mode is shown in the following figure.</p>
<ul>
<li>The error between them is small (less than 10m), and we confirmed that the calculation of Kepler orbit is correct.</li>
</ul>
<div align="center">
<img src="Specifications/Dynamics/./figs/orbit_kepler_oe_vs_rk4.jpg" width=80% alt="">
</div>
</li>
<li>
<p>The following figure shows the difference between Kepler orbit calculation with <code>ORBITAL_ELEMENTS</code>  and <code>POSITION_VELOCITY_I</code> initialize mode.</p>
<ul>
<li>The error between them is small (less than 10m), and we confirmed that the initializing method is correct.</li>
</ul>
<div align="center">
<img src="Specifications/Dynamics/./figs/orbit_kepler_oe_vs_posvel.jpg" width=80% alt="">
</div>
</li>
</ul>
<h2 id="4-references-14"><a class="header" href="#4-references-14">4. References</a></h2>
<ul>
<li>Hiroshi Kinoshita, &quot;Celestial mechanisms and orbital dynamics&quot;, ch.2, 1998 (written in Japanese)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-sgp4-orbit-propagation"><a class="header" href="#specification-for-sgp4-orbit-propagation">Specification for SGP4 Orbit Propagation</a></h1>
<h2 id="1--overview-31"><a class="header" href="#1--overview-31">1.  Overview</a></h2>
<h3 id="1-functions-16"><a class="header" href="#1-functions-16">1. functions</a></h3>
<ul>
<li>The <code>Sgp4OrbitPropagation</code> class calculates the position and velocity of satellites by using SGP4 method with TLE.</li>
</ul>
<h3 id="2-files-6"><a class="header" href="#2-files-6">2. files</a></h3>
<ul>
<li><code>src/dynamics/orbit/orbit.hpp, cpp</code>
<ul>
<li>Definition of <code>Orbit</code> base class</li>
</ul>
</li>
<li><code>src/dynamics/orbit/initialize_orbit.hpp, .cpp</code>
<ul>
<li>Make an instance of orbit class.</li>
</ul>
</li>
<li><code>src/dynamics/orbit/sgp4_orbit_propagation.hpp, .cpp</code>
<ul>
<li>Library of SGP4</li>
<li><code>/src/library/external/sgp4</code></li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-17"><a class="header" href="#3-how-to-use-17">3. How to use</a></h3>
<ul>
<li>Select <code>propagate_mode = SGP4</code> in the spacecraft's ini file.</li>
<li>Set the TLE you need like the following example
<pre><code>tle1=1 25544U 98067A   20076.51604214  .00016717  00000-0  10270-3 0  9005
tle2=2 25544  51.6412  86.9962 0006063  30.9353 329.2153 15.49228202 17647
</code></pre>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-16"><a class="header" href="#2-explanation-of-algorithm-16">2. Explanation of Algorithm</a></h2>
<h3 id="1-propagate-function"><a class="header" href="#1-propagate-function">1. Propagate function</a></h3>
<ul>
<li>The difference between the <code>current Julian day</code> and the original period in TLE in units of [minutes] (elapse_time_min) is calculated, and it is used  in the argument of the sgp4 function of the SGP4 calculation execution function. At the same time, the geodetic system definition (<code>whichconst</code>) and the trajectory information structure (<code>satrec</code>) are also required, which are defined at the call of the constructor. The position [m] and velocity [m/s] of the spacecraft are assigned to the member variables sat_position_i_ and sat_velocity_i_ as the output of the sgp4 function. Note that the values, in this case are the values from the ECI coordinate system.</li>
</ul>
<h2 id="3-results-of-verifications-17"><a class="header" href="#3-results-of-verifications-17">3. Results of verifications</a></h2>
<h3 id="1-verification-of-sgp4"><a class="header" href="#1-verification-of-sgp4">1. Verification of SGP4</a></h3>
<h4 id="1-overview-59"><a class="header" href="#1-overview-59">1. Overview</a></h4>
<ul>
<li>Verify whether the propagation of SGP4 is correctly installed or not.</li>
<li>By comparing the propagation result of SGP4 in STK simulator and S2E</li>
</ul>
<h4 id="2-conditions-for-the-verification-12"><a class="header" href="#2-conditions-for-the-verification-12">2. Conditions for the verification</a></h4>
<ul>
<li>Conduct verification using the two different initial TLE cases with different time spans.</li>
</ul>
<ol>
<li>
<p>Hodoyoshi orbit : (span:10000 second)</p>
<ul>
<li>TLE</li>
</ul>
<pre><code>40299U 14070B   20001.00000000 -.00003285  00000-0 -13738-3 0 00007
40299 097.3451 081.6192 0014521 069.5674 178.3972 15.23569636286180
</code></pre>
</li>
<li>
<p>ISS Release orbit (span:10 days)</p>
<ul>
<li>TLE</li>
</ul>
<pre><code>99999U   20001.00000000  .00000007  00000-0  93906-7 0 00002
99999 053.4260 297.1689 0008542 245.4975 274.8981 15.55688139000015
</code></pre>
</li>
</ol>
<h4 id="3-results-8"><a class="header" href="#3-results-8">3. Results</a></h4>
<ol>
<li>
<p>Hodoyoshi orbit : (span:10000 second)</p>
<ul>
<li>Left: STK,  Right: S2E<div align="center">
    <img src="Specifications/Dynamics/./figs/Verification_Hodoyoshi_stk.png" width = 430 alt="orbit_steptimesec_01">
    <img src="Specifications/Dynamics/./figs/Verification_Hodoyoshi_s2e.png" width = 400 alt="orbit_steptimesec_01">
  </figure>
</div>
The outputs of the satellite position are almost the same between the two simulators.
</li>
</ul>
</li>
<li>
<p>ISS Release orbit : (span:10000 second)</p>
<ul>
<li>Left: STK,  Right: S2E <div align="center">
    <img src="Specifications/Dynamics/./figs/Verification_ISS_stk.png" width = 400 alt="orbit_steptimesec_01">
    <img src="Specifications/Dynamics/./figs/Verification_ISS_s2e.png" width = 480 alt="orbit_steptimesec_01">
  </figure>
</div>
The outputs of the satellite position are almost the same between the two simulators.
</li>
</ul>
</li>
</ol>
<h2 id="4-references-15"><a class="header" href="#4-references-15">4. References</a></h2>
<p>NA</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-orbit-dynamics-with-rk4-propagation"><a class="header" href="#specification-for-orbit-dynamics-with-rk4-propagation">Specification for Orbit dynamics with RK4 propagation</a></h1>
<h2 id="1--overview-32"><a class="header" href="#1--overview-32">1.  Overview</a></h2>
<h3 id="1-functions-17"><a class="header" href="#1-functions-17">1. functions</a></h3>
<ul>
<li>The <code>Rk4OrbitPropagation</code> class calculates the position and velocity of satellites with 4th Order Runge-Kutta method(RK4).</li>
</ul>
<h3 id="2-files-7"><a class="header" href="#2-files-7">2. files</a></h3>
<ul>
<li><code>src/dynamics/orbit/orbit.hpp, cpp</code>
<ul>
<li>Definition of <code>Orbit</code> base class</li>
</ul>
</li>
<li><code>src/dynamics/orbit/initialize_orbit.hpp, .cpp</code>
<ul>
<li>Make an instance of orbit class.	</li>
</ul>
</li>
<li><code>src/dynamics/orbit/rk4_orbit_propagation.hpp, .cpp</code></li>
</ul>
<h3 id="3-how-to-use-18"><a class="header" href="#3-how-to-use-18">3. How to use</a></h3>
<ul>
<li>Select <code>propagate_mode = RK4</code> in the spacecraft's ini file.</li>
<li>Select <code>initialize_mode</code> as you want.
<ul>
<li><code>DEFAULT</code>             : Use default initialize method (<code>RK4</code> and <code>ENCKE</code> use position and velocity, <code>KEPLER</code> uses init_mode_kepler)</li>
<li><code>POSITION_VELOCITY_I</code> : Initialize with position and velocity in the inertial frame</li>
<li><code>ORBITAL_ELEMENTS</code>    : Initialize with orbital elements</li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-17"><a class="header" href="#2-explanation-of-algorithm-17">2. Explanation of Algorithm</a></h2>
<h3 id="1-propagate-function-1"><a class="header" href="#1-propagate-function-1">1. <code>Propagate</code> function</a></h3>
<ul>
<li>The position and velocity of the satellite are updated by using RK4. As the input of RK4, the six-state variables are set. These state variables are the three-dimensional position [$x$, $y$ ,$z$] and three-dimensional velocity [$v_x$, $v_y$, $v_z$] at the inertial coordinate. Here, the inertial coordinate is decided by the <code>PlanetSelect.ini</code></li>
<li>As the force which works to the satellite motion is the external acceleration [$a_x$,$a_y$,$a_z$] calculated from the disturbance class or thruster class and the gravity force from the center planet, which is defined in <code>PlanetSelect.ini</code>. As a summary, the orbit is calculated as the following equation.
\[
\begin{align}
\dot{x} &amp;= v_x\\
\dot{y} &amp;= v_y\\
\dot{z} &amp;= v_z\\
\dot{v}_x &amp;= a_x-\mu\frac{x}{r^3}\\
\dot{v}_y &amp;= a_y-\mu\frac{y}{r^3}\\
\dot{v}_z &amp;= a_z-\mu\frac{z}{r^3}\\
r &amp;= \sqrt{x^2+y^2+z^2}
\end{align}
\]</li>
</ul>
<h2 id="3-results-of-verifications-18"><a class="header" href="#3-results-of-verifications-18">3. Results of verifications</a></h2>
<h3 id="1-verification-of-the-error-of-fourth-order-runge-kutta-method-rk4"><a class="header" href="#1-verification-of-the-error-of-fourth-order-runge-kutta-method-rk4">1. Verification of the error of Fourth Order Runge-Kutta method (RK4)</a></h3>
<h4 id="1-overview-60"><a class="header" href="#1-overview-60">1. Overview</a></h4>
<ul>
<li>Verify the numerical integration error of the RK4 method.</li>
<li>The output of the simulation was compared with the analytical solution.</li>
</ul>
<h4 id="2-conditions-for-the-verification-13"><a class="header" href="#2-conditions-for-the-verification-13">2. conditions for the verification</a></h4>
<ul>
<li>The Verifications were conducted in the case of <code>simulation_step_s</code> and <code>orbit_update_period_s</code> were 0.1(sec), 1(sec), and 10(sec).</li>
<li>The initial values of the propagation are as follows:
<pre><code>initial_position_i_m(0) = 1.5944017672e7
initial_position_i_m(1) = 0.0
initial_position_i_m(2) = 0.0

initial_velocity_i_m_s(0) = 0.0
initial_velocity_i_m_s(1) = 5000.0
initial_velocity_i_m_s(2) = 0.0
</code></pre>
</li>
<li>This is a circular orbit, which period is about 20040(sec). The center of the orbit is Earth.</li>
<li>As a reference, the analytical solution was used. The solution is as follows:
\[
x=R\cos(\omega t),y=R\sin(\omega t)\quad when~R=1.5944017672\times10^7, \omega=0.000313597243985794
\]</li>
<li>All of the effects of disturbance and environment were disabled.</li>
<li>The simulation time is 60120(sec), which is approximately three-period. In addition, for a long-term test, the case in which simulation time is 200400(about 10 periods) was tested. The <code>orbit_update_period_s</code> of this case is 1(sec).</li>
</ul>
<h4 id="3-results-9"><a class="header" href="#3-results-9">3. results</a></h4>
<div align="center">
  <img src="Specifications/Dynamics/./figs/orbit_steptimesec_01.jpg" width = 400 alt="orbit_steptimesec_01">
  <img src="Specifications/Dynamics/./figs/orbit_steptimesec_1.jpg" width = 400 alt="orbit_steptimesec_1">
  <img src="Specifications/Dynamics/./figs/orbit_steptimesec_10.jpg" width = 400 alt="orbit_steptimesec_10">
  </figure>
</div>
<ul>
<li>In the cases of <code>orbit_update_period_s=0.1</code> and <code>orbit_update_period_s=1</code>, the error is kept within $10^{-6}$ order. However, once the error grows, it will get bigger and bigger.</li>
<li>In the case of <code>orbit_update_period_s=10</code>, the error quickly grows up to $10^{-4}$ order. </li>
</ul>
<div align="center">
  <img src="Specifications/Dynamics/./figs/orbit_steptimesec_1_longterm.jpg" width = 400 alt="orbit_steptimesec_1_longterm">
  </figure>
</div>
<ul>
<li>In the long-term test result, it is clear that the error magnitude grows proportionally to the time.</li>
</ul>
<h4 id="4-others"><a class="header" href="#4-others">4. Others</a></h4>
<ul>
<li>At first, the output of STK would be used for reference. However, it did not work well. Data were input as follows:</li>
</ul>
<div align="center">
  <img src="Specifications/Dynamics/./figs/orbit_STKsettings.JPG" alt="orbit_STKsettings">
  </figure>
</div>
<ul>
<li>However, the result is as follows:</li>
</ul>
<div align="center">
  <img src="Specifications/Dynamics/./figs/orbit_STKresult.JPG" alt="orbit_STKresult">
  </figure>
</div>
<ul>
<li>As this figure shows, the initial values in the result are slightly different from the input.
<ul>
<li>In the .sa files, the initial values of $x, y, z, v_x, v_y, v_z$ are converted into elements of orbit and stored. The error might occur in the process of this conversion.</li>
</ul>
</li>
</ul>
<h2 id="4-references-16"><a class="header" href="#4-references-16">4. References</a></h2>
<p>NA</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-orbit-propagation-with-enckes-method"><a class="header" href="#specification-for-orbit-propagation-with-enckes-method">Specification for Orbit Propagation with Encke's Method</a></h1>
<h2 id="1--overview-33"><a class="header" href="#1--overview-33">1.  Overview</a></h2>
<h3 id="1-functions-18"><a class="header" href="#1-functions-18">1. functions</a></h3>
<ul>
<li>The <code>EnckeOrbitPropagation</code> class calculates the satellite position and velocity with Encke's method, including disturbances and controlled accelerations by the satellite.</li>
<li>This orbit propagation mode provides an accurate and efficient orbit calculation with disturbance forces.</li>
<li>We can also use it for accurate relative orbit propagation, and the feature will be implemented soon.</li>
</ul>
<h3 id="2-files-8"><a class="header" href="#2-files-8">2. files</a></h3>
<ul>
<li><code>src/dynamics/orbit/orbit.hpp, cpp</code>
<ul>
<li>Definition of <code>Orbit</code> base class</li>
</ul>
</li>
<li><code>src/dynamics/orbit/initialize_orbit.hpp, .cpp</code>
<ul>
<li>Make an instance of orbit class.	</li>
</ul>
</li>
<li><code>src/dynamics/orbit/encke_orbit_propagation.cpp, .hpp</code></li>
<li>We use <a href="Specifications/Dynamics/./Spec_KeplerOrbit.html">KeplerOrbit</a> libraries to calculate the reference orbit.</li>
</ul>
<h3 id="3-how-to-use-19"><a class="header" href="#3-how-to-use-19">3. How to use</a></h3>
<ul>
<li>Select <code>propagate_mode = ENCKE</code> in the spacecraft's ini file.</li>
<li>Select <code>initialize_mode</code> as you want.
<ul>
<li><code>DEFAULT</code>             : Use default initialize method (<code>RK4</code> and <code>ENCKE</code> use position and velocity, <code>KEPLER</code> uses init_mode_kepler)</li>
<li><code>POSITION_VELOCITY_I</code> : Initialize with position and velocity in the inertial frame</li>
<li><code>ORBITAL_ELEMENTS</code>    : Initialize with orbital elements</li>
</ul>
</li>
<li>Set the value of <code>error_tolerance</code>, which decides the threshold for the rectification.</li>
</ul>
<h2 id="2-explanation-of-algorithm-18"><a class="header" href="#2-explanation-of-algorithm-18">2. Explanation of Algorithm</a></h2>
<h3 id="1-enckeorbitpropagationinitialize-function"><a class="header" href="#1-enckeorbitpropagationinitialize-function">1. <code>EnckeOrbitPropagation::Initialize</code> function</a></h3>
<h4 id="1-overview-61"><a class="header" href="#1-overview-61">1. Overview</a></h4>
<ul>
<li>This function generates the initial value of the reference orbit and the difference orbit.</li>
</ul>
<h4 id="2-inputs-and-outputs-29"><a class="header" href="#2-inputs-and-outputs-29">2. Inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>$\mu$ : The standard gravitational parameter of the central body</li>
<li>$t$ : Time in Julian day</li>
<li>$\boldsymbol{r}_{i}$ : Initial position in the inertial frame</li>
<li>$\boldsymbol{v}_{i}$ : Initial velocity in the inertial frame</li>
</ul>
</li>
<li>Output
<ul>
<li>The reference orbit</li>
<li>The difference is set as zero</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-36"><a class="header" href="#3-algorithm-36">3. Algorithm</a></h4>
<ul>
<li>The reference orbit is initialized as the Kepler Orbit with <code>OrbitalElements::CalcOeFromPosVel</code> function. The detail of the function is described in <a href="Specifications/Dynamics/./Spec_KeplerOrbit.html">Specification for Kepler Orbit Propagation</a></li>
</ul>
<h3 id="2-enckeorbitpropagationpropagate-function"><a class="header" href="#2-enckeorbitpropagationpropagate-function">2. <code>EnckeOrbitPropagation::Propagate</code> function</a></h3>
<h4 id="1-overview-62"><a class="header" href="#1-overview-62">1. Overview</a></h4>
<ul>
<li>This function is the main algorithm of Encke's method and calculates the orbit of the spacecraft.</li>
<li>The method separates the orbit to the reference and the difference. The reference is calculated with the Kepler orbit method as a two-body problem, and the difference is calculated, including the disturbances.
<ul>
<li>$\boldsymbol{r}_{ref}$ : Reference orbit</li>
<li>$\boldsymbol{\delta}$ : Difference</li>
</ul>
</li>
<li>Please refer to the references to learn the original idea of Encke's method.</li>
</ul>
<h4 id="2-inputs-and-outputs-30"><a class="header" href="#2-inputs-and-outputs-30">2. Inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>$\boldsymbol{a}_d$ : Acceleration</li>
<li>$t$ : Current time</li>
</ul>
</li>
<li>Output
<ul>
<li>$\boldsymbol{r}_{i}$ : Initial position in the inertial frame</li>
<li>$\dot{\boldsymbol{r}}_{i}$ : Initial velocity in the inertial frame</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-37"><a class="header" href="#3-algorithm-37">3. Algorithm</a></h4>
<ol>
<li>Rectification</li>
</ol>
<ul>
<li>If the norm of the difference is larger than the tolerance, we need to update the reference orbit as the latest orbit information.</li>
</ul>
<ol start="2">
<li>Update reference orbit</li>
</ol>
<ul>
<li>The reference orbit is calculated with the Kepler orbit calculation method.</li>
</ul>
<ol start="3">
<li>Propagate the difference</li>
</ol>
<ul>
<li>Propagate the following differential equation. At this moment, we use the fourth-order Runge-Kutta method as a propagator.
\[
\begin{align}
\ddot{\boldsymbol{\delta}} &amp;= -\frac{\mu}{r_{ref}^3}(\boldsymbol{\delta}+f(q)\boldsymbol{r})+\boldsymbol{a}_d\\
f(q) &amp;= q \frac{q^2 + 3q + 3}{(1+q)^{1.5} + 1}\\
q &amp;= \frac{\boldsymbol{\delta}\cdot(\boldsymbol{\delta}-2\boldsymbol{r}_i)}{r_i}
\end{align}
\]</li>
</ul>
<h2 id="3-results-of-verifications-19"><a class="header" href="#3-results-of-verifications-19">3. Results of verifications</a></h2>
<h3 id="1-comparison-with-rk4-1"><a class="header" href="#1-comparison-with-rk4-1">1. Comparison with RK4</a></h3>
<h4 id="1-overview-63"><a class="header" href="#1-overview-63">1. Overview</a></h4>
<ul>
<li>We compared the calculated orbit result between RK4 mode and Kepler mode.</li>
<li>In the Kepler mode, we verified the correctness of both initialize mode (<code>ORBITAL_ELEMENTS</code> and <code>POSITION_VELOCITY_I</code>).</li>
</ul>
<h4 id="2-conditions-for-the-verification-14"><a class="header" href="#2-conditions-for-the-verification-14">2. Conditions for the verification</a></h4>
<ul>
<li>sample_simulation_base.ini
<ul>
<li>The following values are modified from the default.
<pre><code>EndTimeSec = 10000
LogOutPutIntervalSec = 5
</code></pre>
</li>
</ul>
</li>
<li>SampleDisturbance.ini
<ul>
<li>The disturbance setting is depending on the simulation case.
<ul>
<li>All disabled or enabled. Other settings are default.</li>
</ul>
</li>
</ul>
</li>
<li>SampleSat.ini
<ul>
<li>The following values are modified from the default.
<ul>
<li><code>propagate_mode</code> is changed for each mode.</li>
<li>Orbital elements for Kepler
<pre><code>semi_major_axis_m = 6794500.0
eccentricity = 0.0015
inclination_rad = 0.9012
raan_rad = 0.1411
arg_perigee_rad = 1.7952
epoch_jday = 2.458940966402607e6
</code></pre>
</li>
<li>Initial position and velocity (compatible value with the orbital elements)
<pre><code>initial_position_i_m(0) = 1791860.131
initial_position_i_m(1) = 4240666.743
initial_position_i_m(2) = 4985526.129
initial_velocity_i_m_s(0) = -7349.913889
initial_velocity_i_m_s(1) = 631.6563971
initial_velocity_i_m_s(2) = 2095.780148
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="3">
<li>Results</li>
</ol>
<ul>
<li>
<p>The following figure shows the difference between orbit derived with Kepler mode initialized with OE and Encke mode without any disturbances.</p>
<ul>
<li>The error is small (less than 10m), and we confirmed that the Encke propagation mode is correct when the disturbances are zero.</li>
</ul>
<div align="center">
<img src="Specifications/Dynamics/./figs/orbit_encke_nodist_vs_kepler_oe.jpg" width=80% alt="">
</div>
</li>
<li>
<p>The following figure shows the difference between orbit derived with RK4 mode and Encke mode with all disturbances.</p>
<ul>
<li>The error is larger than the non-disturbance case, but the $10^4 [m]$ error between the Encke method and the Cowell method is compatible with the ref[2] when using the RK4 in LEO. We confirmed that the Encke propagation mode is correct when all disturbances are included.</li>
</ul>
<div align="center">
<img src="Specifications/Dynamics/./figs/orbit_encke_vs_rk4_dist.jpg" width=80% alt="">
</div>
</li>
</ul>
<h2 id="4-references-17"><a class="header" href="#4-references-17">4. References</a></h2>
<ul>
<li>[1] David A. Vallado, &quot;Fundamental of Astrodynamics and Applications, Third Edition&quot;, ch.8, 2007.</li>
<li>[2] Simon P. Shuster, &quot;A Survey and Performance Analysis of Orbit Propagators for LEO, GEO, and Highly Elliptical Orbits&quot;, 2017.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-relative-orbit-propagation"><a class="header" href="#specification-for-relative-orbit-propagation">Specification for Relative Orbit propagation</a></h1>
<h2 id="1-overview-64"><a class="header" href="#1-overview-64">1. Overview</a></h2>
<h3 id="1-functions-19"><a class="header" href="#1-functions-19">1. functions</a></h3>
<ul>
<li>The <code>RelativeOrbit</code> class calculates the position of a satellite with respect to a reference satellite. This class calculates the position both in the LVLH frame and inertial frame. Users can choose the update method between:
<ul>
<li>relative dynamics propagation using RK4</li>
<li>update using STM(State Transition Matrix)</li>
</ul>
</li>
</ul>
<h3 id="2-related-files-11"><a class="header" href="#2-related-files-11">2. Related files</a></h3>
<ul>
<li><code>src/dynamics/orbit/orbit.hpp, cpp</code>
<ul>
<li>Definition of <code>Orbit</code> base class</li>
</ul>
</li>
<li><code>src/dynamics/orbit/initialize_orbit.hpp, .cpp</code>
<ul>
<li>Make an instance of orbit class.</li>
</ul>
</li>
<li><code>src/dynamics/orbit/relative_orbit.hpp, .cpp</code>
<ul>
<li>Definition of the class</li>
</ul>
</li>
<li>Libraries
<ul>
<li><code>src/library/orbit/relative_orbit_models.hpp, .cpp</code></li>
</ul>
<ul>
<li>Library to store equations for various relative dynamics</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-20"><a class="header" href="#3-how-to-use-20">3. How to use</a></h3>
<ul>
<li>
<p>Relative orbit propagation is available only when multiple satellites are simulated.</p>
<ul>
<li>The sample case in S2E_CORE simulates a single satellite. For an example of simulating multiple satellites, please refer to the <a href="Specifications/Dynamics/../../Tutorials/HowToSimulateMultipleSatellites.html">tutorial</a>. </li>
</ul>
</li>
<li>
<p>Confirm the instance of <code>RelativeInformation</code> is the member of each satellite.</p>
</li>
<li>
<p>Set up the configuration of the <code>[ORBIT]</code> section in the <code>sample_spacecraft.ini</code>.</p>
<ul>
<li>Set <code>propagate_mode = RELATIVE</code> to use the relative orbit propagation</li>
<li>Choose <code>relative_orbit_update_method</code>.
<ul>
<li><code>relative_orbit_update_method = 0</code> means the orbit is updated with the propagation of the relative dynamics equation( $\dot{\boldsymbol{x}}=\boldsymbol{Ax}+\boldsymbol{Bu}$ , i.e., Hill equation).</li>
<li><code>relative_orbit_update_method = 1</code> means the orbit is updated with the STM( $\boldsymbol{x}(t)=\boldsymbol{\Phi}(t,t_0)\boldsymbol{x}(t_0)$ , i.e., Clohessy-Wiltshire solution).</li>
</ul>
</li>
<li>When you choose <code>relative_orbit_update_method = 0</code>, set <code>relative_dynamics_model_type</code>.</li>
<li>When you choose <code>relative_orbit_update_method = 1</code>, set <code>stm_model_type</code>.</li>
<li>Set the initial relative position of the satellite in the LVLH frame. LVLH frame definition is:
<ul>
<li>$\boldsymbol{x}$ is a direction vector from the reference satellite (&quot;chief&quot; in the figure) radially outward.</li>
<li>The direction of $\boldsymbol{z}$ corresponds to the angular momentum vector of the reference satellite orbit.</li>
<li>The direction of $\boldsymbol{y}$ is determined by $\boldsymbol{z}\times\boldsymbol{x}$.</li>
</ul>
</li>
</ul>
<figure>
<div align="center">
<img src="Specifications/Dynamics/./figs/RelativeOrbit_LVLHdefinition.JPG" width=70% alt="">
<figcaption>Definition of LVLH frame [1]</figcaption>
</div>
</figure>
<ul>
<li>Set the ID and ini file name of the reference satellite.
<ul>
<li>NOTE: Confirm the <code>propagate_mode</code> of the reference satellite is not 2. The orbit of the reference satellite must be propagated by the methods other than the relative orbit propagation.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-how-to-add-a-new-relative-dynamics-model"><a class="header" href="#4-how-to-add-a-new-relative-dynamics-model">4. How to add a new relative dynamics model</a></h3>
<ol>
<li>New Relative Dynamics equation</li>
</ol>
<ul>
<li>Add the name of the dynamics model to the <code>RelativeOrbitModel</code> enum in <code>relative_orbit_models.hpp</code>.</li>
<li>Add the function to calculate the system matrix like <code>CalcHillSystemMatrix</code> in <code>relative_orbit_models.hpp</code>.</li>
<li>Edit the <code>CalculateSystemMatrix</code> function in <code>relative_orbit.hpp</code>.</li>
</ul>
<ol start="2">
<li>New STM</li>
</ol>
<ul>
<li>Add the name of the dynamics model to <code>StmModel</code> enum in <code>relative_orbit_models.hpp</code>.</li>
<li>Add the function to calculate the system matrix as <code>CalcHcwStm</code>in <code>relative_orbit_models.hpp</code>.</li>
<li>Edit the <code>CalculateStm</code> function in <code>relative_orbit.hpp</code>.</li>
</ul>
<h2 id="2-explanation-of-algorithm-19"><a class="header" href="#2-explanation-of-algorithm-19">2. Explanation of Algorithm</a></h2>
<h3 id="1-initializestate"><a class="header" href="#1-initializestate">1. <code>InitializeState</code></a></h3>
<h4 id="1-overview-65"><a class="header" href="#1-overview-65">1. overview</a></h4>
<ul>
<li>The <code>InitializeState</code> function initializes the orbit of the satellite.</li>
</ul>
<h4 id="2-inputs-and-outputs-31"><a class="header" href="#2-inputs-and-outputs-31">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li><code>relative_position_lvlh_m</code>, <code>relative_velocity_lvlh_m_s</code></li>
</ul>
<ul>
<li>The initial state of the satellite</li>
</ul>
<ul>
<li><code>gravity_constant_m3_s2</code>
<ul>
<li>The gravity constant of the reference celestial body $\mu$</li>
</ul>
</li>
<li><code>initial_time_s</code>
<ul>
<li>Initial simulation time (default value is 0)</li>
</ul>
</li>
</ul>
</li>
<li>output
<ul>
<li>none </li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-38"><a class="header" href="#3-algorithm-38">3. algorithm</a></h4>
<h4 id="4-note-26"><a class="header" href="#4-note-26">4. note</a></h4>
<h3 id="2-calculatesystemmatrix"><a class="header" href="#2-calculatesystemmatrix">2. <code>CalculateSystemMatrix</code></a></h3>
<h4 id="1-overview-66"><a class="header" href="#1-overview-66">1. overview</a></h4>
<ul>
<li>The <code>CalculateSystemMatrix</code> function is used only inside the <code>RelativeOrbit</code> class. This function calls the system matrix calculation function according to <code>relative_dynamics_model_type</code>.</li>
</ul>
<h4 id="2-inputs-and-outputs-32"><a class="header" href="#2-inputs-and-outputs-32">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li><code>relative_dynamics_model_type</code>
<ul>
<li>The type of relative dynamics model</li>
</ul>
</li>
<li><code>reference_sat_orbit</code>
<ul>
<li>The orbit of the reference satellite</li>
</ul>
</li>
<li><code>gravity_constant_m3_s2</code> 
<ul>
<li>The gravity constant $\mu$</li>
</ul>
</li>
</ul>
</li>
<li>output
<ul>
<li>none </li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-39"><a class="header" href="#3-algorithm-39">3. algorithm</a></h4>
<h4 id="4-note-27"><a class="header" href="#4-note-27">4. note</a></h4>
<h3 id="3-calculatestm"><a class="header" href="#3-calculatestm">3. <code>CalculateStm</code></a></h3>
<h4 id="1-overview-67"><a class="header" href="#1-overview-67">1. overview</a></h4>
<ul>
<li>The <code>CalculateStm</code> function is used only inside the <code>RelativeOrbit</code> class. This function calls the system matrix calculation function according to <code>stm_model_type</code>.</li>
</ul>
<h4 id="2-inputs-and-outputs-33"><a class="header" href="#2-inputs-and-outputs-33">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li><code>stm_model_type</code>
<ul>
<li>The type of relative dynamics model</li>
</ul>
</li>
<li><code>reference_sat_orbit</code>
<ul>
<li>The orbit of the reference satellite</li>
</ul>
</li>
<li><code>gravity_constant_m3_s2</code> 
<ul>
<li>The gravity constant $\mu$</li>
</ul>
</li>
<li><code>elapsed_sec</code>
<ul>
<li>Elapsed simulation time</li>
</ul>
</li>
</ul>
</li>
<li>output
<ul>
<li>none </li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-40"><a class="header" href="#3-algorithm-40">3. algorithm</a></h4>
<h4 id="4-note-28"><a class="header" href="#4-note-28">4. note</a></h4>
<h3 id="4-calculatehillsystemmatrix"><a class="header" href="#4-calculatehillsystemmatrix">4. <code>CalculateHillSystemMatrix</code></a></h3>
<h4 id="1-overview-68"><a class="header" href="#1-overview-68">1. overview</a></h4>
<ul>
<li>The <code>CalculateHillSystemMatrix</code> function calculates the system matrix of the Hill equation. </li>
<li>This function is declared in <code>relative_orbit_models.hpp</code> and is used by the</li>
</ul>
<h4 id="2-inputs-and-outputs-34"><a class="header" href="#2-inputs-and-outputs-34">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li><code>orbit_radius</code>
<ul>
<li>Radius of the reference satellite orbit $R$</li>
</ul>
</li>
<li><code>gravity_constant_m3_s2</code> 
<ul>
<li>The gravity constant $\mu$</li>
</ul>
</li>
</ul>
</li>
<li>output
<ul>
<li><code>system_matrix</code>
<ul>
<li>system matrix</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-41"><a class="header" href="#3-algorithm-41">3. algorithm</a></h4>
<ul>
<li>The mean motion of the reference orbit ($n$) is calculated as follows:</li>
</ul>
<p>\[
n=\sqrt{\frac{\mu}{R^3}}
\]</p>
<ul>
<li>Then, the system matrix ($\boldsymbol{A}$) is calculated as follows:</li>
</ul>
<p>\[
\boldsymbol{A}=
\begin{pmatrix}
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
3n^2 &amp; 0 &amp; 0 &amp; 0 &amp; 2n &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; -2n &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; -n^2 &amp; 0 &amp; 0 &amp; 0 \\
\end{pmatrix}
\]</p>
<h4 id="4-note-29"><a class="header" href="#4-note-29">4. note</a></h4>
<h3 id="5-calculatehcwstm"><a class="header" href="#5-calculatehcwstm">5. <code>CalculateHcwStm</code></a></h3>
<h4 id="1-overview-69"><a class="header" href="#1-overview-69">1. overview</a></h4>
<ul>
<li>The <code>CalculateHcwStm</code> function calculates the Hill-Clohessy-Wiltshire STM. </li>
<li>This function is declared in <code>relative_orbit_models.hpp</code> and is used by the</li>
</ul>
<h4 id="2-inputs-and-outputs-35"><a class="header" href="#2-inputs-and-outputs-35">2. inputs and outputs</a></h4>
<ul>
<li>input
<ul>
<li><code>orbit_radius</code>
<ul>
<li>Radius of the reference satellite orbit $R$</li>
</ul>
</li>
<li><code>gravity_constant_m3_s2</code> 
<ul>
<li>The gravity constant $\mu$</li>
</ul>
</li>
<li><code>elapsed_sec</code>
<ul>
<li>Elapsed simulation time</li>
</ul>
</li>
</ul>
</li>
<li>output
<ul>
<li><code>system_matrix</code>
<ul>
<li>system matrix</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-42"><a class="header" href="#3-algorithm-42">3. algorithm</a></h4>
<ul>
<li>The mean motion of the reference orbit ($n$) is calculated as follows:</li>
</ul>
<p>\[
n=\sqrt{\frac{\mu}{R^3}}
\]</p>
<ul>
<li>Then, the system matrix ($\boldsymbol{A}$) is calculated as follows:</li>
</ul>
<p>\[
\boldsymbol{\Phi}(t,t0)=
\begin{pmatrix}
4-3\cos(nt) &amp; 0 &amp; 0 &amp; \frac{\sin(nt)}{n} &amp; \frac{2}{n}-\frac{2\cos(nt)}{n} &amp; 0 \\
-6nt+6\sin(nt) &amp; 1 &amp; 0 &amp; -\frac{2}{n}+\frac{2\cos(nt)}{n} &amp; \frac{4\sin(nt)}{n}-3t &amp; 0 \\
0 &amp; 0 &amp; \cos(nt) &amp; 0 &amp; 0 &amp; \frac{\sin(nt)}{n} \\
3n\sin(nt) &amp; 0 &amp; 0 &amp; cos(nt) &amp; 2\sin(nt) &amp; 0 \\
-6n+6n\cos(nt) &amp; 0 &amp; 0 &amp; -2\sin(nt) &amp; -3+4\cos(nt) &amp; 0 \\
0 &amp; 0 &amp; -n\sin(nt) &amp; 0 &amp; 0 &amp; \cos(nt) \\
\end{pmatrix}
\]</p>
<h4 id="4-note-30"><a class="header" href="#4-note-30">4. note</a></h4>
<h2 id="3-results-of-verifications-20"><a class="header" href="#3-results-of-verifications-20">3. Results of verifications</a></h2>
<h4 id="1-relative-orbit-propagation"><a class="header" href="#1-relative-orbit-propagation">1. Relative Orbit Propagation</a></h4>
<h5 id="1-overview-70"><a class="header" href="#1-overview-70">1. overview</a></h5>
<ul>
<li>Make sure the relative orbit is correctly propagated using a simple orbit</li>
</ul>
<h5 id="2-conditions-for-the-verification-15"><a class="header" href="#2-conditions-for-the-verification-15">2. conditions for the verification</a></h5>
<ul>
<li>input files
<ul>
<li>Initialization files for the two satellites were prepared.
<ul>
<li><code>satellite0.ini</code></li>
<li><code>satellite1.ini</code></li>
</ul>
</li>
</ul>
</li>
<li>initial values
<ul>
<li>
<p>The orbit of the reference satellite (satellite0) is GEO. The initial position of the satellite (satellite1) is $(0\mathrm{m}, 100\mathrm{m}, 0\mathrm{m})^\mathrm{T}$ in LVLH frame. The orbit was propagated for 86400 sec (the period of GEO).</p>
</li>
<li>
<p><code>satellite0.ini</code></p>
<pre><code>propagate_mode = RK4

//Information used for orbital propagation by the Runge-Kutta method///////////
//initial satellite position[m] 
//＊The coordinate system is defined in PlanetSelect.ini
initial_position_i_m(0) = 4.2164140100E+07  //radius of GEO
initial_position_i_m(1) = 0
initial_position_i_m(2) = 0
//initial satellite velocity[m/s]
//＊The coordinate system is defined in PlanetSelect.ini
initial_velocity_i_m_s(0) = 0
initial_velocity_i_m_s(1) = 3.074661E+03  //Speed of a spacecraft in GEO
initial_velocity_i_m_s(2) = 0
///////////////////////////////////////////////////////////////////////////////
</code></pre>
</li>
<li>
<p><code>satellite1.ini</code></p>
<pre><code>propagate_mode = RELATIVE

//Information used for relative orbit propagation//////////////////////////////
//Relative Orbit Update Method (0 means RK4, 1 means STM)
relative_orbit_update_method = 0
// RK4 Relative Dynamics model type (only valid for RK4 update)
// 0: Hill
relative_dynamics_model_type = 0
// STM Relative Dynamics model type (only valid for STM update)
// 0: HCW
stm_model_type = 0
// Initial satellite position relative to the reference satellite in LVLH frame[m]
// * The coordinate system is defined at [PLANET_SELECTION] in SampleSimBase.ini
initial_relative_position_lvlh_m(0) = 0.0
initial_relative_position_lvlh_m(1) = 100.0
initial_relative_position_lvlh_m(2) = 0.0
// initial satellite velocity relative to the reference satellite in LVLH frame[m/s]
initial_relative_velocity_lvlh_m_s(0) = 0.0
initial_relative_velocity_lvlh_m_s(1) = 0.0
initial_relative_velocity_lvlh_m_s(2) = 0.0
// information of reference satellite
reference_satellite_id = 0
///////////////////////////////////////////////////////////////////////////////
</code></pre>
</li>
</ul>
</li>
</ul>
<h5 id="3-results-10"><a class="header" href="#3-results-10">3. results</a></h5>
<ul>
<li>The position of satellite1 seen from satellite0 in the inertia frame was calculated.</li>
</ul>
<div align="center">
<img src="Specifications/Dynamics/./figs/RelativeOrbit_verification_i_x.jpg" width=80% alt="">
</div>
  <div align="center">
<img src="Specifications/Dynamics/./figs/RelativeOrbit_verification_i_y.jpg" width=80% alt="">
</div>
<ul>
<li>They correctly move periodically.</li>
<li>In this example of verification, the RK4 method is used to propagate relative orbits, but the results were the same when using STM.</li>
</ul>
<h2 id="4-references-18"><a class="header" href="#4-references-18">4. References</a></h2>
<ol>
<li>Kapila, V., Sparks, A. G., Buffington, J. M., &amp; Yan, Q. (2000). Spacecraft formation flying: Dynamics and control. Journal of Guidance, Control, and Dynamics, 23(3), 561-564.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-solar-radiation-pressure-environment"><a class="header" href="#specification-for-solar-radiation-pressure-environment">Specification for Solar Radiation Pressure Environment</a></h1>
<h2 id="1--overview-34"><a class="header" href="#1--overview-34">1.  Overview</a></h2>
<h3 id="1-functions-20"><a class="header" href="#1-functions-20">1. Functions</a></h3>
<ul>
<li><code>SolarRadiationPressureEnvironment</code> calculates solar power flux at the spacecraft's position, including the earth's eclipse effect.</li>
</ul>
<h3 id="2-related-files-12"><a class="header" href="#2-related-files-12">2. Related files</a></h3>
<ul>
<li><code>src/environment/local/solar_radiation_pressure_environment.cpp, .hpp</code>
<ul>
<li><code>SolarRadiationPressureEnvironment</code> class is defined. </li>
</ul>
</li>
<li><code>src/environment/local/local_environment.cpp, .hpp</code>
<ul>
<li><code>SolarRadiationPressureEnvironment</code> class is used here as a member variable of <code>LocalEnvironment</code> class.</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-21"><a class="header" href="#3-how-to-use-21">3. How to use</a></h3>
<ul>
<li>Call <code>UpdateAllStates</code> function to calculates solar power flux and updates the eclipse flag.</li>
<li>Users can get calculated values by using the following functions:
<ul>
<li><code>GetPressure_N_m2</code>: Return solar pressure (N/m2) with eclipse effect for SRP disturbance calculation.</li>
<li><code>GetPowerDensity_W_m2</code>: Return solar power density (W/m2) with eclipse effect for Electrical Power System calculation.</li>
<li><code>GetPressureWithoutEclipse_Nm2</code>: Return solar pressure (N/m2) without eclipse effect.</li>
<li><code>GetSolarConstant_W_m2</code>: Return solar constant value 1366 [W/m2]</li>
<li><code>GetShadowCoefficient</code>: Return shadow function $\nu$.
<ul>
<li>When the spacecraft is in umbra, $\nu=0$.</li>
<li>When the spacecraft is in sunlight, $\nu=1$.</li>
<li>When the spacecraft is in penumbra, $0&lt;\nu&lt;1$.</li>
</ul>
</li>
<li><code>GetIsEclipsed</code>: Return eclipse or not</li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-20"><a class="header" href="#2-explanation-of-algorithm-20">2. Explanation of Algorithm</a></h2>
<h3 id="1-pressure-calculation-in-updateallstates-function"><a class="header" href="#1-pressure-calculation-in-updateallstates-function">1. Pressure calculation in <code>UpdateAllStates</code> function</a></h3>
<h4 id="1-overview-71"><a class="header" href="#1-overview-71">1. overview</a></h4>
<ul>
<li>Solar radiation pressure at the position of the spacecraft is calculated by using the inverse square law.</li>
</ul>
<h4 id="2-inputs-and-outputs-36"><a class="header" href="#2-inputs-and-outputs-36">2. inputs and outputs</a></h4>
<ul>
<li>Constants
<ul>
<li>Solar constant: $P_{\odot} = 1366$ W/m2</li>
<li>Speed of light: $c = 299792458$ m/s</li>
<li>Astronomical Unit: $AU = 149597870700$ m</li>
</ul>
</li>
<li>Input variables
<ul>
<li>The sun position in the body-fixed frame of the spacecraft: $\boldsymbol{r}_{\odot-sc}$ m
<ul>
<li>Unbold $r_{\odot-sc}$ is the norm of $\boldsymbol{r}_{\odot-sc}$</li>
</ul>
</li>
</ul>
</li>
<li>Output</li>
<li>Solar radiation pressure: $P_{sc}$ N/m2</li>
</ul>
<h4 id="3-algorithm-43"><a class="header" href="#3-algorithm-43">3. algorithm</a></h4>
<p>\[
P_{sc}=\frac{P_{sun}}{c}\left(\frac{AU}{r_{\odot-sc}}\right)^{2}
\]</p>
<h4 id="4-note-31"><a class="header" href="#4-note-31">4. note</a></h4>
<ul>
<li>It is known that the solar constant value varies between 1365 and 1367 W/m2, but it is handled as a constant value in S2E. </li>
</ul>
<h3 id="2-calcshadowcoefficient-function"><a class="header" href="#2-calcshadowcoefficient-function">2. <code>CalcShadowCoefficient</code> function</a></h3>
<h4 id="1-overview-72"><a class="header" href="#1-overview-72">1. overview</a></h4>
<ul>
<li>This function determines that the spacecraft is inside the eclipse of the earth or not.</li>
</ul>
<h4 id="2-inputs-and-outputs-37"><a class="header" href="#2-inputs-and-outputs-37">2. inputs and outputs</a></h4>
<ul>
<li>Constants
<ul>
<li>Radius of the earth: $r_{\oplus}=6378137$ m</li>
<li>Radius of the sun: $r_{\odot}=6.96\times10^{8}$ m</li>
</ul>
</li>
<li>Input variables
<ul>
<li>The sun position in the body-fixed frame of the spacecraft: $\boldsymbol{r}_{\odot-sc}$ m</li>
<li>The earth position in the body-fixed frame of the spacecraft: $\boldsymbol{r}_{\oplus-sc}$ m</li>
</ul>
</li>
<li>Output
<ul>
<li>none</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-44"><a class="header" href="#3-algorithm-44">3. algorithm</a></h4>
<p>\[
\begin{align}
A_{\odot} &amp;= \sin^{-1}\left(\frac{r_{\odot}}{r_{\odot-sc}}\right)\\
A_{\oplus} &amp;= \sin^{-1}\left(\frac{r_{\oplus}}{r_{\oplus-sc}}\right)\\
\delta &amp;= \cos^{-1}\left(\frac{r_{\odot-sc}}{r_{\oplus-sc}}\cdot \boldsymbol{r}_{\oplus-sc}\cdot(\boldsymbol{r}_{\odot-sc}-\boldsymbol{r}_{\oplus-sc})\right)\\
\end{align}
\]</p>
<h4 id="4-note-32"><a class="header" href="#4-note-32">4. note</a></h4>
<ul>
<li>See the following description of the <code>CalcShadowFunction</code> for the calculation of the shadow function.</li>
</ul>
<h3 id="3-calcshadowfunction-function"><a class="header" href="#3-calcshadowfunction-function">3. <code>CalcShadowFunction</code> function</a></h3>
<h4 id="1-overview-73"><a class="header" href="#1-overview-73">1. overview</a></h4>
<ul>
<li>This function calculates the degree of the Sun's occultation by the Earth.</li>
<li>The base algorithm is referred to <a href="https://www.springer.com/jp/book/9783540672807">Satellite Orbits</a> chapter 3.4. </li>
</ul>
<h4 id="2-inputs-and-outputs-38"><a class="header" href="#2-inputs-and-outputs-38">2. inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>The apparent radius of the Sun: $A_{\odot}$</li>
<li>The apparent radius of the Earth: $A_{\oplus}$</li>
<li>The apparent separation of the centers of the Sun and the Earth: $\delta$</li>
<li>The angle between the center of the Sun and the common chord: $x$</li>
<li>The length of the common chord of the apparent solar disk and apparent celestial disk: $y$</li>
</ul>
</li>
<li>Output
<ul>
<li>The shadow function: $\nu$</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-45"><a class="header" href="#3-algorithm-45">3. algorithm</a></h4>
<ul>
<li>If the occultation is total, then $\nu=0$.</li>
<li>If the occultation is partial but maximum, then $\nu=1-\left(\frac{A_{\oplus}}{A_{\odot}}\right)^2$</li>
<li>If the occultation is partial, then $\nu = 1-\frac{S}{\pi A^2_{\odot}}$
<ul>
<li>S is given by the following calculation.</li>
</ul>
</li>
</ul>
<p>\[
S=A_{\odot}^2\arccos\left(\frac{x}{A_{\odot}}\right)+A_{\oplus}^2\arccos\left(\frac{\delta-x}{A_{\oplus}}\right)-\delta\cdot y
\]</p>
<ul>
<li>In other cases, since it means that no occultation takes place, then $\nu=1$.</li>
</ul>
<h2 id="3-results-of-verifications-21"><a class="header" href="#3-results-of-verifications-21">3. Results of verifications</a></h2>
<h3 id="1-verification-of-pressure-calculation-in-updateallstates-function"><a class="header" href="#1-verification-of-pressure-calculation-in-updateallstates-function">1. Verification of pressure calculation in <code>UpdateAllStates</code> function</a></h3>
<h4 id="1-overview-74"><a class="header" href="#1-overview-74">1. overview</a></h4>
<ul>
<li>The pressure calculation above is verified.</li>
</ul>
<h4 id="2-conditions-for-the-verification-16"><a class="header" href="#2-conditions-for-the-verification-16">2. conditions for the verification</a></h4>
<ul>
<li>A test code written in the <code>SRPEnvironment.cpp</code> is used.</li>
<li>The sun position and the earth position are fixed, and the spacecraft position varies as following values.
<ul>
<li>Sun-spacecraft distance: 149604270700m - 153797870700m</li>
<li>Earth-spacecraft distance: 6400000m - 4200000000m</li>
</ul>
</li>
</ul>
<h4 id="3-results-11"><a class="header" href="#3-results-11">3. results</a></h4>
<ul>
<li>The pressure calculation is verified.</li>
</ul>
<img src="Specifications/Environment/./figs/Result_SRP_calculation.JPG" alt="SummaryCalculationTime" style="zoom: 50%;" />
<h3 id="2-verification-of-calculation-in-calcshadowfunction-function"><a class="header" href="#2-verification-of-calculation-in-calcshadowfunction-function">2. Verification of calculation in <code>CalcShadowFunction</code> function</a></h3>
<h4 id="1-overview-75"><a class="header" href="#1-overview-75">1. overview</a></h4>
<ul>
<li>The calculation of the shadow function is verified.</li>
<li>The result of the <code>CalcShadowFunction</code> of S2E is compared with the results of the <code>solar intensity</code> of STK.</li>
</ul>
<h4 id="2-conditions-for-the-verification-17"><a class="header" href="#2-conditions-for-the-verification-17">2. conditions for the verification</a></h4>
<ul>
<li>
<p>Orbit</p>
<ul>
<li>The orbit of the ISS was used for verification.</li>
<li>The TLE data are as follows.</li>
</ul>
<pre><code>1 25544U 98067A   20250.86981481  .00000008  00000-0  82464-5 0  9991
2 25544  51.6470 304.2415 0002004  86.5035 251.6018 15.49214189244677
</code></pre>
</li>
<li>
<p>Simulation time</p>
<ul>
<li>The simulation time is as follows.</li>
</ul>
<pre><code>//Simulation start date，[UTC]
StartYMDHMS=2020/09/13 12:00:00.0
//Simulation finish time，[sec]
EndTimeSec=3600
</code></pre>
</li>
</ul>
<h4 id="3-results-12"><a class="header" href="#3-results-12">3. Results</a></h4>
<ul>
<li>The calculation of the shadow function is verified.
<img src="Specifications/Environment/./figs/Result_SRPEnvironment_shadowfunction.jpg" alt="Result_SRPEnvironment_shadowfunction" style="zoom: 50%;" /></li>
</ul>
<h2 id="4-references-19"><a class="header" href="#4-references-19">4. References</a></h2>
<ol>
<li>Montenbruck, O., Gill, E., &amp; Lutze, F. (2002). Satellite orbits: models, methods, and applications. Appl. Mech. Rev., 55(2), B27-B28.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-atmosphere-model"><a class="header" href="#specification-for-atmosphere-model">Specification for Atmosphere model</a></h1>
<h2 id="1--overview-35"><a class="header" href="#1--overview-35">1.  Overview</a></h2>
<h3 id="1-functions-21"><a class="header" href="#1-functions-21">1. Functions</a></h3>
<ul>
<li>The <code>Atmosphere</code> class calculates an air density at the satellite's position.</li>
</ul>
<ol start="2">
<li>Related files</li>
</ol>
<ul>
<li><code>src/environment/local/atmosphere.cpp, .hpp</code>
<ul>
<li><code>Atmosphere</code> class is defined.</li>
</ul>
</li>
<li><code>src/environment/local/local_environment.cpp, .hpp</code>
<ul>
<li><code>Atmosphere</code> class is used here as a member variable of <code>LocalEnvironment</code> class.</li>
</ul>
</li>
<li><code>src/library/external/nrlmsise00/wrapper_nrlmsise00.cpp, .hpp</code>
<ul>
<li>An air density is calculated using an external library, NRLMSISE00 atmosphere model.</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-22"><a class="header" href="#3-how-to-use-22">3. How to use</a></h3>
<ul>
<li>Select a model and set a standard deviation as <code>air_density_standard_deviation</code> for random noise in the <code>local_environment.ini</code> file
<ul>
<li>Model
<ul>
<li><code>STANDARD</code>
<ul>
<li>The air density is calculated using scale height.</li>
</ul>
</li>
<li><code>HARRIS_PRIESTER</code>
<ul>
<li>The air density is calculated using the Harris-Priester model.</li>
</ul>
</li>
<li><code>NRLMSISE00</code>
<ul>
<li>The air density is calculated using the NRLMSISE00 model.</li>
<li>If users use this model, the following additional parameters must be set in the <code>.ini</code> file.
<ul>
<li><code>nrlmsise00_table_file</code>: The space weather table path</li>
<li><code>is_manual_parameter_used</code>: The manual setting parameter defined as follows are used or not
<ul>
<li>manual_daily_f107: User defined f10.7 (1 day)</li>
<li>manual_average_f107: User defined f10.7 (30 days average)</li>
<li>manual_ap: User defined ap</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>The public functions
<ul>
<li><code>CalcAirDensity_kg_m3</code>: Update the air density (kg/m3) based on the selected model</li>
<li><code>GetAirDensity_kg_m3</code>: Return the calculated air density (kg/m3)</li>
</ul>
</li>
</ul>
<h2 id="2-installation-of-nrlmsise00"><a class="header" href="#2-installation-of-nrlmsise00">2. Installation of NRLMSISE00</a></h2>
<ul>
<li>Please check <a href="Specifications/Environment/./General/HowToDownloadNRLMSISE00library.html">How to download and compile NRLMSISE00 Library</a></li>
</ul>
<h2 id="3-explanation-of-algorithm"><a class="header" href="#3-explanation-of-algorithm">3. Explanation of Algorithm</a></h2>
<h3 id="standard"><a class="header" href="#standard">STANDARD</a></h3>
<h4 id="1-air-density-calculation"><a class="header" href="#1-air-density-calculation">1. Air density calculation</a></h4>
<ul>
<li>
<p>Inputs</p>
<ul>
<li>Altitude</li>
</ul>
</li>
<li>
<p>Outputs</p>
<ul>
<li>Air density</li>
</ul>
</li>
<li>
<p>Algorithm<br />
The STANDARD model assumes the air density as follows.</p>
</li>
</ul>
<p>\[
\rho \left(h \right) = \rho_0 \exp \left(-\frac{h - h_0}{H} \right)
\]
where $h_0$ is a reference height, $\rho_0$ is an air density at the reference height, and $H$ is a scale height. These parameters are referred from the table shown in References [2].</p>
<h3 id="nrlmsise00"><a class="header" href="#nrlmsise00">NRLMSISE00</a></h3>
<h4 id="read-space-weather-table"><a class="header" href="#read-space-weather-table">Read Space weather table</a></h4>
<ul>
<li><code>F10.7</code> and <code>Kp/Ap</code> index, which indicates the solar activity cycle, are necessary as inputs for NRLMSISE00.<br />
These parameters, which are only during the simulation period, are read from SpaceWeather.txt.</li>
<li>Note
<ul>
<li>If SpaceWeather.txt cannot be read, the atmosphere model is automatically set to STANDARD.</li>
<li>SpaceWeather.txt includes data between 2015 and 2044. If the simulation date is out of range, the air density cannot be calculated accurately.</li>
</ul>
</li>
</ul>
<h4 id="air-density-calculation"><a class="header" href="#air-density-calculation">Air density calculation</a></h4>
<ul>
<li>Inputs
<ul>
<li>Decimal year</li>
<li>Latitude</li>
<li>Longitude</li>
<li>Altitude</li>
</ul>
</li>
<li>Outputs
<ul>
<li>Air density</li>
</ul>
</li>
<li>Algorithm
<ul>
<li>Please refer the following reference.
<ul>
<li>Picone, J. M.; Hedin, A. E.; Drob, D. P.; Aikin, A. C. (2002-12-01). “NRLMSISE-00 empirical model of the atmosphere: Statistical comparisons and scientific issues”. Journal of Geophysical Research: Space Physics 107 (A12)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="4-verification"><a class="header" href="#4-verification">4. Verification</a></h2>
<h3 id="nrlmsise00-1"><a class="header" href="#nrlmsise00-1">NRLMSISE00</a></h3>
<ol>
<li>
<p>Overview</p>
<ul>
<li>The calculated air density was compared with <a href="https://ccmc.gsfc.nasa.gov/modelweb/models/nrlmsise00.php">outputs from web-based NRLMSISE00 model</a>.</li>
</ul>
</li>
<li>
<p>Conditions for the verification</p>
<ol>
<li>input file </li>
</ol>
<ul>
<li>Default initialize files</li>
</ul>
<ol start="2">
<li>initial values</li>
</ol>
<ul>
<li>Case1 : Default initialize files</li>
</ul>
<pre><code>simulation_start_time_utc = 2020/01/01 11:00:00.0
simulation_duration_s = 200
simulation_step_s = 0.1
orbit_update_period_s = 0.1
log_output_period_s = 0.1
simulation_speed_setting = 0
</code></pre>
<ul>
<li>Case2 : Start year only was changed to 2015.</li>
</ul>
<pre><code>simulation_start_time_utc = 2015/01/01 11:00:00.0
simulation_duration_s = 200
simulation_step_s = 0.1
orbit_update_period_s = 0.1
log_output_period_s = 0.1
simulation_speed_setting = 0
</code></pre>
<ul>
<li>Especially, we chose following TLE for orbit calculation</li>
</ul>
<pre><code>tle1=1 38666U 12003B   12237.00000000 +.00000100  00000-0  67980-4 0 00008
tle2=2 38666 098.6030 315.4100 0000010 300.0000 180.0000 14.09465034  0011
</code></pre>
</li>
<li>
<p>Results</p>
<ul>
<li>The calculated air density at t = 0.5 [s] was compared with the result of web-based model.</li>
<li>S2E
<ul>
<li>Case1 : 2.27E-15 kg / m3</li>
<li>Case2 : 1.01E-14 kg / m3</li>
</ul>
</li>
<li>Web-based NRLMSISE00
<ul>
<li>
<p>Case1 : 2.454E-15 kg / m3<br />
<img src="Specifications/Environment/./figs/Result_NRLMSISE00_Web_2020.png"/></p>
</li>
<li>
<p>Case2 : 1.000E-14 kg / m3<br />
<img src="Specifications/Environment/./figs/Result_NRLMSISE00_Web_2015.png"/></p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="5-references"><a class="header" href="#5-references">5. References</a></h2>
<ol>
<li>Picone, J. M.; Hedin, A. E.; Drob, D. P.; Aikin, A. C. (2002-12-01). “NRLMSISE-00 empirical model of the atmosphere: Statistical comparisons and scientific issues”. Journal of Geophysical Research: Space Physics 107 (A12)</li>
<li>半揚稔雄，ミッション解析と軌道設計の基礎，現代数学社, p.324 (in japanese)</li>
<li>NRLMSISE-00 Atmosphere Model
, https://ccmc.gsfc.nasa.gov/modelweb/models/nrlmsise00.php</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="magnetic-environment"><a class="header" href="#magnetic-environment">Magnetic Environment</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-hipparcos-catalogue"><a class="header" href="#specification-for-hipparcos-catalogue">Specification for Hipparcos catalogue</a></h1>
<h2 id="1--overview-36"><a class="header" href="#1--overview-36">1.  Overview</a></h2>
<ul>
<li>This class read the csv file of Hipparcos catalogue and to enable other classes to use the data.</li>
<li>Specify the max visual magnitude to read in <code>sample_simulation_base.ini</code></li>
</ul>
<h3 id="1-functions-22"><a class="header" href="#1-functions-22">1. functions</a></h3>
<ul>
<li><code>ReadContents</code>
<ul>
<li>Function to read <code>hip_main.csv</code></li>
</ul>
</li>
<li><code>Get</code> functions</li>
</ul>
<ul>
<li>Functions to access the data of <code>HipparcosCatalogue</code> from outside of this class</li>
</ul>
<h3 id="2-files-9"><a class="header" href="#2-files-9">2. files</a></h3>
<ul>
<li><code>HipparcosCatalogue.cpp</code> ，<code>HipparcosCatalogue.hpp</code>
<ul>
<li>Definitions and declarations of the class</li>
</ul>
</li>
<li><code>sample_simulation_base.ini</code>
<ul>
<li>Parameters for initialization</li>
</ul>
</li>
<li><code>hip_main.csv</code>
<ul>
<li>This is the original data of the Hipparcos catalogue. It is in the <code>ExtLibraries</code> directory. This data is sorted in of the visual magnitude, not in the order of HIP ID.</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-download-hip_maincsv"><a class="header" href="#3-how-to-download-hip_maincsv">3. How to download <code>hip_main.csv</code></a></h3>
<ul>
<li><code>s2e-core/scripts/download_HIPcatalogue.sh</code> is the script to download it. Run the following code using Git bash in <code>s2e-core/scripts/</code>．
<ul>
<li><strong>NOTE for Mac OS users: Run the following script not from the Mac terminal but the Ubuntu terminal in Docker.</strong> (Because the specification of <code>sed</code> is different between Mac and Linux, the file cannot be generated correctly. Reference: <a href="https://qiita.com/catfist/items/1156ae0c7875f61417ee">https://qiita.com/catfist/items/1156ae0c7875f61417ee</a>) </li>
</ul>
<pre><code>bash download_HIPcatalogue.sh 
</code></pre>
</li>
</ul>
<h3 id="4-how-to-use"><a class="header" href="#4-how-to-use">4. How to use</a></h3>
<ul>
<li>Set the parameters in <code>sample_simulation_base.ini</code></li>
<li>Create an instance by using initialization function <code>InitHipparcosCatalogue</code></li>
<li>Run <code>GetContents</code> to read the csv file</li>
<li>Get the data from outside this class using <code>Get</code> functions.</li>
<li>The <code>HipparcosData</code> structure has four elements, hipparcos_id, visible_magnitude, right_ascension_deg, declination_deg. <code>HipparcosCatalogue</code> stores the data as a vector of <code>HipparcosData</code>.</li>
</ul>
<h2 id="2-explanation-of-algorithm-21"><a class="header" href="#2-explanation-of-algorithm-21">2. Explanation of Algorithm</a></h2>
<p>TBW</p>
<h2 id="3-result-of-verification"><a class="header" href="#3-result-of-verification">3. Result of verification</a></h2>
<p>The verification using this class is conducted in <code>Spec_Telescope.md</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-for-gnss"><a class="header" href="#specification-for-gnss">Specification for GNSS</a></h1>
<h2 id="1-overview-76"><a class="header" href="#1-overview-76">1. Overview</a></h2>
<h3 id="1-function"><a class="header" href="#1-function">1. function</a></h3>
<ul>
<li>A class to read data about orbit and clock bias of GNSS satellites such as .sp3 and .clk_30s and use them in other classes.</li>
<li>Determine the file name of GNSS satellites' data and time from <code>[GNSS_SATELLITES]</code> in <code>sample_gnss.ini</code>.</li>
</ul>
<h3 id="2-related-files-13"><a class="header" href="#2-related-files-13">2. Related files</a></h3>
<ul>
<li><code>src/environment/global/globalEnvironment.cpp, .hpp</code>
<ul>
<li>GnssSatellites class is defined. Various GET functions are also implemented.</li>
</ul>
</li>
<li><code>src/environment/global/initialize_gnss_satellites.cpp, .hpp</code>
<ul>
<li>This makes the instance of the GnssSatellites class. The initialization is described in the <code>sample_gnss.ini</code> file. </li>
</ul>
</li>
<li><code>ExtLibraries/sp3</code>
<ul>
<li>It contains a set of files (.sp3, .clk_30s) necessary for generating orbits and clock biases.</li>
</ul>
</li>
</ul>
<h3 id="3-about-downloading-sp3-files-etc"><a class="header" href="#3-about-downloading-sp3-files-etc">3. About downloading .sp3 files, etc.</a></h3>
<ul>
<li>The author has not yet written script files to download .sp3 or .clk. Users can download them from <code>ftp://igs.ensg.ign.fr/pub/igs/products/</code>, <code>http://mgmds01.tksc.jaxa.jp/</code>, etc., referring to the directory classification. The directories are assumed to be as follows.</li>
</ul>
<pre><code>ExtLibraries  
    |  
   sp3  
    ├── CODE  
    │   └── final  
    ├── IGS  
    │   ├── igl    
    │   ├── igr
    │   │   └── clk
    │   ├── igs  
    │   │   └── clk_30s
    │   └── igu
    ├── JAXA
    │   ├── final
    │   ├── madoca
    │   ├── rapid
    │   └── ultra_rapid
    └── QZSS
        ├── final
        ├── rapid
        └── ultra_rapid
</code></pre>
<h2 id="2-how-to-use"><a class="header" href="#2-how-to-use">2. How to use</a></h2>
<ul>
<li>
<p>Parameters, which file to use or else are set in <code>sample_gnss.ini</code></p>
<ul>
<li><code>directory_path</code>: fixed</li>
<li><code>calculation</code>: whether to use this GNSS class</li>
<li><code>true_position_file_sort</code>: Select the type of file to generate the true value of the GNSS satellite coordinates.</li>
<li><code>true_position_first</code>: The first file to read</li>
<li><code>true_position_last</code>: The last file to read</li>
<li><code>true_position_interpolation_method</code>: Select the interpolation method</li>
<li><code>true_position_interpolation_number</code>: Select the number of points to be interpolated, so the order of the function will be <code>true_position_interpolation_number</code> -1.</li>
<li><code>true_clock_file_extension</code>: Whether to use .sp3 or clock-only files such as .clk_30s</li>
</ul>
<p><code>estimation</code> parameters are the same as above.</p>
</li>
<li>
<p>Users can retrieve the coordinates and clock bias of each GNSS satellite with the provided <code>Get</code> functions.</p>
</li>
</ul>
<h2 id="3-algorithm-46"><a class="header" href="#3-algorithm-46">3. Algorithm</a></h2>
<p>Basically, the trajectory is generated by interpolation, but some data are often missing, so we have dealt with it. For the coordinates, the trajectory is generated by interpolation from the available coordinates, and for the clock bias is generated by extracting only the strictly surrounding values. </p>
<ol>
<li>Extract the contents of the file with <code>initialize_gnss_satellites.cpp</code>.</li>
<li>Create a table for generating coordinates and clock bias with <code>Init()</code>.
<ul>
<li><code>time_table_</code>: The Unix Time of all times are listed.</li>
<li><code>gnss_*_table_*</code>: Contains the coordinates or clock bias values at all times.</li>
<li><code>available_table_</code>: Whether available of the data of all satellites at all times</li>
<li><code>time_and_index_list_</code>: Contains the pair of available time and the index in the table. </li>
</ul>
</li>
<li><code>SetUp()</code>: Set the first interpolation reference location from <code>time_table_</code> and <code>time_and_index_list_</code>, set the index of the reference to <code>nearest_index_</code> (used later in Update). <code>time_vector_</code>, <code>ecef_</code>, <code>eci_</code>, <code>clock_</code> are <code>std::vector</code> used for interpolation calculation.</li>
<li><code>Update()</code>: Coordinates and clock bias are calculated based on the time. The <code>time_vector_</code>, <code>ecef_</code>, <code>eci_</code>, and <code>clock_</code>, which are used as the basis of interpolation, are updated according to the nearest time.</li>
</ol>
<h2 id="4-result-and-specification"><a class="header" href="#4-result-and-specification">4. Result and Specification</a></h2>
<p>Some of the calculated ECI coordinates are shown below.</p>
<img src="Specifications/Environment/./figs/result_gnss.png" style = "zoom: 75%">
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-of-earth-rotation"><a class="header" href="#specification-of-earth-rotation">Specification of Earth Rotation</a></h1>
<h2 id="1--overview-37"><a class="header" href="#1--overview-37">1.  Overview</a></h2>
<h3 id="1-functions-23"><a class="header" href="#1-functions-23">1. Functions</a></h3>
<ul>
<li>The <code>EarthRotation</code> class calculates the rotational motion of the Earth.</li>
</ul>
<h3 id="2-related-files-14"><a class="header" href="#2-related-files-14">2. Related files</a></h3>
<ul>
<li><code>src/environment/global/earth_rotation.cpp, .hpp</code>
<ul>
<li><code>EarthRotation</code> class is defined here.</li>
</ul>
</li>
<li><code>src/environment/global/celestial_information.cpp, .hpp</code>
<ul>
<li><code>EarthRotation</code> class is used here.</li>
</ul>
</li>
</ul>
<h3 id="3-how-to-use-23"><a class="header" href="#3-how-to-use-23">3. How to use</a></h3>
<ul>
<li>Make an instance of the <code>EarthRotation</code> class in <code>CelestialInformation</code> class.</li>
<li>Select rotation mode in <code>sample_simulation_base.ini</code>
<ul>
<li><code>IDLE</code> : no motion ( $\mathrm{DCM_{ECItoECEF}}$ is set as the unit matrix)
<ul>
<li>If the rotation mode input is neither <code>FULL</code> nor <code>SIMPLE</code>, the <code>IDLE</code> mode is set.</li>
</ul>
</li>
<li><code>SIMPLE</code> : axial rotation only ( $\mathrm{DCM_{ECItoECEF}} = \bf{R}$ )</li>
<li><code>FULL</code> : Precession and Nutation are taken into account ( $\mathrm{DCM_{ECItoECEF}} = \bf{R}\bf{N}\bf{P}$ )
<ul>
<li>$\bf{R}$, $\bf{N}$, $\bf{P}$ stand for the DCM of axial rotation, nutation, precession, respectively.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-explanation-of-algorithm-22"><a class="header" href="#2-explanation-of-algorithm-22">2. Explanation of Algorithm</a></h2>
<p>The algorithm is based on <a href="https://www.iers.org/SharedDocs/Publikationen/EN/IERS/Publications/tn/TechnNote32/tn32.pdf;jsessionid=22C15057833E870494CC905A5B05180C.live1?__blob=publicationFile&amp;v=1">IERS Conventions 2003</a>.</p>
<h3 id="1-update-1"><a class="header" href="#1-update-1">1. <code>Update</code></a></h3>
<h4 id="1-overview-77"><a class="header" href="#1-overview-77">1. overview</a></h4>
<ul>
<li>This function calculates the coordinate transformation from ECI to ECEF, calling <code>Rotation</code> and <code>Precession</code> and <code>Nutation</code> functions.
\[
\mathrm{DCM_{ECItoECEF}} = \bf{R}\bf{N}\bf{P}
\]</li>
<li>where $\bf{R}$, $\bf{N}$, $\bf{P}$ stand for the DCM of axial rotation, nutation, precession, respectively.</li>
</ul>
<h4 id="2-inputs-and-outputs-39"><a class="header" href="#2-inputs-and-outputs-39">2. inputs and outputs</a></h4>
<ul>
<li>Input
<ul>
<li>Julian date</li>
</ul>
</li>
<li>Output
<ul>
<li>the DCM of the coordinate transformation from ECI to ECEF</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-47"><a class="header" href="#3-algorithm-47">3. algorithm</a></h4>
<p>\[
\mathrm{jdTT} = \mathrm{julian, date} + \mathrm{dtUT1UTC}
\]</p>
<ul>
<li>where Julian date is the input, dtUT1UTC is the time difference between UT1 and UTC
<ul>
<li>dtUT1UTC = 32.184 [s]</li>
</ul>
</li>
</ul>
<p>\[
\mathrm{tTT} = \frac{\mathrm{jdTT} - \mathrm{JDJ2000}}{\mathrm{JC}}
\]</p>
<ul>
<li>
<p>where tTT is Julian century for terrestrial time, JDJ2000 is Julian Date @ J2000, JC is Julian Century</p>
<ul>
<li>JDJ2000 = 2451545.0 [day]</li>
<li>JC = 36525 [day/century]</li>
</ul>
</li>
<li>
<p>By using tTT, we get the DCM of precession ( $\bf{P}$ ) and nutation ( $\bf{N}$ )  with <code>Precession</code> and <code>Nutation</code> functions.</p>
</li>
<li>
<p>$\varepsilon$, $\Delta \varepsilon$, $\Delta \psi$ are calculated in <code>Nutation</code> function.</p>
</li>
</ul>
<p>\[
\begin{align}
\mathrm{E_q} &amp;= \Delta \psi \cos{(\varepsilon + \Delta \varepsilon)} \\
\mathrm{GAST} &amp;= \mathrm{GMST} + \mathrm{E_q}
\end{align}
\]</p>
<ul>
<li>
<p>where GAST is Greenwich Apparent Sidereal Time, GMST is Greenwich Mean Sidereal Time</p>
</li>
<li>
<p>GAST is calculated from julian date in <code>gstime</code> function in <code>src/Library/sgp4/sgp4unit.h</code>.</p>
</li>
<li>
<p>By using GMST, We get the DCM of axial rotation ( $\bf{R}$ ) with the <code>Rotation</code> function. The coordinate transformation from ECI to ECEF is calculated.
\[
\mathrm{DCM_{ECItoECEF}} = \bf{R}\bf{N}\bf{P}
\]</p>
</li>
</ul>
<h4 id="4-note-33"><a class="header" href="#4-note-33">4. note</a></h4>
<ul>
<li>If rotation mode is <code>Simple</code>, only axial rotation is calculated.</li>
</ul>
<h3 id="2-axialrotation"><a class="header" href="#2-axialrotation">2. <code>AxialRotation</code></a></h3>
<h4 id="1-overview-78"><a class="header" href="#1-overview-78">1. overview</a></h4>
<ul>
<li>This function calculates the axial rotation of the central object.</li>
</ul>
<h4 id="2-inputs-and-outputs-40"><a class="header" href="#2-inputs-and-outputs-40">2. inputs and outputs</a></h4>
<ul>
<li>Input 
<ul>
<li>Greenwich Apparent Sidereal Time (GAST)</li>
</ul>
</li>
<li>Output
<ul>
<li>the DCM of axial rotation ( $\bf{R}$ )</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-48"><a class="header" href="#3-algorithm-48">3. algorithm</a></h4>
<p>\[
\bf{R} = 
\begin{pmatrix}
\cos{\mathrm{(GAST)}} &amp; \sin{\mathrm{(GAST)}} &amp; 0 \\</p>
<ul>
<li>\sin{\mathrm{(GAST)}} &amp; \cos{\mathrm{(GAST)}} &amp; 0 \\
0 &amp; 0 &amp; 1
\end{pmatrix}
\]</li>
</ul>
<h3 id="3-precession"><a class="header" href="#3-precession">3. <code>Precession</code></a></h3>
<h4 id="1-overview-79"><a class="header" href="#1-overview-79">1. overview</a></h4>
<ul>
<li>This function calculates the precession of the central object.</li>
</ul>
<h4 id="2-inputs-and-outputs-41"><a class="header" href="#2-inputs-and-outputs-41">2. inputs and outputs</a></h4>
<ul>
<li>Input 
<ul>
<li>Julian century for terrestrial time (tTT)</li>
</ul>
</li>
<li>Output
<ul>
<li>the DCM of precession ( $\bf{P}$ )</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-49"><a class="header" href="#3-algorithm-49">3. algorithm</a></h4>
<ul>
<li>Precession angles are calculated as follows.<br />
\[
\begin{align}
\zeta &amp;= 2306.2181&quot; \mathrm{tTT} + 0.30188&quot; \mathrm{tTT}^2 + 0.017998&quot; \mathrm{tTT}^3 \\
\theta &amp;= 2004.3109&quot; \mathrm{tTT} - 0.42665&quot; \mathrm{tTT}^2 - 0.041833&quot; \mathrm{tTT}^3 \\
z &amp;= 2306.2181&quot; \mathrm{tTT} + 1.09468&quot; \mathrm{tTT}^2 + 0.018203&quot; \mathrm{tTT}^3 \\
\end{align}
\]
\[
\bf{P} = 
\begin{pmatrix}
\cos{(-z)} &amp; \sin{(-z)} &amp; 0 \\
<ul>
<li>\sin{(-z)} &amp; \cos{(-z)} &amp; 0 \\
0 &amp; 0 &amp; 1
\end{pmatrix}
\begin{pmatrix}
\cos{\theta} &amp; 0 &amp; - \sin{\theta} \\
0 &amp; 1 &amp; 0 \\
\sin{\theta} &amp; 0 &amp; \cos{\theta}
\end{pmatrix}
\begin{pmatrix}
\cos{(-\zeta)} &amp; \sin{(-\zeta)} &amp; 0  \\</li>
<li>\sin{(-\zeta)} &amp; \cos{(-\zeta)} &amp; 0 \\
0 &amp; 0 &amp; 1
\end{pmatrix}
\]</li>
</ul>
</li>
</ul>
<h3 id="4-nutation"><a class="header" href="#4-nutation">4. <code>Nutation</code></a></h3>
<h4 id="1-overview-80"><a class="header" href="#1-overview-80">1. overview</a></h4>
<ul>
<li>This function calculates the nutation of the central object.</li>
</ul>
<h4 id="2-inputs-and-outputs-42"><a class="header" href="#2-inputs-and-outputs-42">2. inputs and outputs</a></h4>
<ul>
<li>Input 
<ul>
<li>Julian century for terrestrial time (tTT)</li>
</ul>
</li>
<li>Output
<ul>
<li>Return: the DCM of precession ( $\bf{N}$ )</li>
<li>$\varepsilon$: mean obliquity of the ecliptic</li>
<li>$\Delta \varepsilon$: nutation in obliquity</li>
<li>$\Delta \psi$: nutation in longitude</li>
</ul>
</li>
</ul>
<h4 id="3-algorithm-50"><a class="header" href="#3-algorithm-50">3. algorithm</a></h4>
<p>Delaunay angles are calculated as follows.
\[
\begin{align}
l &amp;= 134.96340251^\circ + 1717915923.2178&quot;\mathrm{tTT} + 31.8792&quot;\mathrm{tTT}^2 + 0.051635&quot;\mathrm{tTT}^3 - 0.00024470&quot;\mathrm{tTT}^4 \\
l' &amp;= 357.52910918^\circ + 129596581.0481&quot;\mathrm{tTT} - 0.5532&quot;\mathrm{tTT}^2 + 0.000136&quot;\mathrm{tTT}^3 - 0.00001149&quot;\mathrm{tTT}^4 \\
F  &amp;= 93.27209062^\circ + 1739527262.8478&quot;\mathrm{tTT} - 12.7512&quot;\mathrm{tTT}^2 - 0.001037&quot;\mathrm{tTT}^3 + 0.00000417&quot;\mathrm{tTT}^4 \\
D  &amp;= 297.85019547^\circ + 1602961601.2090&quot;\mathrm{tTT} - 6.3706&quot;\mathrm{tTT}^2+0.006593&quot;\mathrm{tTT}^3 -0.00003169&quot;\mathrm{tTT}^4 \\
\Omega &amp;= 125.04455501^\circ - 6962890.5431&quot;\mathrm{tTT} + 7.4722&quot;\mathrm{tTT}^2+0.007702&quot;\mathrm{tTT}^3-0.00005939&quot;\mathrm{tTT}^4 \\
\end{align}
\]</p>
<ul>
<li>l : mean anomaly of the moon</li>
<li>l' : mean anomaly of the sun</li>
<li>F : mean argument of latitude of the moon</li>
<li>D : mean elongation of the moon from the sun</li>
<li>$\Omega$ : mean longitude of ascending node of the moon</li>
</ul>
<p>$\varepsilon$ and $\Delta \varepsilon$ and $\Delta \psi$ are calculated as follows.</p>
<p>\[
\begin{align}
\varepsilon &amp;= 23^\circ26'21&quot;.448 - 46&quot;.8150\mathrm{tTT} - 0&quot;.00059\mathrm{tTT}^2 + 0&quot;.001813\mathrm{tTT}^3 \\
\Delta \epsilon &amp;= 9.205\cos{\Omega} + 0.573\cos{2L'} - 0.090\cos{2\Omega} + 0.098\cos{2L}+0.007\cos{l'} - 0.001\cos{l} + 0.022\cos{(2L'+l')} + 0.013\cos{(2L+l)}-0.010\cos({2L'-l')} , [\mathrm{arcsec}] \\
\Delta \psi &amp;= -17.206\sin{\Omega} - 1.317\sin{2L'} + 0.207\sin{2\Omega} - 0.228\sin{2L} + 0.148\sin{l'}+0.071\sin{l}-0.052\sin{(2L'+l')} - 0.030\sin{(2L+l)}+0.022\sin{(2L'-l')} , [\mathrm{arcsec}] \\
\end{align}
\]</p>
<p>where $L = F + \Omega$，$L' = L - D$</p>
<p>\[
\bf{N} = 
\begin{pmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp; \cos{\left(-(\varepsilon + \Delta \varepsilon)\right)} &amp; \sin{\left(-(\varepsilon + \Delta \varepsilon)\right)} \\
0 &amp; - \sin{\left(-(\varepsilon + \Delta \varepsilon)\right)} &amp; \cos{\left(-(\varepsilon + \Delta \varepsilon)\right)}
\end{pmatrix}
\begin{pmatrix}
\cos{(-\Delta \psi)} &amp; \sin{(-\Delta \psi)} &amp; 0 \\</p>
<ul>
<li>\sin{(-\Delta \psi)} &amp; \cos{(-\Delta \psi)} &amp; 0 \\
0 &amp; 0 &amp; 1
\end{pmatrix}
\begin{pmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp; \cos{\varepsilon} &amp; \sin{\varepsilon} \ 
0 &amp; - \sin{\varepsilon} &amp; \cos{\varepsilon}
\end{pmatrix}
\]</li>
</ul>
<h2 id="3-results-of-verifications-22"><a class="header" href="#3-results-of-verifications-22">3. Results of verifications</a></h2>
<h3 id="1-mathrmdcm_ecitoecef-calculation-in-update-function"><a class="header" href="#1-mathrmdcm_ecitoecef-calculation-in-update-function">1. $\mathrm{DCM_{ECItoECEF}}$ calculation in <code>Update</code> function</a></h3>
<h4 id="1-overview-81"><a class="header" href="#1-overview-81">1. overview</a></h4>
<ul>
<li>The $\mathrm{DCM_{ECItoECEF}}$ calculation is compared with <a href="https://jp.mathworks.com/help/aerotbx/ug/dcmeci2ecef.html#d123e38055">Matlab's dcmeci2ecef function</a></li>
</ul>
<h4 id="2-conditions-for-the-verification-18"><a class="header" href="#2-conditions-for-the-verification-18">2. conditions for the verification</a></h4>
<ul>
<li>input value
<ul>
<li>Simulation time
<ul>
<li>200, 20000, 100000 [s]</li>
</ul>
</li>
<li>other conditions 
<ul>
<li>default initialize files
<ul>
<li>UTC = 2020/01/01 12:00:00</li>
<li>Step Time 0.1 [s]</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-results-13"><a class="header" href="#3-results-13">3. results</a></h4>
<ul>
<li>
<p>Results of calculation time in S2E</p>
<img src="Specifications/Environment/./figs/Result_ECIECEF_S2E_time.png"  style = "zoom: 75%" />
</li>
</ul>
<p>If you want to reduce the calculation time, it is recommended to select <code>Simple</code> mode rather than <code>Idle</code> mode. Note again that if the rotation mode input is neither <code>Full</code> nor <code>Simple</code>, the <code>Idle</code> mode is set.</p>
<ul>
<li>
<p>Results of S2E in <code>Simple</code> rotation mode</p>
<img src="Specifications/Environment/./figs/Result_ECIECEF_S2E_Simple.png"  style = "zoom: 75%" />
</li>
<li>
<p>Results of S2E in <code>Full</code> rotation mode</p>
<img src="Specifications/Environment/./figs/Result_ECIECEF_S2E_Full.png"  style = "zoom: 75%" />
</li>
<li>
<p>Results of Matlab</p>
<img src="Specifications/Environment/./figs/Result_ECIECEF_Matlab.png"  style = "zoom: 75%" />
</li>
</ul>
<p>The results of <code>Full</code> rotation mode and Matlab agree well. Note that Matlab is based on the IAU-2000/2005 reference system, while S2E is based on IERS Conventions 2003.</p>
<h2 id="4-references-20"><a class="header" href="#4-references-20">4. References</a></h2>
<ol>
<li>天体の回転運動理論入門講義ノート, 福島 登志夫, 2007.(written in Japanese)</li>
<li>天体の位置計算, 長沢 工, 2001.(written in Japanese)</li>
<li>IERS Conventions 2003, D. D. McCarthy and G Petit, 2003.</li>
<li><a href="https://jp.mathworks.com/help/aerotbx/ug/dcmeci2ecef.html#d123e38055">MATLAB dcmeci2ecef</a>, retrieved June 18, 2021.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="specification-of-power-port"><a class="header" href="#specification-of-power-port">Specification of Power Port</a></h1>
<h2 id="1--overview-38"><a class="header" href="#1--overview-38">1.  Overview</a></h2>
<h3 id="1-functions-24"><a class="header" href="#1-functions-24">1. Functions</a></h3>
<ul>
<li><code>PowerPort</code> class provides features of an electrical power connection.</li>
<li>Users can use the class to control the electrical power switching of components and calculate the component's consumed electrical current.</li>
</ul>
<h3 id="2-related-files-15"><a class="header" href="#2-related-files-15">2. Related files</a></h3>
<ul>
<li>Main files: <code>power_port.cpp, .hpp</code></li>
<li>Referenced files: <code>component.cpp, .hpp</code> and <code>power_control_unit.cpp, .hpp</code></li>
</ul>
<h3 id="3-how-to-use-24"><a class="header" href="#3-how-to-use-24">3. How to use</a></h3>
<ul>
<li><strong>Example</strong>: The <code>sample_components.hpp</code> in the <code>s2e-core/simulation_sample/spacecraft/</code> is helpful to know how to use the feature.</li>
<li>Make a component class that inherits the <code>Component</code> class.
<ul>
<li>The <code>Component</code> class has the <code>PowerPort</code> class as a member and controls the component's action according to the electrical power switches.</li>
</ul>
</li>
<li>Make an instance of <code>PowerControlUnit</code> and connect the power port.
<ul>
<li>The <code>PowerControlUnit</code> base class has a member of the <code>map</code> of the <code>PowerPort</code> class and manages the port id and connection of the <code>PowerPort</code>.</li>
<li>Users can make their PCU by inheriting the <code>PowerControlUnit</code> base class and can control the power switching in the <code>MainRoutine</code> function.</li>
</ul>
<pre><code class="language-cpp">pcu_ = new PowerControlUnit(clock_gen);
pcu_-&gt;ConnectPort(0, 0.5, 3.3, 0.3);
</code></pre>
</li>
<li>Make an instance of the components with the connected <code>PowerPort</code>.
<pre><code class="language-cpp">obc_ = new OnBoardComputer(1, clock_gen, pcu_-&gt;GetPowerPort(0));
</code></pre>
</li>
<li>Control the power switches by using the <code>PowerControlUnit</code>.
<ul>
<li>The default setting of the power switch is <code>off</code>, so users need to power on the port to execute the <code>MainRoutine</code> of the components.</li>
</ul>
<pre><code class="language-cpp">pcu_-&gt;GetPowerPort(0)-&gt;SetVoltage(3.3);
</code></pre>
</li>
<li><strong>Note</strong>: The virtual power port is created when users make an instance of the <code>Component</code> class and its subclasses without the <code>PowerPort</code> information. The virtual port has a minus value port ID, and the switch state is originally <code>ON</code>, but the consumed power is zero.</li>
</ul>
<h2 id="2-explanation-of-algorithm-23"><a class="header" href="#2-explanation-of-algorithm-23">2. Explanation of Algorithm</a></h2>
<h3 id="1-setvoltage"><a class="header" href="#1-setvoltage">1. SetVoltage</a></h3>
<h4 id="1-overview-82"><a class="header" href="#1-overview-82">1. overview</a></h4>
<ul>
<li>This function is a setter function of the supply voltage to the power port.</li>
<li>Users can control the power switch by using this function.</li>
</ul>
<h4 id="2-inputs-and-outputs-43"><a class="header" href="#2-inputs-and-outputs-43">2. inputs and outputs</a></h4>
<ul>
<li>input: supply voltage to the port</li>
<li>output: switch state of the port</li>
</ul>
<h4 id="3-algorithm-51"><a class="header" href="#3-algorithm-51">3. algorithm</a></h4>
<ul>
<li>After the voltage is set, the <code>Update</code> function is called to check that the supply voltage is enough to turn on the component.</li>
</ul>
<h4 id="4-note-na-3"><a class="header" href="#4-note-na-3">4. note: N/A</a></h4>
<h3 id="1-update-2"><a class="header" href="#1-update-2">1. Update</a></h3>
<h4 id="1-overview-83"><a class="header" href="#1-overview-83">1. overview</a></h4>
<ul>
<li>This is an update function of the switch state and the consumed current.</li>
<li>This function also has an over-current protection feature.</li>
</ul>
<h4 id="2-inputs-and-outputs-44"><a class="header" href="#2-inputs-and-outputs-44">2. inputs and outputs</a></h4>
<ul>
<li>input: N/A (members of the class)</li>
<li>output: switch state of the port</li>
</ul>
<h4 id="3-algorithm-52"><a class="header" href="#3-algorithm-52">3. algorithm</a></h4>
<ul>
<li>When the supply voltage is larger than the <code>kMinimumVoltage</code> of the component, the switch state becomes <code>true</code>, and the consumed current is calculated as the following equation.
\[
I = P/V
\]</li>
<li>The <code>P</code> is the <code>assumed_power_consumption</code>, and users can set the value with the <code>SetAssumedPowerConsumption</code> function.</li>
<li>If the calculated current consumption is larger than the <code>kCurrentLimit</code>, the over-current protection feature is executed and turning the switch off.</li>
</ul>
<h4 id="4-note-na-4"><a class="header" href="#4-note-na-4">4. note: N/A</a></h4>
<h2 id="3-results-of-verifications-23"><a class="header" href="#3-results-of-verifications-23">3. Results of verifications</a></h2>
<p>N/A</p>
<h2 id="4-references-21"><a class="header" href="#4-references-21">4. References</a></h2>
<p>N/A</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="monte-carlo-simulation"><a class="header" href="#monte-carlo-simulation">Monte Carlo Simulation</a></h1>
<h2 id="1--overview-39"><a class="header" href="#1--overview-39">1.  Overview</a></h2>
<h3 id="1-functions-25"><a class="header" href="#1-functions-25">1. Functions</a></h3>
<ul>
<li>The <code>Monte Carlo Simulation</code> feature of S2E provides a framework for Monte Carlo simulation</li>
</ul>
<h3 id="2-related-filestbw"><a class="header" href="#2-related-filestbw">2. Related files(TBW)</a></h3>
<ul>
<li><code>src/simulation/monte_carlo_simulation</code>
<ul>
<li><code>initialize_monte_carlo_parameters</code>: A class to initialize randomized parameters</li>
<li><code>initialize_monte_carlo_simulation</code></li>
<li><code>monte_carlo_simulation_executor</code>: The main class for Monte Carlo simulation</li>
<li><code>simulation_object</code>: </li>
</ul>
</li>
<li><code>data/sample/initialize_files/sample_simulation_base.ini</code></li>
</ul>
<h3 id="3-how-to-use-25"><a class="header" href="#3-how-to-use-25">3. How to use</a></h3>
<ul>
<li>Read <a href="Specifications/Simulation/../../Tutorials/HowToUseMonteCarloSimulation.html">How to use Monte Carlo simulation</a></li>
</ul>
<h2 id="2-explanation-of-algorithm-24"><a class="header" href="#2-explanation-of-algorithm-24">2. Explanation of Algorithm</a></h2>
<p>TBW</p>
<h2 id="3-results-of-verifications-24"><a class="header" href="#3-results-of-verifications-24">3. Results of verifications</a></h2>
<p>TBW</p>
<h2 id="4-references-22"><a class="header" href="#4-references-22">4. References</a></h2>
<ol>
<li></li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
